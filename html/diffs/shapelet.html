<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title>shapelet</title>
<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>
<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', monospace;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>
</head>
<body>
<h1 id="toc_0">Comparison of the shapelet repository</h1>

<div style="background-color:Aquamarine; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Summary of Repositories</h1>
<p>
Comparison run at 02:08PM on June 09, 2015<br>
There are <b>768</b> differences between the two repositories<br><br>
Repository <b>/Users/nate/repos_hsc/shapelet/</b> <br> Revision <b>3296f817696974a6072d6ed38b3c97a4983d2288</b><br> Branch <b>master</b><br>Last commit was on <b>2014-03-03 14:36:18 -0500</b><br><br>
Repository <b>/Users/nate/repos_lsst/shapelet/</b> <br> Revision <b>93c96c8765f4f502bc267d29a27c36afedad8194</b><br> Branch <b>master</b><br>Last commit was on <b>2015-04-10 20:52:37 -0400</b><br><br>
</p>
</div>

<hr>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Files only in /Users/nate/repos_hsc/shapelet/</h1>
<h2>src/ModelBuilder.cc</h2>
<pre>
commit 3296f817696974a6072d6ed38b3c97a4983d2288
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 3 14:36:18 2014 -0500

    Turn an assert into an exception throw
    
    I'd thought we could always sanitize inputs well enough upstream
    (where we could do so more efficiently) that this would never trigger,
    but that's apparently not the case.</pre>
<h2>tests/testModelBuilder.py</h2>
<pre>
commit 3296f817696974a6072d6ed38b3c97a4983d2288
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 3 14:36:18 2014 -0500

    Turn an assert into an exception throw
    
    I'd thought we could always sanitize inputs well enough upstream
    (where we could do so more efficiently) that this would never trigger,
    but that's apparently not the case.</pre>
<h2>include/lsst/shapelet/ModelBuilder.h</h2>
<pre>
commit 3296f817696974a6072d6ed38b3c97a4983d2288
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 3 14:36:18 2014 -0500

    Turn an assert into an exception throw
    
    I'd thought we could always sanitize inputs well enough upstream
    (where we could do so more efficiently) that this would never trigger,
    but that's apparently not the case.</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Files only in /Users/nate/repos_lsst/shapelet/</h1>
<h2>include/lsst/shapelet/MatrixBuilder.h</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
<h2>tests/testFunctorKeys.py</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
<h2>include/lsst/shapelet/FunctorKeys.h</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
<h2>src/FunctorKeys.cc</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
<h2>src/MatrixBuilder.cc</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
<h2>tests/testMatrixBuilder.py</h2>
<pre>
commit 93c96c8765f4f502bc267d29a27c36afedad8194
Merge: 6f676fc ec9026c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 10 20:52:37 2015 -0400

    Merge branch 'tickets/DM-2201'</pre>
</div>

<h1 id="toc_1">List of the files in common<a name="homelist"></a></h1>

<p>Files without links do not differ</p>

<ul>
<li><code>tests/testHermiteTransformMatrix.py</code></li>
<li><code>doc/doxygen.conf.in</code></li>
<li><code>data/dev_K09_MR08.pickle</code></li>
<li><code>examples/dg.p</code></li>
<li><code>tests/data/gaussians.fits</code></li>
<li><code>data/ser2_K05_MR08.pickle</code></li>
<li><a href="#include/lsst/shapelet/RadialProfile.h"><code>include/lsst/shapelet/RadialProfile.h</code></a></li>
<li><a href="#src/ConversionMatrix.cc"><code>src/ConversionMatrix.cc</code></a></li>
<li><a href="#src/MultiShapeletBasis.cc"><code>src/MultiShapeletBasis.cc</code></a></li>
<li><a href="#src/GaussHermiteEvaluator.cc"><code>src/GaussHermiteEvaluator.cc</code></a></li>
<li><code>SConstruct</code></li>
<li><a href="#include/lsst/shapelet/MultiShapeletFunction.h"><code>include/lsst/shapelet/MultiShapeletFunction.h</code></a></li>
<li><code>examples/SConscript</code></li>
<li><code>data/lux_K02_MR04.pickle</code></li>
<li><code>tests/SConscript</code></li>
<li><code>data/ser2_K02_MR08.pickle</code></li>
<li><a href="#python/lsst/shapelet/tests.py"><code>python/lsst/shapelet/tests.py</code></a></li>
<li><code>data/ser3_K07_MR08.pickle</code></li>
<li><code>examples/shapeletConvolve.py</code></li>
<li><code>tests/testShapeletFunction.py</code></li>
<li><a href="#include/lsst/shapelet/ShapeletFunction.h"><code>include/lsst/shapelet/ShapeletFunction.h</code></a></li>
<li><code>data/lux_K09_MR04.pickle</code></li>
<li><code>data/luv_K09_MR08.pickle</code></li>
<li><code>.gitignore</code></li>
<li><code>data/exp_K07_MR08.pickle</code></li>
<li><code>data/ser5_K09_MR08.pickle</code></li>
<li><code>data/exp_K04_MR08.pickle</code></li>
<li><a href="#src/MultiShapeletFunction.cc"><code>src/MultiShapeletFunction.cc</code></a></li>
<li><a href="#include/lsst/shapelet.h"><code>include/lsst/shapelet.h</code></a></li>
<li><a href="#python/lsst/shapelet/shapeletLib.i"><code>python/lsst/shapelet/shapeletLib.i</code></a></li>
<li><code>data/exp_K09_MR08.pickle</code></li>
<li><code>data/ser3_K05_MR08.pickle</code></li>
<li><code>data/ser5_K02_MR08.pickle</code></li>
<li><code>tests/data/dev-approx.fits</code></li>
<li><code>data/lux_K04_MR04.pickle</code></li>
<li><code>data/lux_K08_MR04.pickle</code></li>
<li><code>data/lux_K05_MR04.pickle</code></li>
<li><code>python/lsst/shapelet/SConscript</code></li>
<li><code>python/lsst/shapelet/__init__.py</code></li>
<li><code>data/exp_K06_MR08.pickle</code></li>
<li><code>data/dev_K04_MR08.pickle</code></li>
<li><code>data/ser2_K06_MR08.pickle</code></li>
<li><code>data/exp_K08_MR08.pickle</code></li>
<li><code>tests/data/exp-exact.fits</code></li>
<li><code>data/dev_K06_MR08.pickle</code></li>
<li><a href="#examples/timeModels.i"><code>examples/timeModels.i</code></a></li>
<li><code>data/lux_K06_MR04.pickle</code></li>
<li><code>data/ser2_K03_MR08.pickle</code></li>
<li><code>tests/data/exp-approx.fits</code></li>
<li><code>include/lsst/shapelet/GaussHermiteEvaluator.h</code></li>
<li><code>data/luv_K03_MR08.pickle</code></li>
<li><code>ups/shapelet.table</code></li>
<li><a href="#src/BasisEvaluator.cc"><code>src/BasisEvaluator.cc</code></a></li>
<li><code>data/ser3_K09_MR08.pickle</code></li>
<li><code>include/lsst/shapelet/BasisEvaluator.h</code></li>
<li><code>examples/psf.p</code></li>
<li><code>include/lsst/shapelet/ConversionMatrix.h</code></li>
<li><code>data/ser5_K03_MR08.pickle</code></li>
<li><code>data/exp_K02_MR08.pickle</code></li>
<li><a href="#src/GaussHermiteConvolution.cc"><code>src/GaussHermiteConvolution.cc</code></a></li>
<li><code>data/dev_K05_MR08.pickle</code></li>
<li><code>data/luv_K02_MR08.pickle</code></li>
<li><code>doc/SConscript</code></li>
<li><code>tests/data/generate.py</code></li>
<li><code>ups/shapelet.build</code></li>
<li><code>data/exp_K05_MR08.pickle</code></li>
<li><a href="#tests/profiles.py"><code>tests/profiles.py</code></a></li>
<li><code>data/dev_K03_MR08.pickle</code></li>
<li><a href="#tests/testMultiShapelet.py"><code>tests/testMultiShapelet.py</code></a></li>
<li><code>examples/shapeletBases.py</code></li>
<li><code>data/ser3_K04_MR08.pickle</code></li>
<li><code>examples/psf2.p</code></li>
<li><code>data/ser2_K08_MR08.pickle</code></li>
<li><a href="#tests/testProjection.py"><code>tests/testProjection.py</code></a></li>
<li><code>examples/psf1.p</code></li>
<li><a href="#src/GaussHermiteProjection.cc"><code>src/GaussHermiteProjection.cc</code></a></li>
<li><code>data/ser3_K06_MR08.pickle</code></li>
<li><code>data/ser5_K08_MR08.pickle</code></li>
<li><code>tests/data/ser3-approx.fits</code></li>
<li><code>include/lsst/shapelet/GaussHermiteProjection.h</code></li>
<li><a href="#src/ShapeletFunction.cc"><code>src/ShapeletFunction.cc</code></a></li>
<li><code>data/exp_K03_MR08.pickle</code></li>
<li><a href="#include/lsst/shapelet/GaussHermiteConvolution.h"><code>include/lsst/shapelet/GaussHermiteConvolution.h</code></a></li>
<li><code>data/ser3_K02_MR08.pickle</code></li>
<li><a href="#src/RadialProfile.cc"><code>src/RadialProfile.cc</code></a></li>
<li><code>data/README</code></li>
<li><a href="#include/lsst/shapelet/constants.h"><code>include/lsst/shapelet/constants.h</code></a></li>
<li><a href="#python/lsst/shapelet/tractor.py"><code>python/lsst/shapelet/tractor.py</code></a></li>
<li><code>data/ser2_K07_MR08.pickle</code></li>
<li><code>lib/SConscript</code></li>
<li><code>python/lsst/__init__.py</code></li>
<li><code>data/dev_K07_MR08.pickle</code></li>
<li><code>data/luv_K06_MR08.pickle</code></li>
<li><code>tests/data/ser2-approx.fits</code></li>
<li><code>include/lsst/shapelet/HermiteTransformMatrix.h</code></li>
<li><code>ups/shapelet.cfg</code></li>
<li><code>data/luv_K08_MR08.pickle</code></li>
<li><code>data/lux_K03_MR04.pickle</code></li>
<li><code>data/luv_K04_MR08.pickle</code></li>
<li><a href="#src/HermiteTransformMatrix.cc"><code>src/HermiteTransformMatrix.cc</code></a></li>
<li><code>data/luv_K05_MR08.pickle</code></li>
<li><a href="#include/lsst/shapelet/MultiShapeletBasis.h"><code>include/lsst/shapelet/MultiShapeletBasis.h</code></a></li>
<li><code>data/ser2_K04_MR08.pickle</code></li>
<li><code>data/ser2_K09_MR08.pickle</code></li>
<li><code>data/ser3_K03_MR08.pickle</code></li>
<li><code>data/ser5_K04_MR08.pickle</code></li>
<li><code>data/dev_K02_MR08.pickle</code></li>
<li><code>data/ser5_K06_MR08.pickle</code></li>
<li><code>data/lux_K07_MR04.pickle</code></li>
<li><code>data/ser5_K07_MR08.pickle</code></li>
<li><code>data/dev_K08_MR08.pickle</code></li>
<li><code>data/luv_K07_MR08.pickle</code></li>
<li><code>data/ser5_K05_MR08.pickle</code></li>
<li><code>data/ser3_K08_MR08.pickle</code></li>
</ul>

<h1 id="toc_2"><a name="include/lsst/shapelet/RadialProfile.h"/></a>include/lsst/shapelet/RadialProfile.h</h1>

<h3 id="toc_3">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                /*
                 * LSST Data Management System
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#929e0304">929e0304</a> -  * Copyright 2008-2013 LSST Corporation.</div>
              ?                      ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#c17fe67f">c17fe67f</a> +  * Copyright 2008-2014 LSST Corporation.</div>
              ?                      ^
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #ifndef LSST_SHAPELET_RadialProfile_h_INCLUDED
                #define LSST_SHAPELET_RadialProfile_h_INCLUDED
                
                #include <map>
                
                #include "lsst/shapelet/MultiShapeletBasis.h"
                
                namespace lsst { namespace shapelet {
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#c17fe67f">c17fe67f</a> + /**</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
34   <a href="#c17fe67f">c17fe67f</a> +  *  Registry and utility class for multi-Gaussian approximations to radial profiles.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#c17fe67f">c17fe67f</a> +  *</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#c17fe67f">c17fe67f</a> +  *  RadialProfile provides C++ access to the saved multi-Gaussian approximations stored in the pickle</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#c17fe67f">c17fe67f</a> +  *  files in the data subdirectory of the shapelet package, by maintaining a singleton registry of these</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
38   <a href="#c17fe67f">c17fe67f</a> +  *  that is populated at import time by tractor.py.  It also provides access to the true (exact) profiles,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
39   <a href="#c17fe67f">c17fe67f</a> +  *  (mostly useful for educational/diagnostic purposes) and information about the relationship between</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
40   <a href="#c17fe67f">c17fe67f</a> +  *  different radii for this profile (see getMomentsRadiusFactor()).</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#c17fe67f">c17fe67f</a> +  *</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#c17fe67f">c17fe67f</a> +  *  Each RadialProfile object represents a particular "true" profile, and can hold multiple multi-Gaussian</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#c17fe67f">c17fe67f</a> +  *  (or multi-Shapelet) approximations with different degrees of fidelity, as controlled by the number of</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#c17fe67f">c17fe67f</a> +  *  components in the approximation and the maximum radius at which the approximation was fit.  For more</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#c17fe67f">c17fe67f</a> +  *  information about these approximations, see tractor.py and references therein.  All RadialProfiles</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#c17fe67f">c17fe67f</a> +  *  are defined in units of the half-light radius of the true profile, even for profiles for which</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
47   <a href="#c17fe67f">c17fe67f</a> +  *  this is not the radius typically used.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#c17fe67f">c17fe67f</a> +  *</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
49   <a href="#c17fe67f">c17fe67f</a> +  *  Several predefined subclasses of RadialProfile are defined privately, and can be accessed by name</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
50   <a href="#c17fe67f">c17fe67f</a> +  *  through the static get() method:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#c17fe67f">c17fe67f</a> +  *   - "gaussian": a single Gaussian profile</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#c17fe67f">c17fe67f</a> +  *   - "exp": Exponential profile (Sersic n=1)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#c17fe67f">c17fe67f</a> +  *   - "ser2": Sersic profile with n=2</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#c17fe67f">c17fe67f</a> +  *   - "ser3": Sersic profile with n=3</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#c17fe67f">c17fe67f</a> +  *   - "dev": de Vaucouleur profile (Sersic n=4)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#c17fe67f">c17fe67f</a> +  *   - "ser5": Sersic profile with n=5</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#c17fe67f">c17fe67f</a> +  *   - "lux": SDSS truncated Exponential profile</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#c17fe67f">c17fe67f</a> +  *   - "luv": SDSS truncated and softened de Vaucouleur profile</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#c17fe67f">c17fe67f</a> +  */</div>
                class RadialProfile {
                public:
                
                    /**
                     *  @brief Return a predefined radial profile given its name.
                     *
                     *  New RadialProfile classes are registered when their constructor is invoked, so all subclasses
                     *  should only be instantiated once (at module scope).
                     */
                    static RadialProfile & get(std::string const & name);
                
                    /// Return the name of the profile.
                    std::string const getName() const { return _name; }
                
                    /**
                     *  @brief Evaluate the profile at the given radius
                     *
                     *  Radius is given in units of half-light radius, and the profile is normalized to 1 at r=1.
                     */
                    virtual double evaluate(double r) const = 0;
                
                    /**
                     *  @brief Evaluate the profile at the given radius (vectorized).
                     *
                     *  Radius is given in units of half-light radius, and the profile is normalized to 1 at r=1.
                     */
                    ndarray::Array<double,1,1> evaluate(ndarray::Array<double const,1,1> const & r) const;
                
                    /// Return the 2nd-moment radius in units of the half-light radius.
                    double getMomentsRadiusFactor() const { return _momentsRadiusFactor; }
                
                    /**
                     *  @brief Return a multi-Gaussian approximation to the radial profile
                     *
                     *  Unlike the evaluate() method, the returned basis is normalized that the integrated
                     *  flux is equal to the (single) amplitude.
                     *
                     *  @param[in] nComponents   Number of Gaussians used to approximate the profile.
                     *  @param[in] maxRadius     Maximum radius used in fitting the approximation.  Passing 0
                     *                           selects the default for that profile.
                     *
                     *  Gaussian approximations are computed in advance and persisted, and are usually loaded
                     *  and registered with the RadialProfile object in Python at module-import time.
                     *
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#929e0304">929e0304</a> -      *  Throws NotFoundException if the a basis with the given combination of nComponents and</div>
              ?                         ^^^^^^ ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#c17fe67f">c17fe67f</a> +      *  Throws NotFoundError if the a basis with the given combination of nComponents and</div>
              ?                         ^^ ^
                     *  maxRadius has not been added to the RadialProfile.
                     */
                    PTR(MultiShapeletBasis) getBasis(int nComponents, int maxRadius=0) const;
                
                    /**
                     *  @brief Register a basis with the profile, making it available to callers of getBasis().
                     */
                    void registerBasis(PTR(MultiShapeletBasis) basis, int nComponents, int maxRadius);
                
                protected:
                
                    explicit RadialProfile(std::string const & name, int defaultMaxRadius);
                
                    double _momentsRadiusFactor;
                
                private:
                
                    typedef std::map<std::pair<int,int>,PTR(MultiShapeletBasis)> BasisRegistry;
                
                    std::string const _name;
                    int _defaultMaxRadius;
                    BasisRegistry _basisRegistry;
                };
                
                }} // namespace lsst::shapelet
                
                #endif // !LSST_SHAPELET_RadialProfile_h_INCLUDED
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="929e0304"/></a>929e0304</h3>

<pre>
commit 929e0304ad1d9862f5b3b2744e4c08c042b181dd
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="c17fe67f"/></a>c17fe67f</h3>

<pre>
commit c17fe67f384d80489135f4620f219637706beff6
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
    
    Also updated tests and visualization code in tractor.py to
    make use of the new class.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_4"><a name="src/ConversionMatrix.cc"/></a>src/ConversionMatrix.cc</h1>

<h3 id="toc_5">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/ConversionMatrix.h"
                #include "lsst/pex/exceptions.h"
                #include "ndarray/eigen.h"
                
                #include <boost/format.hpp>
                #include <boost/math/special_functions/binomial.hpp>
                #include <boost/math/special_functions/factorials.hpp>
                #include <boost/noncopyable.hpp>
                
                #include "Eigen/LU"
                
                #include <complex>
                #include <vector>
                
                namespace lsst { namespace shapelet {
                
                namespace {
                
                inline std::complex<double> iPow(int z) {
                    switch (z % 4) {
                    case 0:
                        return std::complex<double>(1.0, 0.0);
                    case 1:
                        return std::complex<double>(0.0, 1.0);
                    case 2:
                        return std::complex<double>(-1.0, 0.0);
                    case 3:
                        return std::complex<double>(0.0, -1.0);
                    };
                    return 0.0;
                }
                
                class ConversionSingleton : private boost::noncopyable {
                public:
                
                    typedef std::vector<Eigen::MatrixXd> BlockVec;
                
                    Eigen::MatrixXd const & getBlockH2L(int n) const {
                        return _h2l[n];
                    }
                
                    Eigen::MatrixXd const & getBlockL2H(int n) const {
                        return _l2h[n];
                    }
                
                    BlockVec const & getH2L() const { return _h2l; }
                
                    BlockVec const & getL2H() const { return _l2h; }
                
                    void ensure(int order) {
                        if (order > _max_order) {
                            _h2l.reserve(order + 1);
                            _l2h.reserve(order + 1);
                            for (int i = _max_order + 1; i <= order; ++i) {
                                _h2l.push_back(makeBlockH2L(i));
                                _l2h.push_back(makeBlockL2H(i, _h2l.back()));
                                ++_max_order;
                            }
                        }
                    }
                
                    static Eigen::MatrixXd makeBlockH2L(int n) {
                        Eigen::MatrixXcd c = Eigen::MatrixXcd::Zero(n + 1, n + 1);
                        for (int m = -n, i = 0; m <= n; m += 2, ++i) {
                            int const p = (n + m) / 2;
                            int const q = (n - m) / 2;
                            double const p_factorial = boost::math::unchecked_factorial<double>(p);
                            double const q_factorial = boost::math::unchecked_factorial<double>(q);
                            std::complex<double> const v1 = std::pow(std::complex<double>(0.0, -1.0), m) 
                                * std::pow(2.0, -0.5 * n)
                                / std::sqrt(p_factorial * q_factorial);
                            for (int x = 0, y = n; x <= n; ++x, --y) {
                                double const x_factorial = boost::math::unchecked_factorial<double>(x);
                                double const y_factorial = boost::math::unchecked_factorial<double>(y);
                                std::complex<double> const v2 = v1 * std::sqrt(x_factorial * y_factorial);
                                for (int r = 0; r <= p; ++r) {
                                    for (int s = 0; s <= q; ++s) {
                                        if (r + s == x) {
                                            int const m_p = r - s;
                                            c(i, x) += v2 * std::pow(std::complex<double>(0.0, 1.0), m_p)
                                                * boost::math::binomial_coefficient<double>(p, r)
                                                * boost::math::binomial_coefficient<double>(q, s);
                                        }
                                    }
                                }
                            }
                        }
                
                        Eigen::MatrixXd b = Eigen::MatrixXd::Zero(n + 1, n + 1);
                        for (int x = 0, y = n; x <= n; ++x, --y) {
                            for (int p = n, q = 0; q <= p; --p, ++q) {
                                b(2 * q, x) = c(q, x).real();
                                if (q < p) {
                                    b(2 * q + 1, x) = -c(q, x).imag();
                                }
                            }
                        }
                        return b;
                    }
                
                    static Eigen::MatrixXd makeBlockL2H(int n, Eigen::MatrixXd const & h2l) {
                        Eigen::MatrixXd l2h = h2l.inverse();
                        return l2h;
                    }
                
                    static ConversionSingleton & get() {
                        static ConversionSingleton instance;
                        return instance;
                    }
                
                private:
                    ConversionSingleton() : _max_order(-1) {}
                
                    int _max_order;
                    BlockVec _h2l;
                    BlockVec _l2h;
                };
                
                } // anonymous
                
                Eigen::MatrixXd ConversionMatrix::getBlock(int n) const { 
                    if (_input == _output) return Eigen::MatrixXd::Identity(n + 1, n + 1);
                    if (_input == HERMITE)
                        return ConversionSingleton::get().getBlockH2L(n);
                    else
                        return ConversionSingleton::get().getBlockL2H(n);
                }
                
                Eigen::MatrixXd ConversionMatrix::buildDenseMatrix() const { 
                    int const size = computeSize(_order);
                    if (_input == _output) return Eigen::MatrixXd::Identity(size, size);
                    Eigen::MatrixXd r = Eigen::MatrixXd::Zero(size, size);
                    if (_input == HERMITE) {
                        for (int n = 0, offset = 0; n <= _order; offset += ++n) {
                            r.block(offset, offset, n + 1, n + 1) = ConversionSingleton::get().getBlockH2L(n);
                        }
                    } else {
                        for (int n = 0, offset = 0; n <= _order; offset += ++n) {
                            r.block(offset, offset, n + 1, n + 1) = ConversionSingleton::get().getBlockL2H(n);
                        }
                    }
                    return r;
                }
                
                void ConversionMatrix::multiplyOnLeft(
                    ndarray::Array<double,1> const & array) const {
                    if (array.getSize<0>() != computeSize(_order)) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
173  <a href="#c630ab49">c630ab49</a> -             lsst::pex::exceptions::LengthErrorException,</div>
              ?                                               ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
173  <a href="#f61f7f2d">f61f7f2d</a> +             lsst::pex::exceptions::LengthError,</div>
                            (boost::format(
                                "Array for multiplyOnLeft has incorrect size (%n, should be %n)."
                            ) % array.getSize<0>() % computeSize(_order)).str()
                        );
                    }
                    if (_input == _output) return;
                    ConversionSingleton::BlockVec::const_iterator i;
                    if (_input == HERMITE) {
                        i = ConversionSingleton::get().getH2L().begin();
                    } else {
                        i = ConversionSingleton::get().getL2H().begin();
                    }
                    ndarray::EigenView<double,1,0> vector(array);
                    for (int offset = 0; offset < vector.size(); ++i) {
                        vector.segment(offset, i->rows()).transpose() *= i->transpose();
                        offset += i->rows();
                    }
                }
                
                void ConversionMatrix::multiplyOnRight(
                    ndarray::Array<double,1> const & array) const {
                    if (array.getSize<0>() != computeSize(_order)) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
197  <a href="#c630ab49">c630ab49</a> -             lsst::pex::exceptions::LengthErrorException,</div>
              ?                                               ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
197  <a href="#f61f7f2d">f61f7f2d</a> +             lsst::pex::exceptions::LengthError,</div>
                            (boost::format(
                                "Array for multiplyOnRight has incorrect size (%n, should be %n)."
                            ) % array.getSize<0>() % computeSize(_order)).str()
                        );
                    }
                    if (_input == _output) return;
                    ConversionSingleton::BlockVec::const_iterator i;
                    if (_input == HERMITE) {
                        i = ConversionSingleton::get().getH2L().begin();
                    } else {
                        i = ConversionSingleton::get().getL2H().begin();
                    }
                    ndarray::EigenView<double,1,0> vector(array);
                    for (int offset = 0; offset < vector.size(); ++i) {
                        vector.segment(offset, i->rows()).transpose() *= (*i);
                        offset += i->rows();
                    }
                }
                
                ConversionMatrix::ConversionMatrix(BasisTypeEnum input, BasisTypeEnum output, int order) :
                    _order(order), _input(input), _output(output)
                {
                    ConversionSingleton::get().ensure(_order);
                }
                
                void ConversionMatrix::convertCoefficientVector(
                    ndarray::Array<double,1> const & array,
                    BasisTypeEnum input,
                    BasisTypeEnum output,
                    int order
                ) {
                    if (input == output) return;
                    ConversionMatrix m(input, output, order);
                    m.multiplyOnLeft(array);
                }
                
                void ConversionMatrix::convertOperationVector(
                    ndarray::Array<double,1> const & array,
                    BasisTypeEnum input,
                    BasisTypeEnum output,
                    int order
                ) {
                    if (input == output) return;
                    ConversionMatrix m(output, input, order);
                    m.multiplyOnRight(array);
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="c630ab49"/></a>c630ab49</h3>

<pre>
commit c630ab49cb5e99ccde5ea313ac2c4e636f411dfd
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Fri Feb 18 01:32:14 2011 +0000

    afw #1556 - shapelet conversion code in; still needs swigging and testing against shapelet codes in meas packages
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_6"><a name="src/MultiShapeletBasis.cc"/></a>src/MultiShapeletBasis.cc</h1>

<h3 id="toc_7">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                /*
                 * LSST Data Management System
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#397f9519">397f9519</a> -  * Copyright 2008-2013 LSST Corporation.</div>
              ?                      ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#13feffe1">13feffe1</a> +  * Copyright 2008-2014 LSST Corporation.</div>
              ?                      ^
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "ndarray/eigen.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
25   <a href="#a853d427">a853d427</a> - #include "lsst/utils/ieee.h"</div>
                #include "lsst/pex/exceptions.h"
                
                #include "lsst/shapelet/MultiShapeletBasis.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
29   <a href="#397f9519">397f9519</a> - #include "lsst/shapelet/ModelBuilder.h"</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
30   <a href="#397f9519">397f9519</a> - #include "lsst/shapelet/GaussHermiteConvolution.h"</div>
                
                namespace lsst { namespace shapelet {
                
                MultiShapeletBasisComponent::MultiShapeletBasisComponent(
                    double radius,
                    int order,
                    ndarray::Array<double const,2,2> const & matrix
                ) : _radius(radius), _order(order), _matrix(ndarray::copy(matrix)) {
                    if (_matrix.getSize<0>() != computeSize(order)) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#397f9519">397f9519</a> -             pex::exceptions::LengthErrorException,</div>
              ?                                         ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
38   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
                            (boost::format("MultiShapeletBasisComponent matrix has %d rows; expected %d for order=%d")
                             % _matrix.getSize<0>() % computeSize(order) % order).str()
                        );
                    }
                }
                
                MultiShapeletBasis::MultiShapeletBasis(int size) : _size(size), _components() {}
                
                void MultiShapeletBasis::addComponent(
                    double radius,
                    int order,
                    ndarray::Array<double const,2,2> const & matrix
                ) {
                    if (matrix.getSize<1>() != _size) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#397f9519">397f9519</a> -             pex::exceptions::LengthErrorException,</div>
              ?                                         ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
                            (boost::format("Component matrix has %d columns; basis size is %d")
                             % matrix.getSize<1>() % _size).str()
                        );
                    }
                    _components.push_back(Component(radius, order, matrix));
                }
                
                void MultiShapeletBasis::normalize() {
                    Eigen::ArrayXd totals = Eigen::VectorXd::Zero(_size);
                    for (Iterator i = begin(); i != end(); ++i) {
                        GaussHermiteEvaluator ev(i->getOrder());
                        for (int n = 0; n < _size; ++n) {
                            totals[n] += ev.sumIntegration(i->getMatrix()[ndarray::view()(n)]);
                        }
                    }
                    for (ComponentVector::iterator i = _components.begin(); i != _components.end(); ++i) {
                        ndarray::Array<double,2,2> newMatrix = ndarray::copy(i->getMatrix());
                        for (int n = 0; n < _size; ++n) {
                            newMatrix.asEigen().col(n) /= totals[n];
                        }
                        i->_matrix = newMatrix;
                    }
                }
                
                void MultiShapeletBasis::scale(double factor) {
                    for (ComponentVector::iterator i = _components.begin(); i != _components.end(); ++i) {
                        i->_radius *= factor;
                    }
                }
                
                void MultiShapeletBasis::merge(MultiShapeletBasis const & other) {
                    ComponentVector newComponents;
                    int newSize = _size + other.getSize();
                    for (Iterator i = begin(); i != end(); ++i) {
                        ndarray::Array<double,2,2> newMatrix = ndarray::allocate(i->getMatrix().getSize<0>(), newSize);
                        newMatrix[ndarray::view()(0,_size)] = i->getMatrix();
                        newMatrix[ndarray::view()(_size, _size + other.getSize())] = 0.0;
                        newComponents.push_back(Component(i->getRadius(), i->getOrder(), newMatrix));
                    }
                    for (Iterator i = other.begin(); i != other.end(); ++i) {
                        ndarray::Array<double,2,2> newMatrix = ndarray::allocate(i->getMatrix().getSize<0>(), newSize);
                        newMatrix[ndarray::view()(0,_size)] = 0.0;
                        newMatrix[ndarray::view()(_size, _size + other.getSize())] = i->getMatrix();
                        newComponents.push_back(Component(i->getRadius(), i->getOrder(), newMatrix));
                    }
                    _size = newSize;
                    _components.swap(newComponents);
                }
                
                MultiShapeletFunction MultiShapeletBasis::makeFunction(
                    afw::geom::ellipses::Ellipse const & ellipse,
                    ndarray::Array<double const,1,1> const & coefficients
                ) const {
                    MultiShapeletFunction result;
                    for (Iterator i = begin(); i != end(); ++i) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
113  <a href="#397f9519">397f9519</a> -         result.getElements().push_back(ShapeletFunction(i->getOrder(), HERMITE, ellipse));</div>
              ?                   ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#b4ea1017">b4ea1017</a> +         result.getComponents().push_back(ShapeletFunction(i->getOrder(), HERMITE, ellipse));</div>
              ?                   ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
114  <a href="#397f9519">397f9519</a> -         result.getElements().back().getEllipse().getCore().scale(i->getRadius());</div>
              ?                   ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
111  <a href="#b4ea1017">b4ea1017</a> +         result.getComponents().back().getEllipse().getCore().scale(i->getRadius());</div>
              ?                   ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#397f9519">397f9519</a> -         result.getElements().back().getCoefficients().asEigen()</div>
              ?                   ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
112  <a href="#b4ea1017">b4ea1017</a> +         result.getComponents().back().getCoefficients().asEigen()</div>
              ?                   ^^ +++
                            = i->getMatrix().asEigen() * coefficients.asEigen();
                    }
                    return result;
                }
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
121  <a href="#397f9519">397f9519</a> - namespace {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
122  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
123  <a href="#397f9519">397f9519</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
124  <a href="#397f9519">397f9519</a> - struct MatrixBuilderItem : public MultiShapeletBasis::Component {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
125  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#397f9519">397f9519</a> -     MatrixBuilderItem(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
127  <a href="#397f9519">397f9519</a> -         MultiShapeletBasis::Component const & basisComponent,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#397f9519">397f9519</a> -         PTR(GaussHermiteConvolution) convolution_</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
129  <a href="#397f9519">397f9519</a> -     ) : MultiShapeletBasis::Component(basisComponent),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
130  <a href="#397f9519">397f9519</a> -         convolution(convolution_)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
131  <a href="#397f9519">397f9519</a> -     {}</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
132  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
133  <a href="#397f9519">397f9519</a> -     PTR(GaussHermiteConvolution) convolution;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
134  <a href="#397f9519">397f9519</a> -     ndarray::Array<T,2,-1> workspace;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
135  <a href="#397f9519">397f9519</a> - };</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
136  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
137  <a href="#397f9519">397f9519</a> - } // anonymous</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
138  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
139  <a href="#397f9519">397f9519</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
140  <a href="#397f9519">397f9519</a> - class MultiShapeletMatrixBuilder<T>::Impl {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
141  <a href="#397f9519">397f9519</a> - public:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
142  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
143  <a href="#397f9519">397f9519</a> -     typedef std::vector< MatrixBuilderItem<T> > ItemVector;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
145  <a href="#397f9519">397f9519</a> -     Impl(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
146  <a href="#397f9519">397f9519</a> -         ndarray::Array<T const,1,1> const & x,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
147  <a href="#84dd053e">84dd053e</a> -         ndarray::Array<T const,1,1> const & y,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#f7d496bb">f7d496bb</a> -         int basisSize_,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
149  <a href="#84dd053e">84dd053e</a> -         bool useApproximateExp</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#f7d496bb">f7d496bb</a> -     ) : basisSize(basisSize_), dataSize(x.template getSize<0>()), modelBuilder(x, y, useApproximateExp) {}</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
151  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
152  <a href="#f7d496bb">f7d496bb</a> -     int basisSize;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#f7d496bb">f7d496bb</a> -     int dataSize;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
154  <a href="#397f9519">397f9519</a> -     ModelBuilder<T> modelBuilder;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
155  <a href="#397f9519">397f9519</a> -     ItemVector items;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#397f9519">397f9519</a> - };</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
157  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
158  <a href="#397f9519">397f9519</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#397f9519">397f9519</a> - void MultiShapeletMatrixBuilder<T>::build(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
160  <a href="#397f9519">397f9519</a> -     ndarray::Array<T,2,-1> const & output,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#397f9519">397f9519</a> -     afw::geom::ellipses::Ellipse const & ellipse</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
162  <a href="#397f9519">397f9519</a> - ) const {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#397f9519">397f9519</a> -     output.asEigen().setZero();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#397f9519">397f9519</a> -     for (typename Impl::ItemVector::const_iterator i = _impl->items.begin(); i != _impl->items.end(); ++i) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
165  <a href="#a853d427">a853d427</a> -         afw::geom::ellipses::Ellipse itemEllipse</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#a853d427">a853d427</a> -             = afw::geom::ellipses::Ellipse(afw::geom::ellipses::Quadrupole(0.0, 0.0, 0.0),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
167  <a href="#a853d427">a853d427</a> -                                            ellipse.getCenter());</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#a853d427">a853d427</a> -         if (ellipse.getCore().getDeterminantRadius() >= 0.0) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
169  <a href="#a853d427">a853d427</a> -             itemEllipse = ellipse;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
170  <a href="#a853d427">a853d427</a> -         }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
171  <a href="#397f9519">397f9519</a> -         itemEllipse.getCore().scale(i->getRadius());</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
172  <a href="#397f9519">397f9519</a> -         ndarray::Array<double const,2,2> convolution = i->convolution->evaluate(itemEllipse);</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
173  <a href="#3296f817">3296f817</a> -         if (!(itemEllipse.getCore().getDeterminantRadius() >= 0.0)) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
174  <a href="#3296f817">3296f817</a> -             throw LSST_EXCEPT(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
175  <a href="#3296f817">3296f817</a> -                 pex::exceptions::UnderflowErrorException,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
176  <a href="#3296f817">3296f817</a> -                 "Underflow error in ellipse scaling/convolution"</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
177  <a href="#3296f817">3296f817</a> -             );</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
178  <a href="#3296f817">3296f817</a> -         }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
179  <a href="#397f9519">397f9519</a> -         i->workspace.asEigen().setZero();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
180  <a href="#397f9519">397f9519</a> -         _impl->modelBuilder.update(itemEllipse);</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
181  <a href="#397f9519">397f9519</a> -         _impl->modelBuilder.addModelMatrix(i->convolution->getRowOrder(), i->workspace);</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
182  <a href="#397f9519">397f9519</a> -         Eigen::Matrix<T,Eigen::Dynamic,Eigen::Dynamic> rhs</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
183  <a href="#397f9519">397f9519</a> -             = (convolution.asEigen() * i->getMatrix().asEigen()).template cast<T>();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
184  <a href="#397f9519">397f9519</a> -         output.asEigen() += i->workspace.asEigen() * rhs;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
185  <a href="#397f9519">397f9519</a> -     }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
186  <a href="#397f9519">397f9519</a> - }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
187  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
188  <a href="#397f9519">397f9519</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
189  <a href="#397f9519">397f9519</a> - MultiShapeletMatrixBuilder<T>::MultiShapeletMatrixBuilder(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
190  <a href="#397f9519">397f9519</a> -     MultiShapeletBasis const & basis,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
191  <a href="#397f9519">397f9519</a> -     MultiShapeletFunction const & psf,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#397f9519">397f9519</a> -     ndarray::Array<T const,1,1> const & x,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
193  <a href="#84dd053e">84dd053e</a> -     ndarray::Array<T const,1,1> const & y,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
194  <a href="#84dd053e">84dd053e</a> -     bool useApproximateExp</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
195  <a href="#f7d496bb">f7d496bb</a> - ) : _impl(new Impl(x, y, basis.getSize(), useApproximateExp))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
196  <a href="#397f9519">397f9519</a> - {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
197  <a href="#397f9519">397f9519</a> -     // Add the cartesian product of (basis components) x (PSF elements) to the ItemVector</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
198  <a href="#397f9519">397f9519</a> -     int maxConvolvedOrder = 0;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
199  <a href="#397f9519">397f9519</a> -     for (</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
200  <a href="#397f9519">397f9519</a> -         MultiShapeletFunction::ElementList::const_iterator psfIter = psf.getElements().begin();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
201  <a href="#397f9519">397f9519</a> -         psfIter != psf.getElements().end();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
202  <a href="#397f9519">397f9519</a> -         ++psfIter</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
203  <a href="#397f9519">397f9519</a> -     ) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
204  <a href="#397f9519">397f9519</a> -         int lastBasisOrder = -1;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
205  <a href="#397f9519">397f9519</a> -         PTR(GaussHermiteConvolution) convolution;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
206  <a href="#397f9519">397f9519</a> -         for (MultiShapeletBasis::Iterator basisIter = basis.begin(); basisIter != basis.end(); ++basisIter) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
207  <a href="#397f9519">397f9519</a> -             if (basisIter->getOrder() != lastBasisOrder) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
208  <a href="#397f9519">397f9519</a> -                 convolution.reset(new GaussHermiteConvolution(basisIter->getOrder(), *psfIter));</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
209  <a href="#397f9519">397f9519</a> -                 lastBasisOrder = basisIter->getOrder();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
210  <a href="#397f9519">397f9519</a> -                 maxConvolvedOrder = std::max(convolution->getRowOrder(), maxConvolvedOrder);</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
211  <a href="#397f9519">397f9519</a> -             }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
212  <a href="#397f9519">397f9519</a> -             _impl->items.push_back(MatrixBuilderItem<T>(*basisIter, convolution));</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
213  <a href="#397f9519">397f9519</a> -         }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
214  <a href="#397f9519">397f9519</a> -     }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
215  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
216  <a href="#397f9519">397f9519</a> -     // Loop over the ItemVector one more time to set up workspace arrays with which to call</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
217  <a href="#397f9519">397f9519</a> -     // ModelBuilder.  We allocate one big array with the maximum workspace, then give each</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
218  <a href="#397f9519">397f9519</a> -     // item a view into it that only contains as much as it needs.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
219  <a href="#397f9519">397f9519</a> -     ndarray::Array<T,2,2> fullWorkspaceT = ndarray::allocate(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
220  <a href="#397f9519">397f9519</a> -         computeSize(maxConvolvedOrder), x.template getSize<0>()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
221  <a href="#397f9519">397f9519</a> -     );</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
222  <a href="#397f9519">397f9519</a> -     ndarray::Array<T,2,-2> fullWorkspace = fullWorkspaceT.transpose();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
223  <a href="#397f9519">397f9519</a> -     for (</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
224  <a href="#397f9519">397f9519</a> -         typename Impl::ItemVector::iterator itemIter = _impl->items.begin();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
225  <a href="#397f9519">397f9519</a> -         itemIter != _impl->items.end();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
226  <a href="#397f9519">397f9519</a> -         ++itemIter</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
227  <a href="#397f9519">397f9519</a> -     ) {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
228  <a href="#397f9519">397f9519</a> -         itemIter->workspace = fullWorkspace[</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
229  <a href="#397f9519">397f9519</a> -             ndarray::view()(0, computeSize(itemIter->convolution->getRowOrder()))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
230  <a href="#397f9519">397f9519</a> -         ];</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
231  <a href="#397f9519">397f9519</a> -     }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
232  <a href="#397f9519">397f9519</a> - }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
233  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
234  <a href="#f7d496bb">f7d496bb</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
235  <a href="#f7d496bb">f7d496bb</a> - int MultiShapeletMatrixBuilder<T>::getDataSize() const { return _impl->dataSize; }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
236  <a href="#f7d496bb">f7d496bb</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
237  <a href="#f7d496bb">f7d496bb</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
238  <a href="#f7d496bb">f7d496bb</a> - int MultiShapeletMatrixBuilder<T>::getBasisSize() const { return _impl->basisSize; }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
239  <a href="#f7d496bb">f7d496bb</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
240  <a href="#397f9519">397f9519</a> - template class MultiShapeletMatrixBuilder<float>;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
241  <a href="#397f9519">397f9519</a> - template class MultiShapeletMatrixBuilder<double>;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
242  <a href="#397f9519">397f9519</a> - </div>
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="f7d496bb"/></a>f7d496bb</h3>

<pre>
commit f7d496bbadc651a4d00494414d3ab52a8cc0301a
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Sep 27 15:49:56 2013 -0400

    Add size getters to MultiShapeletMatrixBuilder
</pre>
<h3><a name="3296f817"/></a>3296f817</h3>

<pre>
commit 3296f817696974a6072d6ed38b3c97a4983d2288
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 3 14:36:18 2014 -0500

    Turn an assert into an exception throw
    
    I'd thought we could always sanitize inputs well enough upstream
    (where we could do so more efficiently) that this would never trigger,
    but that's apparently not the case.
</pre>
<h3><a name="a853d427"/></a>a853d427</h3>

<pre>
commit a853d4270dcb491285e8cb4c6cbbb37e8c05d438
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri May 31 15:58:47 2013 -0400

    Check for NaNs resulting from zero-size ellipses
</pre>
<h3><a name="397f9519"/></a>397f9519</h3>

<pre>
commit 397f9519681a23c37d2d2421f009e66d5b8a3aa4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 13:35:31 2013 -0400

    Add MultiShapeletBasis, MultiShapeletMatrixBuilder classes
</pre>
<h3><a name="84dd053e"/></a>84dd053e</h3>

<pre>
commit 84dd053ebce9df96669c9e35da0eaa60b23cb184
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Apr 25 13:43:37 2013 -0400

    Add fast optional fast approximate exponential support.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
<h3><a name="13feffe1"/></a>13feffe1</h3>

<pre>
commit 13feffe1b704733fdb667b7e4d8f7b5b9e763861
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 17 18:07:31 2014 -0400

    Remove old MultiShapeletMatrixBuilder
    
    This has been replaced by MatrixBuilder
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_8"><a name="src/GaussHermiteEvaluator.cc"/></a>src/GaussHermiteEvaluator.cc</h1>

<h3 id="toc_9">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/GaussHermiteEvaluator.h"
                #include "lsst/afw/geom/Angle.h"
                
                namespace lsst { namespace shapelet {
                
                double const BASIS_NORMALIZATION = std::pow(afw::geom::PI, -0.25);
                
                namespace {
                
                /**
                 *  @brief An iterator-like construct for evaluating either normalized Hermite polynomials or
                 *         Gauss-Hermite functions at a point.
                 */
                class HermiteRecurrenceRelation {
                public:
                
                    static int const computeSize(int order) { return order + 1; }
                
                    /// @brief Return the value of the shapelet basis function at the current order.
                    double operator()() const { return _current; }
                
                    /// @brief Increase the order of the recurrence relation by one.
                    HermiteRecurrenceRelation & operator++() {
                        double copy = _current;
                        ++_order;
                        _current = rationalSqrt(2, _order)*_x*_current - rationalSqrt(_order - 1, _order)*_previous;
                        _previous = copy;
                        return *this;
                    }
                
                    /// @brief Return the current order of the recursion relation.
                    int const getOrder() const { return _order; }
                
                    /// @brief Initialize a recurrence relation at the given point.
                    HermiteRecurrenceRelation(double x, double amplitude) :
                        _order(0), _x(x), _current(amplitude), _previous(0.0) {}
                
                private:
                    int _order;
                    double _x;
                    double _current;
                    double _previous;
                };
                
                void fillEvaluation1d(
                    ndarray::Array<double,1,1> const & result,
                    double x,
                    ndarray::Array<double,1,1> const & dx = ndarray::Array<double,1,1>()
                ) {
                    HermiteRecurrenceRelation r(x, BASIS_NORMALIZATION * std::exp(-0.5*x*x));
                    ndarray::Array<double,1,1>::Iterator const end = result.end();
                    for (ndarray::Array<double,1,1>::Iterator i = result.begin(); i != end; ++i, ++r) {
                        *i = r();
                    }
                    if (!dx.isEmpty() && dx.getSize<0>() > 0) {
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#6f3a3a3c">6f3a3a3c</a> +         LSST_THROW_IF_NE(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#c074a431">c074a431</a> -         assert(dx.getSize<0>() == result.getSize<0>());</div>
              ?         ^^^^^^^               ^^^                    ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#6f3a3a3c">6f3a3a3c</a> +             dx.getSize<0>(), result.getSize<0>(),</div>
              ?         ^^^^               ^                    ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#6f3a3a3c">6f3a3a3c</a> +             "Derivative output size (%d) does not match main output side (%d)"</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#6f3a3a3c">6f3a3a3c</a> +         );</div>
                        dx[0] = -x * result[0];
                        for (int n = 1; n < result.getSize<0>(); ++n) {
                            dx[n] = -x * result[n] + intSqrt(2*n) * result[n - 1];
                        }
                    }
                }
                
                void fillIntegration1d(ndarray::Array<double,1,1> const & result, int moment) {
                    int const order = result.getSize<0>() - 1;
                    result.deep() = 0.0;
                    result[0] = std::pow(4.0 * afw::geom::PI, 0.25);
                    for (int n = 2; n <= order; n += 2) {
                        result[n] = rationalSqrt(n - 1, n) * result[n-2];
                    }
                    if (moment > 0) {
                        // since result is only nonzero for (m+n) even, we store both n,m and n-1,m-1 in the same vector
                        for (int n = 1; n <= order; n += 2) {
                            result[n] = result[n-1] * intSqrt(2*n);
                        }
                        for (int m = 2; m <= moment; ++m) {
                            if (m % 2 == 0) result[0] *= (m-1);
                            for (int n = 2 - (m % 2); n <= order; n += 2) {
                                result[n] = (m-1) * result[n] + intSqrt(2*n) * result[n-1];
                            }
                        }
                        // zero the elements corresponding to n-1,m-1
                        for (int n = !(moment % 2); n <= order; n += 2) result[n] = 0.0;
                    }
                }
                
                Eigen::MatrixXd computeInnerProductMatrix1d(int rowOrder, int colOrder, double a, double b) {
                    Eigen::MatrixXd result = Eigen::MatrixXd::Zero(rowOrder + 1, colOrder + 1);
                    double v = 1.0 / (a*a + b*b);
                    double f1 = 2.0 * a * b * v;
                    double f2 = (a*a - b*b) * v;
                    result(0, 0) = intSqrt(2 * v);
                    for (int j = 2; j <= rowOrder; j += 2) {
                        result(j, 0) = f2 * rationalSqrt(j-1, j) * result(j-2, 0);
                    }
                    for (int k = 2; k <= colOrder; k += 2) {
                        result(0, k) = -f2 * rationalSqrt(k-1, k) * result(0, k-2);
                    }
                    if (rowOrder > 0 && colOrder > 0) result(1, 1) = f1 * result(0,0);
                    if (colOrder > 0) {
                        for (int j = 3; j <= rowOrder; j += 2) {
                            result(j, 1) = f1 * intSqrt(j) * result(j-1, 0);
                        }
                    }
                    if (rowOrder > 0) {
                        for (int k = 3; k <= colOrder; k += 2) {
                            result(1, k) = f1 * intSqrt(k) * result(0, k-1);
                        }
                    }
                    for (int j = 2; j <= rowOrder; ++j) {
                        double q2 = rationalSqrt(j-1, j);
                        if (j <= colOrder) {
                            result(j, j) = f1 * result(j-1, j-1) + f2 * q2 * result(j-2, j);
                        }
                        for (int k = (j%2) + 2; k <= colOrder; k += 2) {
                            double q1 = rationalSqrt(k, j);
                            result(j, k) = f1 * q1 * result(j-1, k-1) + f2 * q2 * result(j-2, k);
                        }
                    }
                    return result;
                }
                
                void weaveFill(
                    ndarray::Array<double,1> const & target,
                    ndarray::Array<double const,1,1> const & x,
                    ndarray::Array<double const,1,1> const & y
                ) {
                    int const order = x.getSize<0>() - 1;
                    for (PackedIndex i; i.getOrder() <= order; ++i) {
                        target[i.getIndex()] = x[i.getX()] * y[i.getY()];
                    }
                }
                
                double weaveSum(
                    ndarray::Array<double const,1> const & target,
                    ndarray::Array<double const,1,1> const & x,
                    ndarray::Array<double const,1,1> const & y
                ) {
                    double r = 0.0;
                    int const order = x.getSize<0>() - 1;
                    for (PackedIndex i; i.getOrder() <= order; ++i) {
                        r += target[i.getIndex()] * x[i.getX()] * y[i.getY()];
                    }
                    return r;
                }
                
                } // anonymous    
                
                void GaussHermiteEvaluator::fillEvaluation(
                    ndarray::Array<double,1> const & target, double x, double y,
                    ndarray::Array<double,1> const & dx,
                    ndarray::Array<double,1> const & dy 
                ) const {
                    if (dx.isEmpty()) {
                        fillEvaluation1d(_xWorkspace, x);
                    } else {
                        fillEvaluation1d(_xWorkspace, x, _dxWorkspace);
                    }
                    if (dy.isEmpty()) {
                        fillEvaluation1d(_yWorkspace, y);
                    } else {
                        fillEvaluation1d(_yWorkspace, y, _dyWorkspace);
                    }
                    weaveFill(target, _xWorkspace, _yWorkspace);
                    if (!dx.isEmpty()) weaveFill(dx, _dxWorkspace, _yWorkspace);
                    if (!dy.isEmpty()) weaveFill(dy, _xWorkspace, _dyWorkspace);
                }
                
                void GaussHermiteEvaluator::fillIntegration(
                    ndarray::Array<double,1> const & target, int xMoment, int yMoment
                ) const {
                    fillIntegration1d(_xWorkspace, xMoment);
                    fillIntegration1d(_yWorkspace, yMoment);
                    return weaveFill(target, _xWorkspace, _yWorkspace);
                }
                
                double GaussHermiteEvaluator::sumEvaluation(
                    ndarray::Array<double const,1> const & coeff, double x, double y,
                    double * dx, double * dy
                ) const {
                    if (!dx) {
                        fillEvaluation1d(_xWorkspace, x);
                    } else {
                        fillEvaluation1d(_xWorkspace, x, _dxWorkspace);
                    }
                    if (!dy) {
                        fillEvaluation1d(_yWorkspace, y);
                    } else {
                        fillEvaluation1d(_yWorkspace, y, _dyWorkspace);
                    }
                    if (dx) *dx = weaveSum(coeff, _dxWorkspace, _yWorkspace);
                    if (dy) *dy = weaveSum(coeff, _xWorkspace, _dyWorkspace);
                    return weaveSum(coeff, _xWorkspace, _yWorkspace);
                }
                
                double GaussHermiteEvaluator::sumIntegration(
                    ndarray::Array<double const,1> const & coeff, int xMoment, int yMoment
                ) const {
                    fillIntegration1d(_xWorkspace, xMoment);
                    fillIntegration1d(_yWorkspace, yMoment);
                    return weaveSum(coeff, _xWorkspace, _yWorkspace);
                }
                
                GaussHermiteEvaluator::GaussHermiteEvaluator(int order) :
                    _xWorkspace(ndarray::allocate(order + 1)),
                    _yWorkspace(ndarray::allocate(order + 1)),
                    _dxWorkspace(ndarray::allocate(order + 1)),
                    _dyWorkspace(ndarray::allocate(order + 1))
                {}
                
                Eigen::MatrixXd GaussHermiteEvaluator::computeInnerProductMatrix(
                    int rowOrder, int colOrder, double a, double b
                ) {
                    Eigen::MatrixXd result = Eigen::MatrixXd::Zero(computeSize(rowOrder), computeSize(colOrder));
                    Eigen::MatrixXd m = computeInnerProductMatrix1d(rowOrder, colOrder, a, b);
                    for (PackedIndex i; i.getOrder() <= rowOrder; ++i) {
                        for (PackedIndex j; j.getOrder() <= colOrder; ++j) {
                            result(i.getIndex(), j.getIndex()) = m(i.getX(), j.getX()) * m(i.getY(), j.getY());
                        }
                    }
                    return result;
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="c074a431"/></a>c074a431</h3>

<pre>
commit c074a431dc6b344cd0b789d452c325369f24a210
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 26 17:19:05 2012 -0400

    added derivative computation to HermiteEvaluator
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
<h3><a name="6f3a3a3c"/></a>6f3a3a3c</h3>

<pre>
commit 6f3a3a3cf397252343bae32bdd8e91c9c8e73ded
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sun May 18 20:51:42 2014 -0400

    Convert asserts accessible from outside code into exception-based checks.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_10"><a name="include/lsst/shapelet/MultiShapeletFunction.h"/></a>include/lsst/shapelet/MultiShapeletFunction.h</h1>

<h3 id="toc_11">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                #ifndef LSST_AFW_MATH_SHAPELETS_MULTISHAPELETFUNCTION_H
                #define LSST_AFW_MATH_SHAPELETS_MULTISHAPELETFUNCTION_H
                
                #include "lsst/shapelet/ShapeletFunction.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
29   <a href="#0f0a1cf0">0f0a1cf0</a> - #include <list></div>
              ?           ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
29   <a href="#e547711b">e547711b</a> + #include <vector></div>
              ?           ^^^ ++
                
                namespace lsst { namespace shapelet {
                
                class MultiShapeletFunctionEvaluator;
                
                /**
                 *  @brief A multi-scale shapelet function.
                 */
                class MultiShapeletFunction {
                public:
                
                    typedef boost::shared_ptr<MultiShapeletFunction> Ptr;
                    typedef boost::shared_ptr<MultiShapeletFunction const> ConstPtr;
                
                    typedef MultiShapeletFunctionEvaluator Evaluator;
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#ecb24f66">ecb24f66</a> -     typedef ShapeletFunction Element;</div>
              ?                              ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#b4ea1017">b4ea1017</a> +     typedef ShapeletFunction Component;</div>
              ?                              ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#0f0a1cf0">0f0a1cf0</a> -     typedef std::list<Element> ElementList;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#b4ea1017">b4ea1017</a> +     typedef std::vector<Component> ComponentList;</div>
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
50   <a href="#0f0a1cf0">0f0a1cf0</a> -     ElementList & getElements() { return _elements; }</div>
              ?     ^^^              ^^^                  ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
50   <a href="#b4ea1017">b4ea1017</a> +     ComponentList & getComponents() { return _components; }</div>
              ?     ^^ +++             ^^ +++                 ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#0f0a1cf0">0f0a1cf0</a> -     ElementList const & getElements() const { return _elements; }</div>
              ?     ^^^                    ^^^                        ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#b4ea1017">b4ea1017</a> +     ComponentList const & getComponents() const { return _components; }</div>
              ?     ^^ +++                   ^^ +++                       ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#bb928df3">bb928df3</a> -     /// @brief Normalize the integral of the shapelet function to the given value.</div>
              ?                                                                   ^^^^^^^^^^^^^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#ec91c8a7">ec91c8a7</a> +     /// @brief Normalize the integral of the shapelet function to 1.</div>
              ?                                                                   ^
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#bb928df3">bb928df3</a> -     void normalize(double value=1.0);</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#ec91c8a7">ec91c8a7</a> +     void normalize();</div>
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#18295e0f">18295e0f</a> -     /// @brief Shift the shapelet function by shifting the ellipse of each element.</div>
              ?                                                                            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#b4ea1017">b4ea1017</a> +     /// @brief Shift the shapelet function by shifting the ellipse of each component.</div>
              ?                                                                            ^^ +++
                    void shiftInPlace(afw::geom::Extent2D const & offset);
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#18295e0f">18295e0f</a> -     /// @brief Transform the shapelet function by transforming the ellipse of each elements.</div>
              ?                                                                                    ^^^    -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#b4ea1017">b4ea1017</a> +     /// @brief Transform the shapelet function by transforming the ellipse of each component.</div>
              ?                                                                                    ^^ +++
                    void transformInPlace(afw::geom::AffineTransform const & transform);
                
                    /// @brief Convolve the multi-shapelet function.
                    MultiShapeletFunction convolve(ShapeletFunction const & other) const;
                
                    /// @brief Convolve the multi-shapelet function.
                    MultiShapeletFunction convolve(MultiShapeletFunction const & other) const;
                
                    /// @brief Construct a helper object that can efficiently evaluate the function.
                    Evaluator evaluate() const;
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#ec91c8a7">ec91c8a7</a> -     MultiShapeletFunction() : _elements() {}</div>
              ?                                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#b4ea1017">b4ea1017</a> +     MultiShapeletFunction() : _components() {}</div>
              ?                                ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#0f0a1cf0">0f0a1cf0</a> -     explicit MultiShapeletFunction(ElementList const & elements) : _elements(elements) {}</div>
              ?                                    ^^^                 ^^^          ^^^      ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#b4ea1017">b4ea1017</a> +     explicit MultiShapeletFunction(ComponentList const & components) : _components(components) {}</div>
              ?                                    ^^ +++                ^^ +++         ^^ +++     ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#7a18a429">7a18a429</a> -     explicit MultiShapeletFunction(ShapeletFunction const & element) : _elements(1, element) {}</div>
              ?                                                             ^^^         ^^^         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#b4ea1017">b4ea1017</a> +     explicit MultiShapeletFunction(ShapeletFunction const & component) : _components(1, component) {}</div>
              ?                                                             ^^ +++        ^^ +++        ^^ +++
                
                private:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#0f0a1cf0">0f0a1cf0</a> -     ElementList _elements;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#b4ea1017">b4ea1017</a> +     ComponentList _components;</div>
                };
                
                /**
                 *  @brief Evaluates a MultiShapeletFunction.
                 *
                 *  This is distinct from MultiShapeletFunction to allow the evaluator to construct temporaries
                 *  and allocate workspace that will be reused when evaluating at multiple points.
                 *
                 *  A MultiShapeletFunctionEvaluator is invalidated whenever the MultiShapeletFunction it
                 *  was constructed from is modified.
                 */
                class MultiShapeletFunctionEvaluator {
                public:
                
                    typedef boost::shared_ptr<MultiShapeletFunctionEvaluator> Ptr;
                    typedef boost::shared_ptr<MultiShapeletFunctionEvaluator const> ConstPtr;
                
                    /// @brief Evaluate at the given point.
                    double operator()(double x, double y) const {
                        return this->operator()(afw::geom::Point2D(x, y));
                    }
                
                    /// @brief Evaluate at the given point.
                    double operator()(afw::geom::Point2D const & point) const;
                
                    /// @brief Evaluate at the given point.
                    double operator()(afw::geom::Extent2D const & point) const;
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#ffb98db0">ffb98db0</a> +     /// @brief Evaluate at the given points, returning a newly-allocated array.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double,1,1> operator()(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#ffb98db0">ffb98db0</a> +         ndarray::Array<double const,1> const & x,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
111  <a href="#ffb98db0">ffb98db0</a> +         ndarray::Array<double const,1> const & y</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
112  <a href="#ffb98db0">ffb98db0</a> +     ) const;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
113  <a href="#ffb98db0">ffb98db0</a> + </div>
                    /// @brief Add the function to the given image-like array.
                    void addToImage(
                        ndarray::Array<double,2,1> const & array,
                        afw::geom::Point2I const & xy0 = afw::geom::Point2I()
                    ) const;
                
                    /// @brief Evaluate the function on the given image.
                    void addToImage(afw::image::Image<double> & image) const {
                        addToImage(image.getArray(), image.getXY0());
                    }
                
                    /// @brief Compute the definite integral or integral moments.
                    double integrate() const;
                
                    /// @brief Return the unweighted dipole and quadrupole moments of the function as an ellipse.
                    afw::geom::ellipses::Ellipse computeMoments() const;
                
                    /// @brief Update the evaluator from the given function.
                    void update(MultiShapeletFunction const & function);
                
                    /// @brief Construct an evaluator for the given function.
                    explicit MultiShapeletFunctionEvaluator(MultiShapeletFunction const & function);
                
                private:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
132  <a href="#ecb24f66">ecb24f66</a> -     typedef ShapeletFunctionEvaluator Element;</div>
              ?                                       ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
138  <a href="#b4ea1017">b4ea1017</a> +     typedef ShapeletFunctionEvaluator Component;</div>
              ?                                       ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
133  <a href="#0f0a1cf0">0f0a1cf0</a> -     typedef std::list<Element> ElementList;</div>
              ?                       ^^^      ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
139  <a href="#b4ea1017">b4ea1017</a> +     typedef std::list<Component> ComponentList;</div>
              ?                       ^^ +++     ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
134  <a href="#0f0a1cf0">0f0a1cf0</a> -     ElementList _elements;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
140  <a href="#b4ea1017">b4ea1017</a> +     ComponentList _components;</div>
                };
                
                inline MultiShapeletFunctionEvaluator MultiShapeletFunction::evaluate() const {
                    return MultiShapeletFunctionEvaluator(*this);
                }
                
                }} // namespace lsst::shapelet
                
                #endif // !defined(LSST_AFW_MATH_SHAPELETS_MULTISHAPELETFUNCTION_H)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="0f0a1cf0"/></a>0f0a1cf0</h3>

<pre>
commit 0f0a1cf0781cf190f5649834ded5715bf0b6b09e
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Wed Feb 23 04:06:18 2011 +0000

    afw #1556 - minor updates to shapelets to support compound basis in meas/multifit
</pre>
<h3><a name="18295e0f"/></a>18295e0f</h3>

<pre>
commit 18295e0fc280fe91e4250bd42fd1be8ce535c100
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Fri Mar 18 18:06:49 2011 +0000

    afw #1556 - added transformation functions to shapelets
</pre>
<h3><a name="ecb24f66"/></a>ecb24f66</h3>

<pre>
commit ecb24f66d5d17e3b7b3861eb13d8ba2175f33ada
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Tue Feb 22 19:17:04 2011 +0000

    afw #1556 - moved ShapeletConvolution to afw as HermiteConvolution, added MultiShapeletFunction
</pre>
<h3><a name="7a18a429"/></a>7a18a429</h3>

<pre>
commit 7a18a42949d3e604331294574ece55abf4a8293a
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Fri Mar 11 01:43:16 2011 +0000

    afw #1556 - added tests and fixes for FootprintArray (including an incorrect-area bug in Footprint itself), tweaked LocalPsf API
</pre>
<h3><a name="bb928df3"/></a>bb928df3</h3>

<pre>
commit bb928df3fc2fafe5183e0d075da19994f0af4fc7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 17 16:57:27 2013 -0400

    Let the value to normalize to be specified in [Multi]ShapeletFunction
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="e547711b"/></a>e547711b</h3>

<pre>
commit e547711bf53abb33670d1c920cbb02ee41ae351b
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sat May 10 22:12:20 2014 -0400

    Switch from std::list to std::vector in MultiShapeletFunction.
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
<h3><a name="ffb98db0"/></a>ffb98db0</h3>

<pre>
commit ffb98db06b303dfd6da0d9e5a211704b29571f67
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 15 17:41:47 2014 -0400

    Add vectorized evaluation to [Multi]ShapeletFunction
    
    This is still not the most efficient method of shapelet
    evaluation (that's MatrixBuilder), but it's faster and more
    convenient than looping over pixels in Python.
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_12"><a name="python/lsst/shapelet/tests.py"/></a>python/lsst/shapelet/tests.py</h1>

<h3 id="toc_13">Diff:</h3>

<pre>
                #
                # LSST Data Management System
                # Copyright 2008-2013 LSST Corporation.
                #
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                #
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                #
                # You should have received a copy of the LSST License Statement and
                # the GNU General Public License along with this program.  If not,
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                """
                Test utility code for shapelets library; here so it can be used
                in multiple test scripts and tests in downstream packages.
                """
                
                import numpy
                try:
                    import scipy.ndimage
                except ImportError:
                    scipy = None
                
                import lsst.utils.tests
                import lsst.afw.geom
                import lsst.afw.geom.ellipses
                
                class ShapeletTestCase(lsst.utils.tests.TestCase):
                
                    @staticmethod
                    def makeUnitVector(i, n):
                        v = numpy.zeros(n, dtype=float)
                        v[i] = 1.0
                        return v
                
                    @staticmethod
                    def makeImage(function, x, y):
                        z = numpy.zeros((y.size, x.size), dtype=float)
                        e = function.evaluate()
                        for i, py in enumerate(y):
                            for j, px in enumerate(x):
                                z[i,j] = e(float(px), float(py))
                        return z
                
                    @staticmethod
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#dd26dea3">dd26dea3</a> -     def makeRandomShapeletFunction(order=2, zeroCenter=False):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#c72c8db0">c72c8db0</a> +     def makeRandomShapeletFunction(order=2, zeroCenter=False, ellipse=None, scale=1.0):</div>
              ?                                                             +++++++++++++++++++++++++
                        center = lsst.afw.geom.Point2D()
                        if not zeroCenter:
                            center = lsst.afw.geom.Point2D(numpy.random.randn(), numpy.random.randn())
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#c72c8db0">c72c8db0</a> +         if ellipse is None:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#dd26dea3">dd26dea3</a> -         ellipse = lsst.afw.geom.ellipses.Ellipse(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#c72c8db0">c72c8db0</a> +             ellipse = lsst.afw.geom.ellipses.Ellipse(</div>
              ? ++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#dd26dea3">dd26dea3</a> -             lsst.afw.geom.ellipses.Axes(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#c72c8db0">c72c8db0</a> +                 lsst.afw.geom.ellipses.Axes(</div>
              ? ++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=1, high=2)),</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#c72c8db0">c72c8db0</a> +                     float(numpy.random.uniform(low=1, high=2)),</div>
              ? ++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=1, high=2)),</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#c72c8db0">c72c8db0</a> +                     float(numpy.random.uniform(low=1, high=2)),</div>
              ? ++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=0, high=numpy.pi))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
65   <a href="#c72c8db0">c72c8db0</a> +                     float(numpy.random.uniform(low=0, high=numpy.pi))</div>
              ? ++++
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#c72c8db0">c72c8db0</a> +                     ),</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#c72c8db0">c72c8db0</a> +                 center</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
65   <a href="#dd26dea3">dd26dea3</a> -                 ),</div>
              ?                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
68   <a href="#c72c8db0">c72c8db0</a> +                 )</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#dd26dea3">dd26dea3</a> -             center</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#dd26dea3">dd26dea3</a> -             )</div>
                        coefficients = numpy.random.randn(lsst.shapelet.computeSize(order))
                        result = lsst.shapelet.ShapeletFunction(order, lsst.shapelet.HERMITE, coefficients)
                        result.setEllipse(ellipse)
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#c72c8db0">c72c8db0</a> +         result.getEllipse().scale(scale)</div>
                        return result
                
                    @staticmethod
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#dd26dea3">dd26dea3</a> -     def makeRandomMultiShapeletFunction(nElements=3):</div>
              ?                                          ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#b4ea1017">b4ea1017</a> +     def makeRandomMultiShapeletFunction(nComponents=3, ellipse=None):</div>
              ?                                          ^^ +++      ++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
75   <a href="#dd26dea3">dd26dea3</a> -         elements = []</div>
              ?         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#b4ea1017">b4ea1017</a> +         components = []</div>
              ?         ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#dd26dea3">dd26dea3</a> -         for n in range(nElements):</div>
              ?                         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#b4ea1017">b4ea1017</a> +         for n in range(nComponents):</div>
              ?                         ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#dd26dea3">dd26dea3</a> -             elements.append(ShapeletTestCase.makeRandomShapeletFunction())</div>
              ?             ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#b4ea1017">b4ea1017</a> +             components.append(ShapeletTestCase.makeRandomShapeletFunction(ellipse=ellipse))</div>
              ?             ^^ +++                                                        +++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#dd26dea3">dd26dea3</a> -         return lsst.shapelet.MultiShapeletFunction(elements)</div>
              ?                                                    ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#b4ea1017">b4ea1017</a> +         return lsst.shapelet.MultiShapeletFunction(components)</div>
              ?                                                    ^^ +++
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#dd26dea3">dd26dea3</a> -     def compareShapeletFunctions(self, a, b, rtolEllipse=1E-14, rtolCoeff=1E-14):</div>
              ?                                                              ^                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#f69f469d">f69f469d</a> +     def compareShapeletFunctions(self, a, b, rtolEllipse=1E-13, rtolCoeff=1E-13,</div>
              ?                                                              ^                ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#f69f469d">f69f469d</a> +                                  atolEllipse=1E-14, atolCoeff=1E-14):</div>
                        self.assertEqual(a.getOrder(), b.getOrder())
                        self.assertEqual(a.getBasisType(), b.getBasisType())
                        self.assertClose(a.getEllipse().getParameterVector(), b.getEllipse().getParameterVector(),
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#dd26dea3">dd26dea3</a> -                          rtol=rtolEllipse)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#f69f469d">f69f469d</a> +                          rtol=rtolEllipse, atol=atolEllipse)</div>
              ?                                          ++++++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
85   <a href="#dd26dea3">dd26dea3</a> -         self.assertClose(a.getCoefficients(), b.getCoefficients(), rtol=rtolCoeff)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#f69f469d">f69f469d</a> +         self.assertClose(a.getCoefficients(), b.getCoefficients(), rtol=rtolCoeff, atol=atolCoeff)</div>
              ?                                                                                  ++++++++++++++++
                
                    def simplifyMultiShapeletFunction(self, msf):
                        keep = []
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
89   <a href="#dd26dea3">dd26dea3</a> -         for s in msf.getElements():</div>
              ?                         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
92   <a href="#b4ea1017">b4ea1017</a> +         for s in msf.getComponents():</div>
              ?                         ^^ +++
                            if not numpy.allclose(s.getCoefficients(), 0.0):
                                params = tuple(s.getEllipse().getParameterVector()) + tuple(s.getCoefficients())
                                keep.append((params, s))
                        msf = lsst.shapelet.MultiShapeletFunction()
                        keep.sort(key=lambda t: t[0])
                        for params, s in keep:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#dd26dea3">dd26dea3</a> -             msf.getElements().push_back(s)</div>
              ?                    ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#b4ea1017">b4ea1017</a> +             msf.getComponents().push_back(s)</div>
              ?                    ^^ +++
                        return msf
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#dd26dea3">dd26dea3</a> -     def compareMultiShapeletFunctions(self, a, b, simplify=True, rtolEllipse=1E-14, rtolCoeff=1E-14):</div>
              ?                                                                                  ^                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#f69f469d">f69f469d</a> +     def compareMultiShapeletFunctions(self, a, b, simplify=True, rtolEllipse=1E-13, rtolCoeff=1E-13,</div>
              ?                                                                                  ^                ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
103  <a href="#f69f469d">f69f469d</a> +                                       atolEllipse=1E-14, atolCoeff=1E-14):</div>
                        if simplify:
                            a = self.simplifyMultiShapeletFunction(a)
                            b = self.simplifyMultiShapeletFunction(b)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
103  <a href="#dd26dea3">dd26dea3</a> -         self.assertEqual(a.getElements().size(), b.getElements().size())  </div>
              ?                               ^^^                     ^^^               --
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#f69f469d">f69f469d</a> +         self.assertEqual(a.getComponents().size(), b.getComponents().size())</div>
              ?                               ^^ +++                    ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#dd26dea3">dd26dea3</a> -         for sa, sb in zip(a.getElements(), b.getElements()):</div>
              ?                                ^^^              ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#b4ea1017">b4ea1017</a> +         for sa, sb in zip(a.getComponents(), b.getComponents()):</div>
              ?                                ^^ +++             ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#dd26dea3">dd26dea3</a> -             self.compareShapeletFunctions(sa, sb, rtolEllipse=rtolEllipse, rtolCoeff=rtolCoeff)</div>
              ?                                                                                               ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#f69f469d">f69f469d</a> +             self.compareShapeletFunctions(sa, sb, rtolEllipse=rtolEllipse, rtolCoeff=rtolCoeff,</div>
              ?                                                                                               ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#f69f469d">f69f469d</a> +                                           atolEllipse=atolEllipse, atolCoeff=atolCoeff)</div>
                
                    def checkMoments(self, function, x, y, z):
                        gx, gy = numpy.meshgrid(x, y)
                        m = z.sum()
                        dipole = lsst.afw.geom.Point2D((gx * z).sum() / m, (gy * z).sum() / m)
                        gx -= dipole.getX()
                        gy -= dipole.getY()
                        quadrupole = lsst.afw.geom.ellipses.Quadrupole(
                            (gx**2 * z).sum() / m,
                            (gy**2 * z).sum() / m,
                            (gx * gy * z).sum() / m
                            )
                        imageMoments = lsst.afw.geom.ellipses.Ellipse(quadrupole, dipole)
                        shapeletMoments = function.evaluate().computeMoments()
                        self.assertClose(imageMoments.getCenter().getX(), shapeletMoments.getCenter().getX(), rtol=1E-3)
                        self.assertClose(imageMoments.getCenter().getY(), shapeletMoments.getCenter().getY(), rtol=1E-3)
                        self.assertClose(imageMoments.getCore().getIxx(), shapeletMoments.getCore().getIxx(), rtol=1E-3)
                        self.assertClose(imageMoments.getCore().getIyy(), shapeletMoments.getCore().getIyy(), rtol=1E-3)
                        self.assertClose(imageMoments.getCore().getIxy(), shapeletMoments.getCore().getIxy(), rtol=1E-3)
                        integral = numpy.trapz(numpy.trapz(z, gx, axis=1), y, axis=0)
                        self.assertClose(integral, function.evaluate().integrate(), rtol=1E-3)
                
                    def checkConvolution(self, f1, f2):
                        bbox = lsst.afw.geom.Box2I(lsst.afw.geom.Point2I(-50, -50), lsst.afw.geom.Point2I(50, 50))
                        i1 = lsst.afw.image.ImageD(bbox)
                        f1.evaluate().addToImage(i1)
                        self.assertClose(i1.getArray().sum(), f1.evaluate().integrate(), rtol=1E-3)
                        i2 = lsst.afw.image.ImageD(bbox)
                        f2.evaluate().addToImage(i2)
                        self.assertClose(i2.getArray().sum(), f2.evaluate().integrate(), rtol=1E-3)
                        fc1 = f1.convolve(f2)
                        fc2 = f2.convolve(f1)
                        ic1 = lsst.afw.image.ImageD(bbox)
                        fc1.evaluate().addToImage(ic1)
                        ic2 = lsst.afw.image.ImageD(bbox)
                        fc2.evaluate().addToImage(ic2)
                        self.assertClose(ic1.getArray(), ic2.getArray())
                        out = lsst.afw.image.ImageD(bbox)
                        if scipy is None:
                            print "Skipping convolution test; scipy could not be imported."
                            return
                        # I'm using scipy.ndimage to convolve test images, because I can't figure
                        # out how to make afw do it (afw can convolve images with kernels, but two similarly-sized
                        # are apparently another matter; if I try to make a FixedKernel from one of the images,
                        # I can't even make the operation commutative, let alone correct.
                        scipy.ndimage.convolve(i1.getArray(), i2.getArray(), output=out.getArray(),
                                               mode="constant", cval=0.0)
                        self.assertClose(out.getArray(), ic1.getArray(), rtol=1E-4, atol=1E-5)
                        self.assertClose(out.getArray(), ic2.getArray(), rtol=1E-4, atol=1E-5)
                        return fc1, fc2
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="dd26dea3"/></a>dd26dea3</h3>

<pre>
commit dd26dea31d3178f793602bbedab2b11ecf985291
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 19 14:57:58 2013 -0400

    Refactor and strengthen unit tests
    
    New code in utils makes gives us better control over f.p.
    comparisons.
    
    Split tests into separate files; the original was getting
    too big.  Put utility code in lsst.shapelet.tests so
    downstream packages (e.g. meas_ext*_multiShapelet) can use.
    
    Added tests for Tractor profiles, comparing against GalSim.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f69f469d"/></a>f69f469d</h3>

<pre>
commit f69f469dd097d044a3f018cfa2cd5b12969efa4e
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Oct 8 10:19:10 2014 -0400

    Add absolute tolerances in shapelet comparison functions.
</pre>
<h3><a name="c72c8db0"/></a>c72c8db0</h3>

<pre>
commit c72c8db01e5f271545d9c02ed55225a4111586b9
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Sep 16 16:04:05 2014 -0400

    Make it possible to pass ellipses to testing utility functions
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_14"><a name="include/lsst/shapelet/ShapeletFunction.h"/></a>include/lsst/shapelet/ShapeletFunction.h</h1>

<h3 id="toc_15">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                #ifndef LSST_AFW_MATH_SHAPELETS_SHAPELETFUNCTION_H
                #define LSST_AFW_MATH_SHAPELETS_SHAPELETFUNCTION_H
                
                #include "ndarray.h"
                #include "lsst/shapelet/constants.h"
                #include "lsst/shapelet/GaussHermiteEvaluator.h"
                #include "lsst/shapelet/ConversionMatrix.h"
                #include "lsst/afw/geom.h"
                #include "lsst/afw/geom/ellipses.h"
                #include "lsst/afw/image/Image.h"
                
                #include <list>
                
                namespace lsst { namespace shapelet {
                
                class ShapeletFunctionEvaluator;
                
                /**
                 *  @brief A 2-d function defined by an expansion onto a Gauss-Laguerre or Gauss-Hermite basis.
                 *
                 *  The coefficients are in units of flux, not surface brightness; increasing
                 *  the area of the basis ellipse while leaving the coefficients unchanged will
                 *  decrease the surface brightness by the ratio of the areas of the new and old
                 *  ellipses.  This convention is necessary to ensure that convolution with a
                 *  delta function is sane.  Because the BasisEvaluator class does not deal with
                 *  ellipses, it is necessary to divide its output by R^2 to get the same result
                 *  as a ShapeletFunctionEvaluator whose ellipse has determinant radius of R.
                 *
                 *  The coefficient normalization is not identical to that of a Gaussian, however;
                 *  a zeroth-order ShapeletFunction with its only coefficient value set to 1 has a
                 *  flux of 2.0 * pi^(1/2).  This value is defined as ShapeletFunction::FLUX_FACTOR.
                 *  Of course, to get the flux of a more complex shapelet expansion you have to use
                 *  ShapeletFunctionEvaluator::integrate().
                 *
                 *  Note that the units of the coefficients would have to be radius for basis
                 *  functions with the same ellipse to be orthonormal, but this orthonormality
                 *  isn't very useful, because the basis functions aren't even orthogonal in the
                 *  more common case that the ellipses differ.  However, basis functions defined
                 *  on the unit circle are still orthonormal.
                 */
                class ShapeletFunction {
                public:
                
                    typedef boost::shared_ptr<ShapeletFunction> Ptr;
                    typedef boost::shared_ptr<ShapeletFunction const> ConstPtr;
                
                    typedef ShapeletFunctionEvaluator Evaluator;
                
                    static double const FLUX_FACTOR;
                
                    /// @brief Return the maximum order (inclusive), either @f$n_x + n_y@f$ or @f$p + q@f$.
                    int getOrder() const { return _order; }
                
                    /// @brief Get the ellipse (const).
                    afw::geom::ellipses::Ellipse const & getEllipse() const { return _ellipse; }
                
                    /// @brief Get the ellipse (non-const).
                    afw::geom::ellipses::Ellipse & getEllipse() { return _ellipse; }
                
                    /// @brief Set the ellipse.
                    void setEllipse(afw::geom::ellipses::Ellipse const & ellipse) { _ellipse = ellipse; }
                    
                    /// @brief Return the basis type (HERMITE or LAGUERRE).
                    BasisTypeEnum getBasisType() const { return _basisType; }
                
                    /// @brief Change the basis type and convert coefficients in-place correspondingly.
                    void changeBasisType(BasisTypeEnum basisType) {
                        ConversionMatrix::convertCoefficientVector(_coefficients, _basisType, basisType, _order);
                        _basisType = basisType;
                    }
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#bb928df3">bb928df3</a> -     /// @brief Normalize the integral of the shapelet function to the given value.</div>
              ?                                                                   ^^^^^^^^^^^^^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#ec91c8a7">ec91c8a7</a> +     /// @brief Normalize the integral of the shapelet function to 1.</div>
              ?                                                                   ^
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
97   <a href="#bb928df3">bb928df3</a> -     void normalize(double value=1.0);</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
97   <a href="#ec91c8a7">ec91c8a7</a> +     void normalize();</div>
                
                    /// @brief Return the coefficient vector.
                    ndarray::Array<double,1,1> const getCoefficients() { return _coefficients; }
                
                    /// @brief Return the coefficient vector (const).
                    ndarray::Array<double const,1,1> const getCoefficients() const { return _coefficients; }
                
                    /// @brief Convolve the shapelet function.
                    ShapeletFunction convolve(ShapeletFunction const & other) const;
                
                    /// @brief Construct a helper object that can efficiently evaluate the function.
                    Evaluator evaluate() const;
                
                    /// @brief Shift the shapelet function by shifting the basis ellipse.
                    void shiftInPlace(afw::geom::Extent2D const & offset) {
                        _ellipse.getCenter() += offset;
                    }
                
                    /// @brief Transform the shapelet function by transforming the basis ellipse.
                    void transformInPlace(afw::geom::AffineTransform const & transform) {
                        _ellipse.transform(transform).inPlace();
                    }
                
                    /// @brief Construct a function with a unit-circle ellipse and set all coefficients to zero.
                    ShapeletFunction(int order, BasisTypeEnum basisType);
                
                    /// @brief Construct a function with a unit-circle ellipse and a deep-copied coefficient vector.
                    ShapeletFunction(
                        int order, BasisTypeEnum basisType,
                        ndarray::Array<double,1,1> const & coefficients
                    );
                
                    /// @brief Construct a function with a circular ellipse and set all coefficients to zero.
                    ShapeletFunction(int order, BasisTypeEnum basisType, double radius,
                                     afw::geom::Point2D const & center=afw::geom::Point2D());
                
                    /// @brief Construct a function with a circular ellipse and a deep-copied coefficient vector.
                    ShapeletFunction(
                        int order, BasisTypeEnum basisType, double radius, afw::geom::Point2D const & center,
                        ndarray::Array<double,1,1> const & coefficients
                    );
                
                    /// @brief Construct a function and set all coefficients to zero.
                    ShapeletFunction(int order, BasisTypeEnum basisType,
                        afw::geom::ellipses::Ellipse const & ellipse);
                
                    /// @brief Construct a function with a deep-copied coefficient vector.
                    ShapeletFunction(
                        int order, BasisTypeEnum basisType,
                        afw::geom::ellipses::Ellipse const & ellipse,
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#c91a2a14">c91a2a14</a> -         ndarray::Array<double,1,1> const & coefficients</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#291cbd40">291cbd40</a> +         ndarray::Array<double const,1,1> const & coefficients</div>
              ?                              ++++++
                    );
                
                    /// @brief Copy constructor (deep).
                    ShapeletFunction(ShapeletFunction const & other);
                
                    /// @brief Assignment (deep).
                    ShapeletFunction & operator=(ShapeletFunction const & other);
                
                    /// @brief Default constructor to appease SWIG (used by std::list).  Not for use by users.
                    ShapeletFunction();
                
                private:
                
                    int _order;
                    BasisTypeEnum _basisType;
                    lsst::afw::geom::ellipses::Ellipse _ellipse;
                    ndarray::Array<double,1,1> _coefficients;
                };
                
                /**
                 *  @brief Evaluates a ShapeletFunction.
                 *
                 *  This is distinct from ShapeletFunction to allow the evaluator to construct temporaries
                 *  and allocate workspace that will be reused when evaluating at multiple points.
                 *
                 *  A ShapeletFunctionEvaluator is invalidated whenever the ShapeletFunction it
                 *  was constructed from is modified.
                 */
                class ShapeletFunctionEvaluator {
                public:
                
                    typedef boost::shared_ptr<ShapeletFunctionEvaluator> Ptr;
                    typedef boost::shared_ptr<ShapeletFunctionEvaluator const> ConstPtr;
                
                    /// @brief Evaluate at the given point.
                    double operator()(double x, double y) const {
                        return this->operator()(afw::geom::Point2D(x, y));
                    }
                
                    /// @brief Evaluate at the given point.
                    double operator()(afw::geom::Point2D const & point) const {
                        return _normalization * _h.sumEvaluation(_coefficients, _transform(point));
                    }
                
                    /// @brief Evaluate at the given point.
                    double operator()(afw::geom::Extent2D const & point) const {
                        return _normalization * _h.sumEvaluation(_coefficients, _transform(point));
                    }
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
198  <a href="#ffb98db0">ffb98db0</a> +     /// @brief Evaluate at the given points, returning a newly-allocated array.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
199  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double,1,1> operator()(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
200  <a href="#ffb98db0">ffb98db0</a> +         ndarray::Array<double const,1> const & x,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
201  <a href="#ffb98db0">ffb98db0</a> +         ndarray::Array<double const,1> const & y</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
202  <a href="#ffb98db0">ffb98db0</a> +     ) const;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
203  <a href="#ffb98db0">ffb98db0</a> + </div>
                    /// @brief Add the function to the given image-like array.
                    void addToImage(
                        ndarray::Array<double,2,1> const & array,
                        afw::geom::Point2I const & xy0 = afw::geom::Point2I()
                    ) const;
                
                    /// @brief Evaluate the function on the given image.
                    void addToImage(afw::image::Image<double> & image) const {
                        addToImage(image.getArray(), image.getXY0());
                    }
                
                    /// @brief Compute the definite integral or integral moments.
                    double integrate() const {
                        return _h.sumIntegration(_coefficients);
                    }
                
                    /// @brief Return the unweighted dipole and quadrupole moments of the function as an ellipse.
                    afw::geom::ellipses::Ellipse computeMoments() const;
                
                    /// @brief Update the evaluator from the given function.
                    void update(ShapeletFunction const & function);
                
                    /// @brief Construct an evaluator for the given function.
                    explicit ShapeletFunctionEvaluator(ShapeletFunction const & function);
                
                private:
                    
                    friend class MultiShapeletFunctionEvaluator;
                
                    void _computeRawMoments(double & q0, Eigen::Vector2d & q1, Eigen::Matrix2d & q2) const;
                
                    double _normalization;
                    ndarray::Array<double const,1,1> _coefficients;
                    afw::geom::AffineTransform _transform;
                    GaussHermiteEvaluator _h;
                };
                
                inline ShapeletFunctionEvaluator ShapeletFunction::evaluate() const {
                    return ShapeletFunctionEvaluator(*this);
                }
                
                }} // namespace lsst::shapelet
                
                #endif // !defined(LSST_AFW_MATH_SHAPELETS_SHAPELETFUNCTION_H)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="bb928df3"/></a>bb928df3</h3>

<pre>
commit bb928df3fc2fafe5183e0d075da19994f0af4fc7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 17 16:57:27 2013 -0400

    Let the value to normalize to be specified in [Multi]ShapeletFunction
</pre>
<h3><a name="c91a2a14"/></a>c91a2a14</h3>

<pre>
commit c91a2a148c5c5b9a924e595f786aa219f412b316
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu May 10 16:30:44 2012 -0400

    Removed shapelet::Pixel typedef, refactored ModelBuilder a bit.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="ffb98db0"/></a>ffb98db0</h3>

<pre>
commit ffb98db06b303dfd6da0d9e5a211704b29571f67
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 15 17:41:47 2014 -0400

    Add vectorized evaluation to [Multi]ShapeletFunction
    
    This is still not the most efficient method of shapelet
    evaluation (that's MatrixBuilder), but it's faster and more
    convenient than looping over pixels in Python.
</pre>
<h3><a name="291cbd40"/></a>291cbd40</h3>

<pre>
commit 291cbd40e5127cbaba2946b02c06aa8e85dcff36
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 17:36:11 2014 -0400

    Pass coefficient array to ShapeletFunctor ctor as const
    
    This should always have been a const array, as we copy it and hence never modify
    the original.
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_16"><a name="src/MultiShapeletFunction.cc"/></a>src/MultiShapeletFunction.cc</h1>

<h3 id="toc_17">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/MultiShapeletFunction.h"
                #include "lsst/shapelet/ConversionMatrix.h"
                #include "lsst/pex/exceptions.h"
                #include "ndarray/eigen.h"
                #include <boost/format.hpp>
                
                namespace lsst { namespace shapelet {
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#bb928df3">bb928df3</a> - void MultiShapeletFunction::normalize(double value) {</div>
              ?                                       ------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#d0049163">d0049163</a> + void MultiShapeletFunction::normalize() {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
34   <a href="#bb928df3">bb928df3</a> -     double factor = value / evaluate().integrate();</div>
              ?            ^^^ ^ ----  ^^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
34   <a href="#ec91c8a7">ec91c8a7</a> +     double integral = evaluate().integrate();</div>
              ?            ^^ ^^   ^^
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#ec91c8a7">ec91c8a7</a> -     for (ElementList::iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                        ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                       ^^ +++                    ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#bb928df3">bb928df3</a> -         i->getCoefficients().deep() *= factor;</div>
              ?                                     ^  ^ ^^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#ec91c8a7">ec91c8a7</a> +         i->getCoefficients().deep() /= integral;</div>
              ?                                     ^  ^^^^^^ ^
                    }
                }
                
                void MultiShapeletFunction::shiftInPlace(afw::geom::Extent2D const & offset) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#18295e0f">18295e0f</a> -     for (ElementList::iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                        ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                       ^^ +++                    ^^ +++
                        i->shiftInPlace(offset);
                    }    
                }
                
                void MultiShapeletFunction::transformInPlace(afw::geom::AffineTransform const & transform) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
47   <a href="#18295e0f">18295e0f</a> -     for (ElementList::iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                        ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
47   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                       ^^ +++                    ^^ +++
                        i->transformInPlace(transform);
                    }    
                }
                
                MultiShapeletFunction MultiShapeletFunction::convolve(ShapeletFunction const & other) const {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#9ed8e26f">9ed8e26f</a> -     ElementList newElements;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#b4ea1017">b4ea1017</a> +     ComponentList newComponents;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#9ed8e26f">9ed8e26f</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#9ed8e26f">9ed8e26f</a> -         newElements.push_back(i->convolve(other));</div>
              ?            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#b4ea1017">b4ea1017</a> +         newComponents.push_back(i->convolve(other));</div>
              ?            ^^ +++
                    }
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#9ed8e26f">9ed8e26f</a> -     return MultiShapeletFunction(newElements);</div>
              ?                                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#b4ea1017">b4ea1017</a> +     return MultiShapeletFunction(newComponents);</div>
              ?                                     ^^ +++
                }
                
                MultiShapeletFunction MultiShapeletFunction::convolve(MultiShapeletFunction const & other) const {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#0f0a1cf0">0f0a1cf0</a> -     ElementList newElements;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#b4ea1017">b4ea1017</a> +     ComponentList newComponents;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#0f0a1cf0">0f0a1cf0</a> -     for (ElementList::const_iterator j = other.getElements().begin(); j != other.getElements().end(); ++j) {</div>
              ?          ^^^                                      ^^^                               ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator j = other.getComponents().begin(); j != other.getComponents().end(); ++j) {</div>
              ?          ^^ +++                                     ^^ +++                              ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#9ed8e26f">9ed8e26f</a> -         for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?              ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#b4ea1017">b4ea1017</a> +         for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?              ^^ +++                             ^^ +++                    ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#9ed8e26f">9ed8e26f</a> -             newElements.push_back(i->convolve(*j));</div>
              ?                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#b4ea1017">b4ea1017</a> +             newComponents.push_back(i->convolve(*j));</div>
              ?                ^^ +++
                        }
                    }
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#9ed8e26f">9ed8e26f</a> -     return MultiShapeletFunction(newElements);</div>
              ?                                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#b4ea1017">b4ea1017</a> +     return MultiShapeletFunction(newComponents);</div>
              ?                                     ^^ +++
                }
                
                void MultiShapeletFunctionEvaluator::update(MultiShapeletFunction const & function) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
71   <a href="#ecb24f66">ecb24f66</a> -     _elements.clear();</div>
              ?      ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
71   <a href="#b4ea1017">b4ea1017</a> +     _components.clear();</div>
              ?      ^^ +++
                    for (
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
73   <a href="#0f0a1cf0">0f0a1cf0</a> -         MultiShapeletFunction::ElementList::const_iterator i = function.getElements().begin(); </div>
              ?                                ^^^                                         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
73   <a href="#b4ea1017">b4ea1017</a> +         MultiShapeletFunction::ComponentList::const_iterator i = function.getComponents().begin(); </div>
              ?                                ^^ +++                                        ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#ecb24f66">ecb24f66</a> -         i != function.getElements().end();</div>
              ?                          ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#b4ea1017">b4ea1017</a> +         i != function.getComponents().end();</div>
              ?                          ^^ +++
                        ++i
                    ) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#ecb24f66">ecb24f66</a> -         _elements.push_back(i->evaluate());</div>
              ?          ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#b4ea1017">b4ea1017</a> +         _components.push_back(i->evaluate());</div>
              ?          ^^ +++
                    }
                }
                
                double MultiShapeletFunctionEvaluator::operator()(afw::geom::Point2D const & point) const {
                    double r = 0.0;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#0f0a1cf0">0f0a1cf0</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
                        r += (*i)(point);
                    }
                    return r;
                }
                
                double MultiShapeletFunctionEvaluator::operator()(afw::geom::Extent2D const & point) const {
                    double r = 0.0;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#0f0a1cf0">0f0a1cf0</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
                        r += (*i)(point);
                    }
                    return r;
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#ecb24f66">ecb24f66</a> + }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#ecb24f66">ecb24f66</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
97   <a href="#ffb98db0">ffb98db0</a> + ndarray::Array<double,1,1> MultiShapeletFunctionEvaluator::operator()(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
98   <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double const,1> const & x,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double const,1> const & y</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
100  <a href="#ffb98db0">ffb98db0</a> + ) const {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
101  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double,1,1> output = ndarray::allocate(x.getSize<0>());</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#ffb98db0">ffb98db0</a> +     for (int i = 0, n = x.getSize<0>(); i < n; ++i) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
103  <a href="#ffb98db0">ffb98db0</a> +         output[i] = (*this)(x[i], y[i]);</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#ffb98db0">ffb98db0</a> +     }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#ffb98db0">ffb98db0</a> +     return output;</div>
                }
                
                void MultiShapeletFunctionEvaluator::addToImage(
                    ndarray::Array<double,2,1> const & array,
                    afw::geom::Point2I const & xy0
                ) const {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
101  <a href="#c84bfaa6">c84bfaa6</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
112  <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
                        i->addToImage(array, xy0);
                    }
                }
                
                double MultiShapeletFunctionEvaluator::integrate() const {
                    double r = 0.0;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#0f0a1cf0">0f0a1cf0</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
119  <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
                        r += i->integrate();
                    }
                    return r;
                }
                
                MultiShapeletFunctionEvaluator::MultiShapeletFunctionEvaluator(
                    MultiShapeletFunction const & function
                ) {
                    update(function);
                }
                
                afw::geom::ellipses::Ellipse MultiShapeletFunctionEvaluator::computeMoments() const {
                    double q0 = 0.0;
                    Eigen::Vector2d q1 = Eigen::Vector2d::Zero();
                    Eigen::Matrix2d q2 = Eigen::Matrix2d::Zero();
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
124  <a href="#6f45af4b">6f45af4b</a> -     for (ElementList::const_iterator i = _elements.begin(); i != _elements.end(); ++i) {</div>
              ?          ^^^                              ^^^                     ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
135  <a href="#b4ea1017">b4ea1017</a> +     for (ComponentList::const_iterator i = _components.begin(); i != _components.end(); ++i) {</div>
              ?          ^^ +++                             ^^ +++                    ^^ +++
                        i->_computeRawMoments(q0, q1, q2);
                    }
                    q1 /= q0;
                    q2 /= q0;
                    q2 -= q1 * q1.transpose();
                    return afw::geom::ellipses::Ellipse(
                        afw::geom::ellipses::Quadrupole(afw::geom::ellipses::Quadrupole::Matrix(q2), false),
                        afw::geom::Point2D(q1)
                    );
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="6f45af4b"/></a>6f45af4b</h3>

<pre>
commit 6f45af4bed1661a0b044dd06658da16c9308a193
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Sun Mar 13 03:15:28 2011 +0000

    afw #1556 - tweaks to ellipses SWIG code, added moments computation to shapelets library, fixed missing documentation in images
</pre>
<h3><a name="0f0a1cf0"/></a>0f0a1cf0</h3>

<pre>
commit 0f0a1cf0781cf190f5649834ded5715bf0b6b09e
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Wed Feb 23 04:06:18 2011 +0000

    afw #1556 - minor updates to shapelets to support compound basis in meas/multifit
</pre>
<h3><a name="9ed8e26f"/></a>9ed8e26f</h3>

<pre>
commit 9ed8e26f11de18bf64e89cc86f7253ba71f2e4f0
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Apr 19 12:22:11 2012 -0400

    switch shapelet convolution to return instead of operate in-place (#2058)
</pre>
<h3><a name="18295e0f"/></a>18295e0f</h3>

<pre>
commit 18295e0fc280fe91e4250bd42fd1be8ce535c100
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Fri Mar 18 18:06:49 2011 +0000

    afw #1556 - added transformation functions to shapelets
</pre>
<h3><a name="c84bfaa6"/></a>c84bfaa6</h3>

<pre>
commit c84bfaa6d451f55d0e45aa17dd65e05a6a6969c3
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 27 13:29:34 2012 -0400

    Added addToImage member functions to shapelet evaluator classes.
</pre>
<h3><a name="ecb24f66"/></a>ecb24f66</h3>

<pre>
commit ecb24f66d5d17e3b7b3861eb13d8ba2175f33ada
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Tue Feb 22 19:17:04 2011 +0000

    afw #1556 - moved ShapeletConvolution to afw as HermiteConvolution, added MultiShapeletFunction
</pre>
<h3><a name="bb928df3"/></a>bb928df3</h3>

<pre>
commit bb928df3fc2fafe5183e0d075da19994f0af4fc7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 17 16:57:27 2013 -0400

    Let the value to normalize to be specified in [Multi]ShapeletFunction
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="d0049163"/></a>d0049163</h3>

<pre>
commit d0049163b7cfb63ba3248fbf03e58d9827ace8f7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 26 16:11:22 2012 -0400

    switched shapelets lib to use namespace blocks in source files
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
<h3><a name="ffb98db0"/></a>ffb98db0</h3>

<pre>
commit ffb98db06b303dfd6da0d9e5a211704b29571f67
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 15 17:41:47 2014 -0400

    Add vectorized evaluation to [Multi]ShapeletFunction
    
    This is still not the most efficient method of shapelet
    evaluation (that's MatrixBuilder), but it's faster and more
    convenient than looping over pixels in Python.
</pre>
<h3><a name="ecb24f66"/></a>ecb24f66</h3>

<pre>
commit ecb24f66d5d17e3b7b3861eb13d8ba2175f33ada
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Tue Feb 22 19:17:04 2011 +0000

    afw #1556 - moved ShapeletConvolution to afw as HermiteConvolution, added MultiShapeletFunction
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_18"><a name="include/lsst/shapelet.h"/></a>include/lsst/shapelet.h</h1>

<h3 id="toc_19">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                #ifndef LSST_AFW_MATH_SHAPELETS_H
                #define LSST_AFW_MATH_SHAPELETS_H
                /**
                 * @file
                 *
                 * @brief An include file to include the header files for lsst::shapelet
                 */
                #include "lsst/shapelet/constants.h"
                #include "lsst/shapelet/ConversionMatrix.h"
                #include "lsst/shapelet/ShapeletFunction.h"
                #include "lsst/shapelet/MultiShapeletFunction.h"
                #include "lsst/shapelet/BasisEvaluator.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#2aa29ee3">2aa29ee3</a> - #include "lsst/shapelet/ModelBuilder.h"</div>
                #include "lsst/shapelet/HermiteTransformMatrix.h"
                #include "lsst/shapelet/GaussHermiteConvolution.h"
                #include "lsst/shapelet/GaussHermiteProjection.h"
                #include "lsst/shapelet/MultiShapeletBasis.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#8c99a219">8c99a219</a> + #include "lsst/shapelet/MatrixBuilder.h"</div>
                #include "lsst/shapelet/RadialProfile.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#c2c49dbc">c2c49dbc</a> + #include "lsst/shapelet/FunctorKeys.h"</div>
                
                #endif // !defined(LSST_AFW_MATH_SHAPELETS_H)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="2aa29ee3"/></a>2aa29ee3</h3>

<pre>
commit 2aa29ee3eb1fd0fbc9b39887ddeffd481d375999
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 23 12:08:25 2012 -0400

    Moved lsst/afw/math/shapelets to lsst/shapelet.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="c2c49dbc"/></a>c2c49dbc</h3>

<pre>
commit c2c49dbc16485b16d09ceb053e5f40709857b962
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 21:11:05 2014 -0400

    Add FunctorKey for ShapeletFunction
</pre>
<h3><a name="8c99a219"/></a>8c99a219</h3>

<pre>
commit 8c99a21988cf95908d61bab775722d7fc100c699
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 10 22:00:20 2014 -0400

    Add MatrixBuilder, a unified interface for shapelet matrix evaluation
    
    MatrixBuilder provides the functionality previously present in
    MultiShapeletMatrixBuilder, ModelBuilder, and some private code
    in meas_multifit's psf.cc, with a unified interface, better code
    reuse, and a design more amenable to future micro-optimization.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_20"><a name="python/lsst/shapelet/shapeletLib.i"/></a>python/lsst/shapelet/shapeletLib.i</h1>

<h3 id="toc_21">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                %define shapeletLib_DOCSTRING
                "
                Python interface to lsst::shapelet classes and functions
                "
                %enddef
                
                %feature("autodoc", "1");
                %module(package="lsst.shapelet", docstring=shapeletLib_DOCSTRING) shapeletLib
                
                %{
                #   include "lsst/afw/geom.h"
                #   include "lsst/afw/detection.h"
                #   include "lsst/afw/image.h"
                #   include "lsst/afw/cameraGeom.h"
                #   include "lsst/pex/logging.h"
                #   include "lsst/shapelet.h"
                %}
                
                %include "lsst/p_lsstSwig.i"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#ec9026c8">ec9026c8</a> + %initializeNumPy(shapelet)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#ec9026c8">ec9026c8</a> + </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#6f45af4b">6f45af4b</a> - %include "std_list.i"</div>
              ?               ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#e547711b">e547711b</a> + %include "std_vector.i"</div>
              ?               ^^^ ++
                
                %{
                #include "lsst/afw/geom.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#c0f17a54">c0f17a54</a> - #define PY_ARRAY_UNIQUE_SYMBOL LSST_AFW_MATH_SHAPELETS_NUMPY_ARRAY_API</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
49   <a href="#c0f17a54">c0f17a54</a> - #include "numpy/arrayobject.h"</div>
                #include "ndarray/swig.h"
                #include "ndarray/swig/eigen.h"
                #include "lsst/afw/geom/ellipses/PyPixelRegion.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#c2c49dbc">c2c49dbc</a> + #include "lsst/afw/table.h"</div>
                %}
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#c0f17a54">c0f17a54</a> - %init %{</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#c0f17a54">c0f17a54</a> -     import_array();</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#c0f17a54">c0f17a54</a> - %}</div>
                %pythoncode %{
                    import numpy
                %}
                
                %include "ndarray.i"
                
                %declareNumPyConverters(Eigen::VectorXd);
                %declareNumPyConverters(Eigen::MatrixXd);
                %declareNumPyConverters(Eigen::Matrix2d);
                %declareNumPyConverters(ndarray::Array<double,1>);
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#ffb98db0">ffb98db0</a> + %declareNumPyConverters(ndarray::Array<double const,1>);</div>
                %declareNumPyConverters(ndarray::Array<float,1,1>);
                %declareNumPyConverters(ndarray::Array<double,1,1>);
                %declareNumPyConverters(ndarray::Array<double,2,1>);
                %declareNumPyConverters(ndarray::Array<float,2,-1>);
                %declareNumPyConverters(ndarray::Array<double,2,-1>);
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#8c99a219">8c99a219</a> + %declareNumPyConverters(ndarray::Array<float,2,-2>);</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
73   <a href="#8c99a219">8c99a219</a> + %declareNumPyConverters(ndarray::Array<double,2,-2>);</div>
                %declareNumPyConverters(ndarray::Array<float const,1,1>);
                %declareNumPyConverters(ndarray::Array<double const,1,1>);
                %declareNumPyConverters(ndarray::Array<double const,2,-2>);
                %declareNumPyConverters(ndarray::Array<double const,2,2>);
                %declareNumPyConverters(ndarray::Array<double,3,-3>);
                
                %feature(valuewrapper) lsst::shapelet::ShapeletFunction;
                %feature(valuewrapper) lsst::shapelet::MultiShapeletFunction;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#2aa29ee3">2aa29ee3</a> - %feature(valuewrapper) lsst::shapelet::ModelBuilder;</div>
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#2aa29ee3">2aa29ee3</a> - %template(MultiShapeletElementList) std::list<lsst::shapelet::ShapeletFunction>;</div>
              ?                        ^^^               ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#b4ea1017">b4ea1017</a> + %template(MultiShapeletComponentList) std::vector<lsst::shapelet::ShapeletFunction>;</div>
              ?                        ^^ +++              ^^^ ++
                
                %import "lsst/afw/geom/geomLib.i"
                %import "lsst/afw/geom/ellipses/ellipsesLib.i"
                %import "lsst/afw/image/imageLib.i"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#c2c49dbc">c2c49dbc</a> + %import "lsst/afw/table/tableLib.i"</div>
                
                %lsst_exceptions();
                
                %copyctor lsst::shapelet::MultiShapeletBasis;
                %ignore lsst::shapelet::ShapeletFunction::operator=;
                
                %shared_ptr(lsst::shapelet::MultiShapeletBasis);
                
                %include "lsst/shapelet/constants.h"
                %include "lsst/shapelet/ConversionMatrix.h"
                %include "lsst/shapelet/ShapeletFunction.h"
                %include "lsst/shapelet/MultiShapeletFunction.h"
                %include "lsst/shapelet/BasisEvaluator.h"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
101  <a href="#2aa29ee3">2aa29ee3</a> - %include "lsst/shapelet/ModelBuilder.h"</div>
                %include "lsst/shapelet/HermiteTransformMatrix.h"
                %include "lsst/shapelet/GaussHermiteConvolution.h"
                %include "lsst/shapelet/GaussHermiteProjection.h"
                %include "lsst/shapelet/MultiShapeletBasis.h"
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#8c99a219">8c99a219</a> + %include "lsst/shapelet/MatrixBuilder.h"</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#8c99a219">8c99a219</a> + %define %instantiateMatrixBuilder(T, SUFFIX)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#bc24fdf4">bc24fdf4</a> - %template(ModelBuilderF) lsst::shapelet::ModelBuilder<float>;</div>
              ?            ^^^^                           ^^^^        ^^^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#8c99a219">8c99a219</a> + %template(MatrixBuilder##SUFFIX) lsst::shapelet::MatrixBuilder<T>;</div>
              ?            ^^^^^       ++++ +++                   ^^^^^        ^
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#bc24fdf4">bc24fdf4</a> - %template(ModelBuilderD) lsst::shapelet::ModelBuilder<double>;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#397f9519">397f9519</a> - %template(MultiShapeletMatrixBuilderF) lsst::shapelet::MultiShapeletMatrixBuilder<float>;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#397f9519">397f9519</a> - %template(MultiShapeletMatrixBuilderD) lsst::shapelet::MultiShapeletMatrixBuilder<double>;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#8c99a219">8c99a219</a> + %template(MatrixBuilderFactory##SUFFIX) lsst::shapelet::MatrixBuilderFactory<T>;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
111  <a href="#8c99a219">8c99a219</a> + %template(MatrixBuilderWorkspace##SUFFIX) lsst::shapelet::MatrixBuilderWorkspace<T>;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
112  <a href="#8c99a219">8c99a219</a> + %pythoncode %{</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
113  <a href="#8c99a219">8c99a219</a> + MatrixBuilder##SUFFIX.Factory = MatrixBuilderFactory##SUFFIX</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
114  <a href="#8c99a219">8c99a219</a> + MatrixBuilder##SUFFIX.Workspace = MatrixBuilderWorkspace##SUFFIX</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#8c99a219">8c99a219</a> + MatrixBuilderFactory##SUFFIX.Workspace = MatrixBuilderWorkspace##SUFFIX</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
116  <a href="#8c99a219">8c99a219</a> + %}</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
117  <a href="#8c99a219">8c99a219</a> + %enddef</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
118  <a href="#8c99a219">8c99a219</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
119  <a href="#8c99a219">8c99a219</a> + %instantiateMatrixBuilder(float, F)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
120  <a href="#8c99a219">8c99a219</a> + %instantiateMatrixBuilder(double, D)</div>
                
                %extend lsst::shapelet::ShapeletFunction {
                
                %pythoncode %{
                def __reduce__(self):
                    return (ShapeletFunction, (self.getOrder(), self.getBasisType(),
                                               self.getEllipse(), self.getCoefficients()))
                %}
                
                }
                
                %extend lsst::shapelet::MultiShapeletFunction {
                
                %pythoncode %{
                def __reduce__(self):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#65bbc3f5">65bbc3f5</a> -     return (MultiShapeletFunction, (list(self.getElements()),))</div>
              ?                                                  ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
136  <a href="#b4ea1017">b4ea1017</a> +     return (MultiShapeletFunction, (list(self.getComponents()),))</div>
              ?                                                  ^^ +++
                %}
                
                }
                
                %extend lsst::shapelet::RadialProfile {
                    %feature("shadow") evaluate %{
                    def evaluate(self, r):
                        if isinstance(r, numpy.ndarray):
                            return $action(self, r.ravel()).reshape(r.shape)
                        else:
                            return $action(self, r)
                    %}
                }
                %include "lsst/shapelet/RadialProfile.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
151  <a href="#c2c49dbc">c2c49dbc</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
152  <a href="#c2c49dbc">c2c49dbc</a> + %declareFunctorKey(ShapeletFunction, lsst::shapelet::ShapeletFunction)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#c2c49dbc">c2c49dbc</a> + %shared_ptr(lsst::shapelet::ShapeletFunctionKey)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
154  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
155  <a href="#25cc4e01">25cc4e01</a> + %declareFunctorKey(MultiShapeletFunction, lsst::shapelet::MultiShapeletFunction)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#25cc4e01">25cc4e01</a> + %shared_ptr(lsst::shapelet::MultiShapeletFunctionKey)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
157  <a href="#25cc4e01">25cc4e01</a> + %template(ShapeletFunctionKeyVector) std::vector<PTR(lsst::shapelet::ShapeletFunctionKey)>;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
158  <a href="#25cc4e01">25cc4e01</a> + %template(IntVector) std::vector<int>;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
160  <a href="#c2c49dbc">c2c49dbc</a> + %include "lsst/shapelet/FunctorKeys.h"</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
162  <a href="#c2c49dbc">c2c49dbc</a> + %useValueEquality(lsst::shapelet::ShapeletFunctionKey)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#25cc4e01">25cc4e01</a> + %useValueEquality(lsst::shapelet::MultiShapeletFunctionKey)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
165  <a href="#25cc4e01">25cc4e01</a> + %extend lsst::shapelet::MultiShapeletFunctionKey {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
167  <a href="#25cc4e01">25cc4e01</a> +     PTR(lsst::shapelet::ShapeletFunctionKey) __getitem__(int i) { return (*self)[i]; }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#25cc4e01">25cc4e01</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
169  <a href="#25cc4e01">25cc4e01</a> + }</div>
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="6f45af4b"/></a>6f45af4b</h3>

<pre>
commit 6f45af4bed1661a0b044dd06658da16c9308a193
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Sun Mar 13 03:15:28 2011 +0000

    afw #1556 - tweaks to ellipses SWIG code, added moments computation to shapelets library, fixed missing documentation in images
</pre>
<h3><a name="397f9519"/></a>397f9519</h3>

<pre>
commit 397f9519681a23c37d2d2421f009e66d5b8a3aa4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 13:35:31 2013 -0400

    Add MultiShapeletBasis, MultiShapeletMatrixBuilder classes
</pre>
<h3><a name="bc24fdf4"/></a>bc24fdf4</h3>

<pre>
commit bc24fdf44424c135970b310976294b370a525983
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 13:53:29 2013 -0400

    Make ModelBuilder a template.
</pre>
<h3><a name="c0f17a54"/></a>c0f17a54</h3>

<pre>
commit c0f17a540c08a7a2dd4ae6ff6a395540f925a985
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Fri Feb 18 08:50:29 2011 +0000

    afw #1556 - working on verifying correctness of shapelet conversions
</pre>
<h3><a name="65bbc3f5"/></a>65bbc3f5</h3>

<pre>
commit 65bbc3f59ae533bec29e267996f07f413ad3284e
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 31 14:03:06 2013 -0400

    Add pickle support for ShapeletFunction, MultiShapeletFunction
</pre>
<h3><a name="2aa29ee3"/></a>2aa29ee3</h3>

<pre>
commit 2aa29ee3eb1fd0fbc9b39887ddeffd481d375999
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 23 12:08:25 2012 -0400

    Moved lsst/afw/math/shapelets to lsst/shapelet.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="c2c49dbc"/></a>c2c49dbc</h3>

<pre>
commit c2c49dbc16485b16d09ceb053e5f40709857b962
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 21:11:05 2014 -0400

    Add FunctorKey for ShapeletFunction
</pre>
<h3><a name="25cc4e01"/></a>25cc4e01</h3>

<pre>
commit 25cc4e01eb9e7c9ce8694c8ce54327cf96f9bdf4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 21:46:49 2014 -0400

    Add FunctorKey for MultiShapeletFunction
</pre>
<h3><a name="8c99a219"/></a>8c99a219</h3>

<pre>
commit 8c99a21988cf95908d61bab775722d7fc100c699
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 10 22:00:20 2014 -0400

    Add MatrixBuilder, a unified interface for shapelet matrix evaluation
    
    MatrixBuilder provides the functionality previously present in
    MultiShapeletMatrixBuilder, ModelBuilder, and some private code
    in meas_multifit's psf.cc, with a unified interface, better code
    reuse, and a design more amenable to future micro-optimization.
</pre>
<h3><a name="ffb98db0"/></a>ffb98db0</h3>

<pre>
commit ffb98db06b303dfd6da0d9e5a211704b29571f67
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 15 17:41:47 2014 -0400

    Add vectorized evaluation to [Multi]ShapeletFunction
    
    This is still not the most efficient method of shapelet
    evaluation (that's MatrixBuilder), but it's faster and more
    convenient than looping over pixels in Python.
</pre>
<h3><a name="ec9026c8"/></a>ec9026c8</h3>

<pre>
commit ec9026c8aa397c8f8e736a4d070b0b4f93161481
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Apr 8 16:59:08 2015 -0400

    Utilize new numeric scalar typemaps and NumPy initialization macro
</pre>
<h3><a name="e547711b"/></a>e547711b</h3>

<pre>
commit e547711bf53abb33670d1c920cbb02ee41ae351b
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sat May 10 22:12:20 2014 -0400

    Switch from std::list to std::vector in MultiShapeletFunction.
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_22"><a name="examples/timeModels.i"/></a>examples/timeModels.i</h1>

<h3 id="toc_23">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                /*
                 * LSST Data Management System
                 * Copyright 2008-2013 LSST Corporation.
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                %module timeModels
                
                %include "lsst/p_lsstSwig.i"
                
                %lsst_exceptions()
                
                %{
                #include "lsst/shapelet.h"
                #include "lsst/afw/fits.h"
                #include "lsst/afw/cameraGeom.h"
                #include "lsst/afw/image.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#8d615c9f">8d615c9f</a> + #include "lsst/afw/table.h"</div>
                #include "lsst/pex/logging.h"
                #define PY_ARRAY_UNIQUE_SYMBOL LSST_SHAPELET_TIMEMODELS_NUMPY_ARRAY_API
                #include "numpy/arrayobject.h"
                #include "ndarray/swig.h"
                #include "ndarray/swig/eigen.h"
                %}
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#8d615c9f">8d615c9f</a> + %import "lsst/afw/table/tableLib.i"</div>
                %import "lsst/shapelet/shapeletLib.i"
                
                %init %{
                    import_array();
                %}
                
                %include "ndarray.i"
                
                %declareNumPyConverters(ndarray::Array<double const,2>);
                
                %{
                
                #include "lsst/afw/geom/ellipses.h"
                
                template <typename T>
                double buildModelsImpl(
                    int nPixels, int basisSize,
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#a776b773">a776b773</a> -     lsst::shapelet::MultiShapeletMatrixBuilder<T> const & builder,</div>
              ?                      -------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#13feffe1">13feffe1</a> +     lsst::shapelet::MatrixBuilder<T> const & builder,</div>
                    ndarray::Array<double const,2> const & parameters,
                    std::string const & ellipseType
                ) {
                    lsst::afw::geom::ellipses::Ellipse ellipse(
                        lsst::afw::geom::ellipses::BaseCore::make(ellipseType),
                        lsst::afw::geom::Point2D()
                    );
                    ndarray::Array<T,2,2> matrixT = ndarray::allocate(basisSize, nPixels);
                    ndarray::Array<T,2,-2> matrix = matrixT.transpose();
                    double result = 0.0;
                    for (ndarray::Array<double const,2>::Iterator i = parameters.begin(); i != parameters.end(); ++i) {
                        ellipse.setParameterVector(i->asEigen());
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#b478b8a8">b478b8a8</a> -         builder.build(matrix, ellipse);</div>
              ?                ------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#13feffe1">13feffe1</a> +         builder(matrix, ellipse);</div>
                        result += matrix.asEigen().norm();
                    }
                    return result;
                }
                
                %}
                
                %inline %{
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#a776b773">a776b773</a> - double buildModelsF(</div>
              ?  -----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#13feffe1">13feffe1</a> + void buildModelsF(</div>
              ? +++
                    int nPixels, int basisSize,
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#a776b773">a776b773</a> -     lsst::shapelet::MultiShapeletMatrixBuilder<float> const & builder,</div>
              ?                     -------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#13feffe1">13feffe1</a> +     lsst::shapelet::MatrixBuilder<float> const & builder,</div>
                    ndarray::Array<double const,2> const & parameters,
                    std::string const & ellipseType
                ) {
                    buildModelsImpl(nPixels, basisSize, builder, parameters, ellipseType);
                }
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#a776b773">a776b773</a> - double buildModelsD(</div>
              ?  -----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
93   <a href="#13feffe1">13feffe1</a> + void buildModelsD(</div>
              ? +++
                    int nPixels, int basisSize,
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
93   <a href="#a776b773">a776b773</a> -     lsst::shapelet::MultiShapeletMatrixBuilder<double> const & builder,</div>
              ?                     -------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#13feffe1">13feffe1</a> +     lsst::shapelet::MatrixBuilder<double> const & builder,</div>
                    ndarray::Array<double const,2> const & parameters,
                    std::string const & ellipseType
                ) {
                    buildModelsImpl(nPixels, basisSize, builder, parameters, ellipseType);
                }
                
                %}
                
                %pythoncode %{
                
                import numpy
                import cPickle
                import os
                import sys
                import argparse
                import time
                import resource
                import lsst.shapelet.tractor
                
                def main():
                    parser = argparse.ArgumentParser(description="Benchmark shapelet-based galaxy model evaluation")
                    parser.add_argument("-p", "--psf", help="Pickled PSF to use",
                                        default="psf.p", type=str, metavar="FILE")
                    parser.add_argument("-r", "--repeat", help="Number of times to repeat the test (loop in Python)",
                                        default=100, type=int)
                    parser.add_argument("-n", "--n-samples", help="Number of parameter points to evaluate (loop in C++)",
                                        default=200, type=int)
                    parser.add_argument("--n-disk-terms", help="Number of Gaussians in disk (exponential) component",
                                        default=8, type=int)
                    parser.add_argument("--n-bulge-terms", help="Number of Gaussians in bulge (de Vaucouleur) component",
                                        default=8, type=int)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
125  <a href="#b478b8a8">b478b8a8</a> -     parser.add_argument("--approximate-exp", help="Use the approximate fast exponential from lsst::utils",</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#b478b8a8">b478b8a8</a> -                         default=False, action="store_true")</div>
                    parser.add_argument("--n-x-pixels", help="Number of pixels in x direction (footprint is a rectangle)",
                                        default=20, type=int)
                    parser.add_argument("--n-y-pixels", help="Number of pixels in y direction (footprint is a rectangle)",
                                        default=20, type=int)
                    parser.add_argument("--double-precision", help="Use double precision instead of single precision",
                                        default=False, action="store_true")
                    args = parser.parse_args()
                    bulge = lsst.shapelet.tractor.loadBasis("luv", args.n_bulge_terms)
                    disk = lsst.shapelet.tractor.loadBasis("lux", args.n_disk_terms)
                    bulge.scale(0.6)
                    disk.merge(bulge)
                    with open(os.path.join(os.path.split(__file__)[0], args.psf), "r") as psfFile:
                        psf = cPickle.load(psfFile)
                    xMin = -args.n_x_pixels // 2
                    yMin = -args.n_y_pixels // 2
                    if args.double_precision:
                        dtype = numpy.float64
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#a776b773">a776b773</a> -         Builder = lsst.shapelet.MultiShapeletMatrixBuilderD</div>
              ?                                  -------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#13feffe1">13feffe1</a> +         Builder = lsst.shapelet.MatrixBuilderD</div>
                        func = buildModelsD
                    else:
                        dtype = numpy.float32
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#a776b773">a776b773</a> -         Builder = lsst.shapelet.MultiShapeletMatrixBuilderF</div>
              ?                                  -------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#13feffe1">13feffe1</a> +         Builder = lsst.shapelet.MatrixBuilderF</div>
                        func = buildModelsF
                
                    x, y = numpy.meshgrid(numpy.arange(xMin, xMin+args.n_x_pixels, dtype=dtype),
                                          numpy.arange(yMin, yMin+args.n_y_pixels, dtype=dtype))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#a776b773">a776b773</a> -     builder = Builder(disk, psf, x.flatten(), y.flatten(),</div>
              ?                       -----------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#13feffe1">13feffe1</a> +     builder = Builder(x.flatten(), y.flatten(), disk, psf)</div>
              ?                                                +++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
154  <a href="#b478b8a8">b478b8a8</a> -                                                         args.approximate_exp)</div>
                    parameters = numpy.random.randn(args.n_samples, 5)
                    cpuTime1 = time.clock()
                    res1 = resource.getrusage(resource.RUSAGE_SELF)
                    for n in range(args.repeat):
                        func(x.size, disk.getSize(), builder, parameters, "SeparableConformalShearLogTraceRadius")
                    cpuTime2 = time.clock()
                    res2 = resource.getrusage(resource.RUSAGE_SELF)
                    factor = args.n_samples * args.repeat
                    print "Time per model evaluation (seconds): cpu=%g, user=%g, system=%g" % (
                        (cpuTime2 - cpuTime1) / factor,
                        (res2.ru_utime - res1.ru_utime) / factor,
                        (res2.ru_stime - res1.ru_stime) / factor
                        )
                
                if __name__ == "__main__":
                    main()
                %}
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="a776b773"/></a>a776b773</h3>

<pre>
commit a776b773dfe78842e57a83c181c4b62e386a5e07
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Oct 16 13:07:49 2013 -0400

    Add double precision option to timeModels
</pre>
<h3><a name="b478b8a8"/></a>b478b8a8</h3>

<pre>
commit b478b8a88944627baae97a0ea278fafafb3e264f
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 31 15:35:08 2013 -0400

    Add example code to test timing of shapelet galaxy models.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="13feffe1"/></a>13feffe1</h3>

<pre>
commit 13feffe1b704733fdb667b7e4d8f7b5b9e763861
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 17 18:07:31 2014 -0400

    Remove old MultiShapeletMatrixBuilder
    
    This has been replaced by MatrixBuilder
</pre>
<h3><a name="8d615c9f"/></a>8d615c9f</h3>

<pre>
commit 8d615c9fa3d99fccf82040d8b82c424dceecb2b3
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Oct 7 16:52:56 2014 -0400

    Need to #include, %import afw::table in example Swig build.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_24"><a name="src/BasisEvaluator.cc"/></a>src/BasisEvaluator.cc</h1>

<h3 id="toc_25">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "boost/format.hpp"
                
                #include "lsst/pex/exceptions.h"
                #include "lsst/shapelet/BasisEvaluator.h"
                
                namespace lsst { namespace shapelet {
                
                namespace {
                
                static inline void validateSize(int expected, int actual) {
                    if (expected != actual) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#2eb148b7">2eb148b7</a> -             pex::exceptions::LengthErrorException,</div>
              ?                                         ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
                            (boost::format(
                                "Output array for BasisEvaluator has incorrect size (%n, should be %n)."
                            ) % actual % expected).str()
                        );
                    }
                }
                
                } // anonymous
                
                void BasisEvaluator::fillEvaluation(
                    ndarray::Array<double,1> const & array, double x, double y,
                    ndarray::Array<double,1> const & dx,
                    ndarray::Array<double,1> const & dy
                ) const {
                    validateSize(computeSize(getOrder()), array.getSize<0>());
                    _h.fillEvaluation(array, x, y, dx, dy);
                    ConversionMatrix::convertOperationVector(array, HERMITE, _basisType, getOrder());
                    if (!dx.isEmpty()) {
                        validateSize(computeSize(getOrder()), dx.getSize<0>());
                        ConversionMatrix::convertOperationVector(dx, HERMITE, _basisType, getOrder());
                    }
                    if (!dy.isEmpty()) {
                        validateSize(computeSize(getOrder()), dy.getSize<0>());
                        ConversionMatrix::convertOperationVector(dy, HERMITE, _basisType, getOrder());
                    }
                }
                
                void BasisEvaluator::fillIntegration(ndarray::Array<double,1> const & array, int xMoment, int yMoment) const {
                    validateSize(computeSize(getOrder()), array.getSize<0>());
                    _h.fillIntegration(array, xMoment, yMoment);
                    ConversionMatrix::convertOperationVector(array, HERMITE, _basisType, getOrder());
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="2eb148b7"/></a>2eb148b7</h3>

<pre>
commit 2eb148b766836aadcc1157747a386beb21d8ca17
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Mar 27 15:37:21 2012 -0400

    added Least Squares evaluation to BasisEvaluator
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_26"><a name="src/GaussHermiteConvolution.cc"/></a>src/GaussHermiteConvolution.cc</h1>

<h3 id="toc_27">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                /*
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/ShapeletFunction.h"
                #include "lsst/shapelet/GaussHermiteConvolution.h"
                #include "lsst/afw/geom/Angle.h"
                #include "ndarray/eigen.h"
                
                namespace lsst { namespace shapelet {
                
                //================= TripleProductIntegral ===================================================================
                
                namespace {
                
                class TripleProductIntegral {
                public:
                
                    ndarray::Array<double,3,3> const asArray() const { return _array; }
                
                    static ndarray::Array<double,3,3> make1d(int const order1, int const order2, int const order3);
                
                    TripleProductIntegral(int order1, int order2, int order3);
                
                    ndarray::Vector<int,3> const & getOrders() const { return _orders; }
                
                private:
                
                    ndarray::Vector<int,3> _orders;
                    ndarray::Array<double,3,3> _array;
                };
                
                TripleProductIntegral::TripleProductIntegral(int order1, int order2, int order3) :
                    _orders(ndarray::makeVector(order1, order2, order3)),
                    _array(
                        ndarray::allocate(
                            ndarray::makeVector(
                                computeOffset(order1+1),
                                computeOffset(order2+1),
                                computeOffset(order3+1)
                            )
                        )
                    )
                {
                    _array.deep() = 0.0;
                    ndarray::Array<double,3,3> a1d = make1d(order1, order2, order3);
                    ndarray::Array<double,3,3>::Index o, i, x, y, n;
                    for (n[0] = o[0] = 0; n[0] <= _orders[0]; o[0] += ++n[0]) {
                        for (n[2] = o[2] = 0; n[2] <= _orders[2]; o[2] += ++n[2]) {
                            int n0n2 = n[0] + n[2];
                            int max = (order2 < n0n2) ? _orders[1] : n0n2;
                            for (o[1] = n[1] = bool(n0n2 % 2); n[1] <= max; (o[1] += ++n[1]) += ++n[1]) {
                                for (i[0] = o[0], x[0] = 0, y[0] = n[0]; x[0] <= n[0]; ++x[0], --y[0], ++i[0]) {
                                    for (i[2] = o[2], x[2] = 0, y[2] = n[2]; x[2] <= n[2]; ++x[2], --y[2], ++i[2]) {
                                        for (i[1] = o[1], x[1] = 0, y[1] = n[1]; x[1] <= n[1]; ++x[1], --y[1], ++i[1]) {
                                            _array[i] = a1d[x] * a1d[y];
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                
                ndarray::Array<double,3,3>
                TripleProductIntegral::make1d(int order1, int order2, int order3) {
                    ndarray::Array<double,3,3> array = ndarray::allocate(ndarray::makeVector(order1+1, order2+1, order3+1));
                    array.deep() = 0.0;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#71552e6a">71552e6a</a> -     double first = array[ndarray::makeVector(0,0,0)] = BASIS_NORMALIZATION * M_SQRT1_2;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#d42a56fb">d42a56fb</a> +     double first = array[ndarray::makeVector(0, 0, 0)] = BASIS_NORMALIZATION * M_SQRT1_2;</div>
              ?                                                +  +
                    if (order1 < 1) {
                        if (order3 < 1) return array;
                        // n1=0, n2=0, n3=even
                        double previous = first;
                        for (int n3 = 2; n3 <= order3; n3 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
94   <a href="#8fc55e3d">8fc55e3d</a> -             previous = array[ndarray::makeVector(0,0,n3)] = -0.5*rationalSqrt(n3 - 1, n3)*previous;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
94   <a href="#d42a56fb">d42a56fb</a> +             previous = array[ndarray::makeVector(0, 0, n3)] = -0.5*rationalSqrt(n3 - 1, n3)*previous;</div>
              ?                                                    +  +
                        }
                        // n1=0, n2>0, n3>0
                        for (int n2 = 1; n2 <= order2; ++n2) {
                            for (int n3 = n2; n3 <= order3; n3 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#ecb24f66">ecb24f66</a> -                 array[ndarray::makeVector(0,n2,n3)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#d42a56fb">d42a56fb</a> +                 array[ndarray::makeVector(0, n2, n3)]</div>
              ?                                             +   +
                                    = rationalSqrt(n3, 2*n2) * array[ndarray::makeVector(0, n2-1, n3-1)];
                            }
                        }
                        return array;
                    }
                
                    if (order3 < 1) {
                        // n1=even, n2=0, n3=even
                        double previous = first;
                        for (int n1 = 2; n1 <= order1; n1 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#8fc55e3d">8fc55e3d</a> -             previous = array[ndarray::makeVector(0,0,n1)] = -0.5*rationalSqrt(n1 - 1, n1)*previous;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#d42a56fb">d42a56fb</a> +             previous = array[ndarray::makeVector(0, 0, n1)] = -0.5*rationalSqrt(n1 - 1, n1)*previous;</div>
              ?                                                    +  +
                        }
                        // n1=0, n2>0, n3>0
                        for (int n2 = 1; n2 <= order2; ++n2) {
                            for (int n1 = n2; n1 <= order1; n1 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#ecb24f66">ecb24f66</a> -                 array[ndarray::makeVector(n1,n2,0)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#d42a56fb">d42a56fb</a> +                 array[ndarray::makeVector(n1, n2, 0)]</div>
              ?                                              +   +
                                    = rationalSqrt(n1, 2*n2) * array[ndarray::makeVector(n1-1, n2-1, 0)];
                            }
                        }
                        return array;
                    }
                
                    // n1=any, n2=0, n3=(0,1)
                    {
                        double previous = first;
                        int n1 = 0;
                        while (true) {
                            if (++n1 > order1) break;
                            array[ndarray::makeVector(n1, 0, 1)] = 0.5*intSqrt(n1)*previous;
                            if (++n1 > order1) break;
                            previous = array[ndarray::makeVector(n1, 0, 0)] = -0.5*rationalSqrt(n1 - 1, n1)*previous;
                        }
                    }
                
                    // n1=(0,1), n2=0, n3=any
                    {
                        double previous = first;
                        int n3 = 0;
                        while (true) {
                            if (++n3 > order3) break;
                            array[ndarray::makeVector(1, 0, n3)] = 0.5*intSqrt(n3) * previous;
                            if (++n3 > order3) break;
                            previous = array[ndarray::makeVector(0, 0, n3)] = -0.5*rationalSqrt(n3 - 1, n3)*previous;
                        }
                    }
                
                    // n1>1, n2=0, n3>1
                    for (int n1 = 2; n1 <= order1; ++n1) {
                        double f1 = -0.5*rationalSqrt(n1 - 1, n1);
                        for (int n3 = (n1 % 2) ? 3:2; n3 <= order3; n3 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#ecb24f66">ecb24f66</a> -             array[ndarray::makeVector(n1,0,n3)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#d42a56fb">d42a56fb</a> +             array[ndarray::makeVector(n1, 0, n3)]</div>
              ?                                          +  +
                                = f1 * array[ndarray::makeVector(n1-2, 0, n3)]
                                + 0.5*rationalSqrt(n3, n1) * array[ndarray::makeVector(n1-1, 0, n3-1)];
                        }
                    }
                
                    for (int n2 = 1; n2 <= order2; ++n2) {
                        // n1>=n2, n3=0
                        for (int n1 = n2; n1 <= order1; n1 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#ecb24f66">ecb24f66</a> -             array[ndarray::makeVector(n1,n2,0)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#d42a56fb">d42a56fb</a> +             array[ndarray::makeVector(n1, n2, 0)]</div>
              ?                                          +   +
                                = rationalSqrt(n1, 2*n2) * array[ndarray::makeVector(n1-1, n2-1, 0)];
                        }
                        // n1=0, n3>=n2
                        for (int n3 = n2; n3 <= order3; n3 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#ecb24f66">ecb24f66</a> -             array[ndarray::makeVector(0,n2,n3)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#d42a56fb">d42a56fb</a> +             array[ndarray::makeVector(0, n2, n3)]</div>
              ?                                         +   +
                                = rationalSqrt(n3, 2*n2) * array[ndarray::makeVector(0, n2-1, n3-1)];
                        }
                        // n1>0, n3>0
                        for (int n1 = 1; n1 <= order1; ++n1) {
                            for (int n3 = ((n1+n2) % 2) ? 1:2; n3 <= order3; n3 += 2) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
170  <a href="#ecb24f66">ecb24f66</a> -                 array[ndarray::makeVector(n1,n2,n3)]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
170  <a href="#d42a56fb">d42a56fb</a> +                 array[ndarray::makeVector(n1, n2, n3)]</div>
              ?                                              +   +
                                    = rationalSqrt(n1, 2*n2) * array[ndarray::makeVector(n1-1, n2-1, n3)]
                                    + rationalSqrt(n3, 2*n2) * array[ndarray::makeVector(n1, n2-1, n3-1)];
                            }
                        }
                    }
                
                    return array;
                }
                
                } // anonymous
                
                //================= Impl Base Class =========================================================================
                
                class GaussHermiteConvolution::Impl {
                public:
                
                    Impl(int colOrder, ShapeletFunction const & psf);
                
                    virtual ndarray::Array<double const,2,2> evaluate(afw::geom::ellipses::Ellipse & ellipse) const = 0;
                
                    int getColOrder() const { return _colOrder; }
                
                    int getRowOrder() const { return _rowOrder; }
                
                    virtual ~Impl() {}
                
                protected:
                    int _rowOrder;
                    int _colOrder;
                    ShapeletFunction _psf;
                    ndarray::Array<double,2,2> _result;
                };
                
                GaussHermiteConvolution::Impl::Impl(
                    int colOrder, ShapeletFunction const & psf
                ) :
                    _rowOrder(colOrder + psf.getOrder()), _colOrder(colOrder), _psf(psf),
                    _result(ndarray::allocate(computeSize(_rowOrder), computeSize(_colOrder)))
                {
                    _psf.changeBasisType(HERMITE);
                }
                
                //================= ImplN: Arbitrary Order ==================================================================
                
                namespace {
                
                class ImplN : public GaussHermiteConvolution::Impl {
                public:
                
                    ImplN(int colOrder, ShapeletFunction const & psf);
                
                    virtual ndarray::Array<double const,2,2> evaluate(afw::geom::ellipses::Ellipse & ellipse) const;
                
                private:
                    TripleProductIntegral _tpi;
                    HermiteTransformMatrix _htm;
                };
                
                ImplN::ImplN(
                    int colOrder, ShapeletFunction const & psf
                ) :
                    GaussHermiteConvolution::Impl(colOrder, psf),
                    _tpi(psf.getOrder(), _rowOrder, _colOrder),
                    _htm(_rowOrder)
                {}
                
                ndarray::Array<double const,2,2> ImplN::evaluate(
                    afw::geom::ellipses::Ellipse & ellipse
                ) const {
                    ndarray::EigenView<double,2,2> result(_result);
                    ndarray::EigenView<double const,1,1> psf_coeff(_psf.getCoefficients());
                
                    Eigen::Matrix2d psfT = _psf.getEllipse().getCore().getGridTransform().invert().getMatrix();
                    Eigen::Matrix2d modelT = ellipse.getCore().getGridTransform().invert().getMatrix();
                    ellipse.convolve(_psf.getEllipse()).inPlace();
                    Eigen::Matrix2d convolvedTI = ellipse.getCore().getGridTransform().getMatrix() * std::sqrt(2.0);
                    Eigen::Matrix2d psfArg = (convolvedTI * psfT).transpose();
                    Eigen::Matrix2d modelArg = (convolvedTI * modelT).transpose();
                
                    int const psfOrder = _psf.getOrder();
                
                    Eigen::MatrixXd psfMat = _htm.compute(psfArg, psfOrder);
                    Eigen::MatrixXd modelMat = _htm.compute(modelArg, _colOrder);
                
                    // [kq]_m = \sum_m i^{n+m} [psfMat]_{m,n} [psf]_n
                    // kq is zero unless {n+m} is even
                    Eigen::VectorXd kq = Eigen::VectorXd::Zero(psfMat.size());
                    for (int m = 0, mo = 0; m <= psfOrder; mo += ++m) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
259  <a href="#ecb24f66">ecb24f66</a> -         for (int n = m, no = mo; n <= psfOrder; (no += ++n) += ++n) {</div>
              ?                                                 -           --------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
259  <a href="#203be8cd">203be8cd</a> +         for (int n = m, no = mo; n <= psfOrder; no += ++n, no += ++n) {</div>
              ?                                                      +++++++++++
                            if ((n + m) % 4) { // (n + m) % 4 is always 0 or 2
                                kq.segment(mo, m+1) -= psfMat.block(no, mo, n+1, m+1).adjoint() * psf_coeff.segment(no, n+1);
                            } else {
                                kq.segment(mo, m+1) += psfMat.block(no, mo, n+1, m+1).adjoint() * psf_coeff.segment(no, n+1);
                            }
                        }
                    }
                    kq *= 4.0 * afw::geom::PI;
                
                    // [kqb]_{m,n} = \sum_l i^{m-n-l} [kq]_l [tpi]_{l,m,n}
                    Eigen::MatrixXd kqb = Eigen::MatrixXd::Zero(result.rows(), result.cols());
                    {
                        ndarray::Array<double,3,3> b = _tpi.asArray();
                        ndarray::Vector<int,3> n, o, x;
                        x[0] = 0;
                        for (n[1] = o[1] = 0; n[1] <= _rowOrder; o[1] += ++n[1]) {
                            for (n[2] = o[2] = 0; n[2] <= _colOrder; o[2] += ++n[2]) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
277  <a href="#ecb24f66">ecb24f66</a> -                 for (n[0] = o[0] = bool((n[1]+n[2])%2); n[0] <= psfOrder; (o[0] += ++n[0]) += ++n[0]) {</div>
              ?                                                                           -                -----------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
277  <a href="#203be8cd">203be8cd</a> +                 for (n[0] = o[0] = bool((n[1]+n[2])%2); n[0] <= psfOrder; o[0] += ++n[0], o[0] += ++n[0]) {</div>
              ?                                                                                  ++++++++++++++++
                                    if (n[0] + n[2] < n[1]) continue; // b is triangular
                                    double factor = ((n[2] - n[0] - n[1]) % 4) ? -1.0 : 1.0;
                                    for (x[1] = 0; x[1] <= n[1]; ++x[1]) {
                                        for (x[2] = 0; x[2] <= n[2]; ++x[2]) {
                                            // TODO: optimize this inner loop - it's sparse
                                            double & out = kqb(o[1] + x[1], o[2] + x[2]);
                                            for (x[0] = 0; x[0] <= n[0]; ++x[0]) {
                                                out += factor * kq[o[0] + x[0]] * b[o + x];
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                
                    result.setZero();
                    for (int m = 0, mo = 0; m <= _rowOrder; mo += ++m) {
                        for (int n = 0, no = 0; n <= _colOrder; no += ++n) {
                            int jo = bool(n % 2);
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
298  <a href="#ecb24f66">ecb24f66</a> -             for (int j = jo; j <= n; (jo += ++j) += ++j) {</div>
              ?                                      -           --------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
298  <a href="#203be8cd">203be8cd</a> +             for (int j = jo; j <= n; jo += ++j, jo += ++j) {</div>
              ?                                           +++++++++++
                                if ((n - j) % 4) { // (n - j) % 4 is always 0 or 2
                                    result.block(mo, no, m+1, n+1)
                                        -= kqb.block(mo, jo, m+1, j+1) * modelMat.block(no, jo, n+1, j+1).adjoint();
                                } else {
                                    result.block(mo, no, m+1, n+1)
                                        += kqb.block(mo, jo, m+1, j+1) * modelMat.block(no, jo, n+1, j+1).adjoint();
                                }
                            }
                        }
                    }
                
                    return _result;
                }
                
                } // anonymous
                
                //================= Impl0: Zeroth Order =====================================================================
                
                namespace {
                
                class Impl0 : public GaussHermiteConvolution::Impl {
                public:
                
                    typedef double Scalar;
                
                    explicit Impl0(ShapeletFunction const & psf);
                
                    virtual ndarray::Array<double const,2,2> evaluate(afw::geom::ellipses::Ellipse & ellipse) const;
                
                private:
                    ndarray::Array<Scalar,1,0> _r;
                    ndarray::Array<Scalar,4,4> _p;
                };
                
                Impl0::Impl0(
                    ShapeletFunction const & psf
                ) :
                    GaussHermiteConvolution::Impl(0, psf),
                    _r(_result[ndarray::view()(0)]), // _result has one column, so it's more convenient if we have a 1-d view
                    _p(ndarray::allocate(ndarray::makeVector(_rowOrder+1, _rowOrder+1, _rowOrder+1, _rowOrder+1)))
                {
                    _p.deep() = 0.0;
                }
                
                ndarray::Array<double const,2,2> Impl0::evaluate(
                    afw::geom::ellipses::Ellipse & ellipse
                ) const {
                    ndarray::Array<double const,1,1> psfCoeff(_psf.getCoefficients());
                
                    Eigen::Matrix2d psfT = _psf.getEllipse().getCore().getGridTransform().invert().getMatrix();
                    ellipse.convolve(_psf.getEllipse()).inPlace();
                    Eigen::Matrix2d convolvedTI = ellipse.getCore().getGridTransform().getMatrix();
                    Eigen::Matrix2d psfArg = (convolvedTI * psfT).transpose();
                
                    int const psfOrder = _psf.getOrder();
                
                    // Just for readability: extract matrix elements and strides
                    double const sxx = psfArg(0,0);
                    double const sxy = psfArg(0,1);
                    double const syx = psfArg(1,0);
                    double const syy = psfArg(1,1);
                
                    int const idx_00_01 = _p.getStride<3>();
                    int const idx_00_10 = _p.getStride<2>();
                    int const idx_01_00 = _p.getStride<1>();
                    int const idx_10_00 = _p.getStride<0>();
                
                    // at each step in many of the loops, we increment n_x and decrement n_y (or likewise with m)
                    int const incr_n = idx_10_00 - idx_01_00;
                    int const incr_m = idx_00_10 - idx_00_01;
                
                    //---- Some terminology to help with the ugly math and abbreviated comments below
                
                    // The offsetX variables below are the offsets of the elements on the rhs of
                    // the recurrence relations, relative to the element we're setting on the
                    // lhs.  Hence a recurrence setting line will often look like this:
                    //
                    //    *pc = t1 * pc[offset1] + t2 * pc[offset2];
                    //
                    // Here, "pc" is a pointer to the current item, so we set it simply by
                    // dereferencing it, and we refer to the previous elements using the offsetX
                    // variables.  Number suffixes indicate the term in the recurrence, while
                    // letter suffices indicate different related recurrence relations.
                
                    double * p = _p.getData();
                    *p = 1.0;
                
                    // do n == 0, m >= 2, m even
                    if (psfOrder > 1) {
                        double const t1a = sxx*sxx + sxy*sxy - 1;
                        double const t1b = syy*syy + syx*syx - 1;
                        double const t2 = sxx*syx + sxy*syy;
                        int const offset1a = -2*idx_00_10;
                        int const offset1b = -2*idx_00_01;
                        int const offset2 = -idx_00_10 - idx_00_01;
                        for (int m = 2; m <= psfOrder; m += 2) {
                            int m_x = 0, m_y = m;
                            double * pc = p + idx_00_01*m_y;
                            // for m_x == 0, use 'b' recurrence, dropping terms that vanish for m_x == 0:
                            // p[n_x,n_y,m_x,m_y] = \sqrt{\frac{m_y-1}{m_y}} (S_{yy}^2 + S_{yx}^2 - 1) p[n_x,n_y,m_x,m_y-2]
                            for (; m_x == 0; ++m_x, --m_y, pc += incr_m) {
                                *pc = t1b*rationalSqrt(m_y-1,m_y)*pc[offset1b];
                            }
                            // for m_x == 1, use 'a' recurrence, dropping first term
                            for (; m_x == 1; ++m_x, --m_y, pc += incr_m) {
                                *pc = t2*rationalSqrt(m_y, m_x)*pc[offset2];
                            }
                            // for m_x > 0, m_y > 0, use full 'a' recurrence:
                            // p[n_x,n_y,m_x,m_y] = \sqrt{\frac{m_x-1}{m_x}} (S_{xx}^2 + S_{xy}^2 - 1) p[n_x,n_y,m_x-2,m_y]
                            //                    + \sqrt{m_y/m_x} (S_{xx}S_{yx} + S_{xy}S_{yy}) p[n_x,n_y,m_x-1,m_y-1]
                            for (; m_y > 0; ++m_x, --m_y, pc += incr_m) {
                                *pc = t1a*rationalSqrt(m_x-1,m_x)*pc[offset1a]
                                    + t2*rationalSqrt(m_y, m_x)*pc[offset2];
                            }
                            // for m_y == 0, use 'a' recurrence, drop 2nd term
                            for (; m_y == 0; ++m_x, --m_y, pc += incr_m) {
                                *pc = t1a*rationalSqrt(m_x-1,m_x)*pc[offset1a];
                            }
                        }
                    }
                
                    // do n > 0, m >= n, m + n even
                    if (psfOrder > 0) {
                        int const offset1a = -idx_10_00 - idx_00_10;
                        int const offset2a = -idx_10_00 - idx_00_01;
                        int const offset1b = -idx_01_00 - idx_00_01;
                        int const offset2b = -idx_01_00 - idx_00_10;
                        for (int n = 1; n <= psfOrder; ++n) {
                            int n_x = 0, n_y = n;
                            double * pnc = p + idx_01_00*n_y;
                            // for n_x == 0, use 'b' recurrence
                            // p[n_x,n_y,m_x,m_y] = \sqrt{m_x/n_x} S_{xx} p[n_x-1,n_y,m_x-1,m_y]
                            //                    + \sqrt{m_y,n_x} S_{yx} p[n_x-1,n_y,m_x,m_y-1]
                            for (; n_x == 0; ++n_x, --n_y, pnc += incr_n) {
                                for (int m = n; m <= psfOrder; m += 2) {
                                    int m_x = 0, m_y = m;
                                    double * pc = pnc + idx_00_01*m_y;
                                    // for m_x == 0, drop 2nd term
                                    for (; m_x == 0; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_y, n_y)*syy*pc[offset1b];
                                    }
                                    // for m_x > 0, m_y > 0, use both terms
                                    for (; m_x < m; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_y, n_y)*syy*pc[offset1b]
                                            + rationalSqrt(m_x, n_y)*sxy*pc[offset2b];
                                    }
                                    // for m_y == 0, drop 1st term
                                    for (; m_y == 0; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_x, n_y)*sxy*pc[offset2b];
                                    }
                                }
                            }
                            // for n_x > 0, use 'a' recurrence:
                            // p[n_x,n_y,m_x,m_y] = \sqrt{m_y/n_y} S_{yy} p[n_x,n_y-1,m_x,m_y-1]
                            //                    + \sqrt{m_x,n_y} S_{xy} p[n_x,n_y-1,m_x-1,m_y]
                            for (; n_x <= n; ++n_x, --n_y, pnc += incr_n) {
                                for (int m = n; m <= psfOrder; m += 2) {
                                    int m_x = 0, m_y = m;
                                    double * pc = pnc + idx_00_01*m_y;
                                    // for m_x == 0, drop 1st term
                                    for (; m_x == 0; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_y, n_x)*syx*pc[offset2a];
                                    }
                                    // for m_x > 0, m_y > 0, use both terms
                                    for (; m_x < m; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_x, n_x)*sxx*pc[offset1a]
                                            + rationalSqrt(m_y, n_x)*syx*pc[offset2a];
                                    }
                                    // for m_y == 0, drop 2nd term
                                    for (; m_y == 0; ++m_x, --m_y, pc += incr_m) {
                                        *pc = rationalSqrt(m_x, n_x)*sxx*pc[offset1a];
                                    }
                                }
                            }
                        }
                    }
                
                    // Form inner product between p and psfCoeffs, including 2\sqrt{\pi} i^{m-n} factor
                    double const f1 = 2.0 * std::sqrt(M_PI);
                    for (int n = 0, n_o = 0; n <= psfOrder; n_o += ++n) {
                        double const * pnc = p + idx_01_00*n;
                        ndarray::Array<double,1,0>::Iterator rIter = _r.begin() + n_o;
                        for (int n_x = 0; n_x <= n; ++n_x, ++rIter, pnc += incr_n) {
                            *rIter = 0;
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
483  <a href="#9ce9b9f7">9ce9b9f7</a> -             for (int m = n, m_o = computeSize(n-1); m <= psfOrder; (m_o += ++m) += ++m) {</div>
              ?                                                                    -            --------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
483  <a href="#203be8cd">203be8cd</a> +             for (int m = n, m_o = computeSize(n-1); m <= psfOrder; m_o += ++m, m_o += ++m) {</div>
              ?                                                                          ++++++++++++
                                double f2 = ((m-n) % 4) ? -f1 : f1;
                                double const * pc = pnc + idx_00_01*m;
                                ndarray::Array<double const,1,1>::Iterator psfIter = psfCoeff.begin() + m_o;
                                for (int m_x = 0; m_x <= m; ++m_x, ++psfIter, pc += incr_m) {
                                    *rIter += f2 * (*pc) * (*psfIter);
                                }
                            }
                        }
                    }
                
                    return _result;
                }
                
                } // anonymous
                
                //================= public GaussHermiteConvolution ==========================================================
                
                int GaussHermiteConvolution::getRowOrder() const { return _impl->getRowOrder(); }
                
                int GaussHermiteConvolution::getColOrder() const { return _impl->getColOrder(); }
                
                ndarray::Array<double const,2,2>
                GaussHermiteConvolution::evaluate(
                    afw::geom::ellipses::Ellipse & ellipse
                ) const {
                    return _impl->evaluate(ellipse);
                }
                
                GaussHermiteConvolution::GaussHermiteConvolution(
                    int colOrder,
                    ShapeletFunction const & psf
                ) : _impl() {
                    if (colOrder == 0) {
                        _impl.reset(new Impl0(psf));
                    } else {
                        _impl.reset(new ImplN(colOrder, psf));
                    }
                }
                
                GaussHermiteConvolution::~GaussHermiteConvolution() {}
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="9ce9b9f7"/></a>9ce9b9f7</h3>

<pre>
commit 9ce9b9f7c0b0a48fbe295be049f156666627eefa
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Aug 2 02:46:55 2013 -0400

    Added optimized zeroth-order convolution specialization
</pre>
<h3><a name="71552e6a"/></a>71552e6a</h3>

<pre>
commit 71552e6afd80cafddb64651e09fefed1160def70
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon May 21 19:06:59 2012 -0400

    Rename constant from NORMALIZATION to BASIS_NORMALIZATION.
</pre>
<h3><a name="8fc55e3d"/></a>8fc55e3d</h3>

<pre>
commit 8fc55e3d9aeb54081805fbe369693ec10c6bcfbe
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Aug 1 17:34:17 2013 -0400

    Add functions for integer and rational square roots.
</pre>
<h3><a name="ecb24f66"/></a>ecb24f66</h3>

<pre>
commit ecb24f66d5d17e3b7b3861eb13d8ba2175f33ada
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Tue Feb 22 19:17:04 2011 +0000

    afw #1556 - moved ShapeletConvolution to afw as HermiteConvolution, added MultiShapeletFunction
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="203be8cd"/></a>203be8cd</h3>

<pre>
commit 203be8cd2be8dd5dd018f65a30308f0f4cdece8e
Author: Russell Owen <rowen@uw.edu>
Date:   Mon Oct 6 16:34:01 2014 -0700

    Fix compiler warning: multiple unsequenced modifications
</pre>
<h3><a name="d42a56fb"/></a>d42a56fb</h3>

<pre>
commit d42a56fb93adee80e1375eccb1e2f722211a003d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sun May 18 17:43:28 2014 -0400

    Better consistency in whitespace near commas, operators.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_28"><a name="tests/profiles.py"/></a>tests/profiles.py</h1>

<h3 id="toc_29">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                #
                # LSST Data Management System
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
5    <a href="#dd26dea3">dd26dea3</a> - # Copyright 2008-2013 LSST Corporation.</div>
              ?                     ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
5    <a href="#c17fe67f">c17fe67f</a> + # Copyright 2008-2014 LSST Corporation.</div>
              ?                     ^
                #
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                #
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                #
                # You should have received a copy of the LSST License Statement and
                # the GNU General Public License along with this program.  If not,
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                import unittest
                import numpy
                import os
                
                import lsst.utils.tests
                import lsst.afw.geom
                import lsst.afw.geom.ellipses as el
                import lsst.shapelet.tractor
                import lsst.shapelet.tests
                import lsst.afw.image
                
                # These parameters match those used to generate the check images; see
                # tests/data/generate.py
                GALAXY_RADIUS = 8.0
                PSF_SIGMA = 2.0
                E1 = 0.3
                E2 = -0.2
                PROFILES = [
                    ("exp", 9, 8),
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#929e0304">929e0304</a> -     #("ser2", 9, 8),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#929e0304">929e0304</a> -     #("ser3", 9, 8),</div>
                    ("dev", 9, 8),
                    ]
                
                CHECK_COMPONENT_IMAGES = False
                
                class ProfileTestCase(lsst.shapelet.tests.ShapeletTestCase):
                
                    def testRadii(self):
                        """Check RadialProfile definitions of moments and half-light radii.
                        """
                        s = numpy.linspace(-20.0, 20.0, 1000)
                        x, y = numpy.meshgrid(s, s)
                        r = (x**2 + y**2)**0.5
                        dxdy = (s[1] - s[0])**2
                        for name in ["gaussian", "exp", "ser2", "luv", "lux"]:
                            profile = lsst.shapelet.RadialProfile.get(name)
                            z = profile.evaluate(r) * dxdy
                            # lux and luv don't use the true half-light radius; instead they use the half-light radius
                            # of the exp and dev profiles they approximate
                            if not name.startswith("lu"):
                                self.assertClose(z[r < 1].sum(), 0.5*z.sum(), rtol=0.01)
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
65   <a href="#c17fe67f">c17fe67f</a> +             # lhs of this comparison is the moments radius (using a sum approximation to the integral)</div>
                            self.assertClose(((z*x**2).sum() / z.sum())**0.5, profile.getMomentsRadiusFactor(), rtol=0.01)
                
                    def testGaussian(self):
                        """Test that the Gaussian profile's shapelet 'approximation' is actually exact.
                        """
                        profile = lsst.shapelet.RadialProfile.get("gaussian")
                        r = numpy.linspace(0.0, 4.0, 100)
                        z1 = profile.evaluate(r)
                        basis = profile.getBasis(1)
                        z2 = lsst.shapelet.tractor.evaluateRadial(basis, r, sbNormalize=True)[0,:]
                        self.assertClose(z1, z2, rtol=1E-8)
                
                    def testShapeletApproximations(self):
                        psf0 = lsst.shapelet.ShapeletFunction(0, lsst.shapelet.HERMITE, PSF_SIGMA)
                        psf0.getCoefficients()[:] = 1.0 / lsst.shapelet.ShapeletFunction.FLUX_FACTOR
                        psf = lsst.shapelet.MultiShapeletFunction()
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#dd26dea3">dd26dea3</a> -         psf.getElements().push_back(psf0)</div>
              ?                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#b4ea1017">b4ea1017</a> +         psf.getComponents().push_back(psf0)</div>
              ?                ^^ +++
                        psf.normalize()
                        ellipse = el.Separable[el.Distortion, el.DeterminantRadius](E1, E2, GALAXY_RADIUS)
                        for name, nComponents, maxRadius in PROFILES:
                            # check1 is the multi-Gaussian approximation, as convolved and evaluated by GalSim,
                            check1 = lsst.afw.image.ImageD(os.path.join("tests", "data", name + "-approx.fits")).getArray()
                            xc = check1.shape[1] // 2
                            yc = check1.shape[0] // 2
                            xb = numpy.arange(check1.shape[1], dtype=float) - xc
                            yb = numpy.arange(check1.shape[0], dtype=float) - yc
                            xg, yg = numpy.meshgrid(xb, yb)
                
                            basis = lsst.shapelet.RadialProfile.get(name).getBasis(nComponents, maxRadius)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#dd26dea3">dd26dea3</a> -             builder = lsst.shapelet.MultiShapeletMatrixBuilderD(basis, psf, xg.ravel(), yg.ravel())</div>
              ?                                      -------------              ------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#13feffe1">13feffe1</a> +             builder = lsst.shapelet.MatrixBuilderD.Factory(xg.ravel(), yg.ravel(), basis, psf)()</div>
              ?                                                   ++++++++                       ++++++++++++++
                            image1 = numpy.zeros(check1.shape, dtype=float)
                            matrix = image1.reshape(check1.size, 1)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#dd26dea3">dd26dea3</a> -             builder.build(matrix, el.Ellipse(ellipse))</div>
              ?                    ------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
98   <a href="#13feffe1">13feffe1</a> +             builder(matrix, el.Ellipse(ellipse))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
100  <a href="#dd26dea3">dd26dea3</a> -             self.assertClose(check1, image1, plotOnFailure=True, rtol=5E-5, relTo=check1.max())</div>
              ?                                                            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#243c7b79">243c7b79</a> +             self.assertClose(check1, image1, plotOnFailure=False, rtol=5E-5, relTo=check1.max())</div>
              ?                                                            ^^^^
                            msf = basis.makeFunction(el.Ellipse(ellipse, lsst.afw.geom.Point2D(xc, yc)),
                                                     numpy.array([1.0], dtype=float))
                            msf = msf.convolve(psf)
                            image2 = numpy.zeros(check1.shape, dtype=float)
                            msf.evaluate().addToImage(lsst.afw.image.ImageD(image2, False))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
106  <a href="#dd26dea3">dd26dea3</a> -             self.assertClose(check1, image2, plotOnFailure=True, rtol=5E-5, relTo=check1.max())</div>
              ?                                                            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#243c7b79">243c7b79</a> +             self.assertClose(check1, image2, plotOnFailure=False, rtol=5E-5, relTo=check1.max())</div>
              ?                                                            ^^^^
                
                            if name == 'exp':
                                # check2 is the exact profile, again by GalSim.
                                # We only check exp against the exact profile.  The other approximations are less
                                # accurate, and we only really need to test one.  The real measure of whether these
                                # profiles are good enough is more complicated than what we can do in a unit test.
                                check2 = lsst.afw.image.ImageD(
                                    os.path.join("tests", "data", name + "-exact.fits")
                                ).getArray()
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
116  <a href="#dd26dea3">dd26dea3</a> -                 self.assertClose(check2, image1, plotOnFailure=True, rtol=1E-3, relTo=check2.max())</div>
              ?                                                                ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#243c7b79">243c7b79</a> +                 self.assertClose(check2, image1, plotOnFailure=False, rtol=1E-3, relTo=check2.max())</div>
              ?                                                                ^^^^
                
                            if CHECK_COMPONENT_IMAGES:
                                # This was once useful for debugging test failures, and may be again, but it's
                                # redundant with the above and requires putting more check images in git, so
                                # it's disabled by default.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
122  <a href="#dd26dea3">dd26dea3</a> -                 for n, sf in enumerate(msf.getElements()):</div>
              ?                                               ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
121  <a href="#b4ea1017">b4ea1017</a> +                 for n, sf in enumerate(msf.getComponents()):</div>
              ?                                               ^^ +++
                                    check = lsst.afw.image.ImageD(
                                        os.path.join("tests", "data", "%s-approx-%0d.fits" % (name, n))
                                    ).getArray()
                                    image = numpy.zeros(check1.shape, dtype=float)
                                    sf.evaluate().addToImage(lsst.afw.image.ImageD(image, False))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#dd26dea3">dd26dea3</a> -                     self.assertClose(check, image, plotOnFailure=True, rtol=5E-5, relTo=check1.max())</div>
              ?                                                                  ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
127  <a href="#243c7b79">243c7b79</a> +                     self.assertClose(check, image, plotOnFailure=False, rtol=5E-5, relTo=check1.max())</div>
              ?                                                                  ^^^^
                
                
                def suite():
                    """Returns a suite containing all the test cases in this module."""
                
                    lsst.utils.tests.init()
                
                    suites = []
                    suites += unittest.makeSuite(ProfileTestCase)
                    suites += unittest.makeSuite(lsst.utils.tests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(shouldExit=False):
                    """Run the tests"""
                    lsst.utils.tests.run(suite(), shouldExit)
                
                if __name__ == "__main__":
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="929e0304"/></a>929e0304</h3>

<pre>
commit 929e0304ad1d9862f5b3b2744e4c08c042b181dd
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
</pre>
<h3><a name="dd26dea3"/></a>dd26dea3</h3>

<pre>
commit dd26dea31d3178f793602bbedab2b11ecf985291
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 19 14:57:58 2013 -0400

    Refactor and strengthen unit tests
    
    New code in utils makes gives us better control over f.p.
    comparisons.
    
    Split tests into separate files; the original was getting
    too big.  Put utility code in lsst.shapelet.tests so
    downstream packages (e.g. meas_ext*_multiShapelet) can use.
    
    Added tests for Tractor profiles, comparing against GalSim.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="13feffe1"/></a>13feffe1</h3>

<pre>
commit 13feffe1b704733fdb667b7e4d8f7b5b9e763861
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 17 18:07:31 2014 -0400

    Remove old MultiShapeletMatrixBuilder
    
    This has been replaced by MatrixBuilder
</pre>
<h3><a name="243c7b79"/></a>243c7b79</h3>

<pre>
commit 243c7b7980276d773771df29e9cc142693743952
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 6 18:12:49 2015 -0400

    Don't plot test failures by default.
    
    Failure to access the display can hide the true failure; it's easy
    enough to set these to True temporarily when debugging the
    test failure on a machine with display capabilities.
</pre>
<h3><a name="c17fe67f"/></a>c17fe67f</h3>

<pre>
commit c17fe67f384d80489135f4620f219637706beff6
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
    
    Also updated tests and visualization code in tractor.py to
    make use of the new class.
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_30"><a name="tests/testMultiShapelet.py"/></a>tests/testMultiShapelet.py</h1>

<h3 id="toc_31">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                #
                # LSST Data Management System
                # Copyright 2008-2013 LSST Corporation.
                #
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                #
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                #
                # You should have received a copy of the LSST License Statement and
                # the GNU General Public License along with this program.  If not,
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                import unittest
                import numpy
                import cPickle
                
                import lsst.utils.tests
                import lsst.afw.geom.ellipses as ellipses
                import lsst.shapelet.tests
                import lsst.afw.image
                
                numpy.random.seed(500)
                
                class MultiShapeletTestCase(lsst.shapelet.tests.ShapeletTestCase):
                
                    def testMoments(self):
                        x = numpy.linspace(-50, 50, 1001)
                        y = x
                        function = self.makeRandomMultiShapeletFunction()
                        x = numpy.linspace(-10, 10, 101)
                        y = x
                        z = self.makeImage(function, x, y)
                        self.checkMoments(function, x, y, z)
                
                    def testPickle(self):
                        function1 = self.makeRandomMultiShapeletFunction()
                        s = cPickle.dumps(function1, protocol=2)
                        function2 = cPickle.loads(s)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#65bbc3f5">65bbc3f5</a> -         for element1, element2 in zip(function1.getElements(), function2.getElements()):</div>
              ?             ^^^       ^^^                          ^^^                      ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#b4ea1017">b4ea1017</a> +         for component1, component2 in zip(function1.getComponents(), function2.getComponents()):</div>
              ?             ^^ +++      ^^ +++                         ^^ +++                     ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#65bbc3f5">65bbc3f5</a> -             self.assertEqual(element1.getOrder(), element2.getOrder())</div>
              ?                              ^^^                  ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#b4ea1017">b4ea1017</a> +             self.assertEqual(component1.getOrder(), component2.getOrder())</div>
              ?                              ^^ +++                 ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#65bbc3f5">65bbc3f5</a> -             self.assertEqual(element1.getBasisType(), element2.getBasisType())</div>
              ?                              ^^^                      ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#b4ea1017">b4ea1017</a> +             self.assertEqual(component1.getBasisType(), component2.getBasisType())</div>
              ?                              ^^ +++                     ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#65bbc3f5">65bbc3f5</a> -             self.assertClose(element1.getEllipse().getParameterVector(),</div>
              ?                              ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#b4ea1017">b4ea1017</a> +             self.assertClose(component1.getEllipse().getParameterVector(),</div>
              ?                              ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#65bbc3f5">65bbc3f5</a> -                              element2.getEllipse().getParameterVector())</div>
              ?                              ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#b4ea1017">b4ea1017</a> +                              component2.getEllipse().getParameterVector())</div>
              ?                              ^^ +++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#65bbc3f5">65bbc3f5</a> -             self.assertClose(element1.getCoefficients(), element2.getCoefficients())</div>
              ?                              ^^^                         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#b4ea1017">b4ea1017</a> +             self.assertClose(component1.getCoefficients(), component2.getCoefficients())</div>
              ?                              ^^ +++                        ^^ +++
                
                    def testConvolveGaussians(self):
                        sigma1 = [lsst.afw.geom.ellipses.Quadrupole(6.0, 5.0, 2.0),
                                  lsst.afw.geom.ellipses.Quadrupole(8.0, 10.0, -1.0)]
                        sigma2 = [lsst.afw.geom.ellipses.Quadrupole(7.0, 12.0, -2.0),
                                  lsst.afw.geom.ellipses.Quadrupole(7.0, 9.0, 1.0)]
                        alpha1 = [0.6, 0.4]
                        alpha2 = [0.35, 0.65]
                        sigma3 = []
                        alpha3 = []
                
                        def makeMultiShapeletFunction(alpha, sigma):
                            msf = lsst.shapelet.MultiShapeletFunction()
                            for a, s in zip(alpha, sigma):
                                f = lsst.shapelet.ShapeletFunction(0, lsst.shapelet.HERMITE,
                                                                   lsst.afw.geom.ellipses.Ellipse(s))
                                f.getCoefficients()[0] = a / lsst.shapelet.ShapeletFunction.FLUX_FACTOR
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#dd26dea3">dd26dea3</a> -                 msf.getElements().push_back(f)</div>
              ?                        ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#b4ea1017">b4ea1017</a> +                 msf.getComponents().push_back(f)</div>
              ?                        ^^ +++
                            return msf
                        for a1, s1 in zip(alpha1, sigma1):
                            for a2, s2 in zip(alpha2, sigma2):
                                sigma3.append(lsst.afw.geom.ellipses.Quadrupole(s1.getIxx() + s2.getIxx(),
                                                                  s1.getIyy() + s2.getIyy(),
                                                                  s1.getIxy() + s2.getIxy()))
                                alpha3.append(a1 * a2)
                        msf1 = makeMultiShapeletFunction(alpha1, sigma1)
                        msf2 = makeMultiShapeletFunction(alpha2, sigma2)
                        msf3a = makeMultiShapeletFunction(alpha3, sigma3)
                        msf3b = msf1.convolve(msf2)
                
                        # Compare the parameters of the MultiShapeletFunctions
                        self.compareMultiShapeletFunctions(msf3a, msf3b)
                
                        # Just to be extra sure, we test that the images are also the same
                        x = numpy.linspace(-20, 20, 41)
                        y = numpy.linspace(-20, 20, 41)
                        image3a = self.makeImage(msf3a, x, y)
                        image3b = self.makeImage(msf3b, x, y)
                        self.assertClose(image3a, image3b)
                        
                        # Now we test against two test images: one implemented right here with numpy calls...
                        xg, yg = numpy.meshgrid(x, y)
                        def evalMultiGaussian(alpha, sigma):
                            matQ = numpy.array([[sigma.getIxx(), sigma.getIxy()],
                                                [sigma.getIxy(), sigma.getIyy()]],
                                               dtype=float)
                            invQ = numpy.linalg.inv(matQ)
                            norm = alpha / numpy.linalg.det(2.0 * numpy.pi * matQ)**0.5
                            return norm * numpy.exp(-0.5 * (invQ[0,0]*xg**2 + 2.0*invQ[0,1]*xg*yg + invQ[1,1]*yg**2))
                        image3c = numpy.zeros(xg.shape, dtype=float)
                        for a, s in zip(alpha3, sigma3):
                            image3c += evalMultiGaussian(a, s)
                        self.assertClose(image3c, image3a, rtol=1E-6, relTo=numpy.max(image3c),
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#dd26dea3">dd26dea3</a> -                          printFailures=True, plotOnFailure=True)</div>
              ?                                                            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#243c7b79">243c7b79</a> +                          printFailures=True, plotOnFailure=False)</div>
              ?                                                            ^^^^
                        
                        # And the second produced by GalSim
                        if False:
                            # Print inputs to screen so we can make a test image with GalSim (see tests/data/generate.py)
                            # Output can be pasted into that file to generate the check image.
                            def printForGalSim(alpha, sigma):
                                print "galsim.Add(["
                                for a, s in zip(alpha, sigma):
                                    e = lsst.afw.geom.ellipses.Separable[lsst.afw.geom.ellipses.Distortion,
                                                                         lsst.afw.geom.ellipses.DeterminantRadius](s)
                                    print ("    makeGaussian(flux=%f, e1=%8.8f, e2=%8.8f, sigma=%8.8f),"
                                           % (a, e.getE1(), e.getE2(), e.getRadius()))
                                print "])"
                            printForGalSim(alpha1, sigma1)
                            printForGalSim(alpha2, sigma2)
                        image3d = lsst.afw.image.ImageF("tests/data/gaussians.fits").getArray().astype(float)
                        self.assertClose(image3d, image3a, rtol=1E-6, relTo=numpy.max(image3d),
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#dd26dea3">dd26dea3</a> -                          printFailures=True, plotOnFailure=True)</div>
              ?                                                            ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#243c7b79">243c7b79</a> +                          printFailures=True, plotOnFailure=False)</div>
              ?                                                            ^^^^
                
                
                    def testBasisNormalize(self):
                        def makePositiveMatrix(*shape):
                            """Return a random basis matrix, but with a lot of power
                            in the zeroth component to ensure the integral is positve."""
                            a = numpy.random.randn(*shape)
                            a[0,:] += 4.0
                            return a
                        basis = lsst.shapelet.MultiShapeletBasis(2)
                        basis.addComponent(0.5, 1, makePositiveMatrix(3,2))
                        basis.addComponent(1.0, 2, makePositiveMatrix(6,2))
                        basis.addComponent(1.2, 0, makePositiveMatrix(1,2))
                        basis.normalize()
                        for n in range(2):
                            coefficients = numpy.zeros(2, dtype=float)
                            coefficients[n] = 1.0
                            msf = basis.makeFunction(lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Axes()),
                                                     coefficients)
                            self.assertClose(msf.evaluate().integrate(), 1.0)
                
                    def testBasisScale(self):
                        ellipse = lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Axes())
                        basis = lsst.shapelet.MultiShapeletBasis(2)
                        basis.addComponent(0.5, 1, numpy.random.randn(3,2))
                        basis.addComponent(1.0, 2, numpy.random.randn(6,2))
                        basis.addComponent(1.2, 0, numpy.random.randn(1,2))
                        msf1 = [basis.makeFunction(ellipse, self.makeUnitVector(i,2)) for i in range(2)]
                        basis.scale(2.0)
                        ellipse.getCore().scale(0.5)
                        msf2 = [basis.makeFunction(ellipse, self.makeUnitVector(i,2)) for i in range(2)]
                        for a, b in zip(msf1, msf2):
                            self.compareMultiShapeletFunctions(a, b)
                
                    def testBasisMerge(self):
                        ellipse = lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Axes())
                        basis1 = lsst.shapelet.MultiShapeletBasis(2)
                        basis1.addComponent(0.5, 1, numpy.random.randn(3,2))
                        basis1.addComponent(1.0, 2, numpy.random.randn(6,2))
                        basis1.addComponent(1.2, 0, numpy.random.randn(1,2))
                        basis2 = lsst.shapelet.MultiShapeletBasis(3)
                        basis2.addComponent(0.4, 1, numpy.random.randn(3,3))
                        basis2.addComponent(1.1, 2, numpy.random.randn(6,3))
                        basis2.addComponent(1.6, 0, numpy.random.randn(1,3))
                        basis3 = lsst.shapelet.MultiShapeletBasis(basis1)
                        basis3.merge(basis2)
                        self.assertEqual(basis3.getSize(), 5)
                        msf1 = [basis1.makeFunction(ellipse, self.makeUnitVector(i,2)) for i in range(2)]
                        msf2 = [basis2.makeFunction(ellipse, self.makeUnitVector(i,3)) for i in range(3)]
                        msf3 = [basis3.makeFunction(ellipse, self.makeUnitVector(i,5)) for i in range(5)]
                        for a, b in zip(msf3, msf1+msf2):
                            self.compareMultiShapeletFunctions(a, b)
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
182  <a href="#dd26dea3">dd26dea3</a> -     def testMatrixBuilder(self):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
183  <a href="#dd26dea3">dd26dea3</a> -         basis = lsst.shapelet.MultiShapeletBasis(2)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
184  <a href="#dd26dea3">dd26dea3</a> -         basis.addComponent(0.5, 1, numpy.random.randn(3,2))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
185  <a href="#dd26dea3">dd26dea3</a> -         basis.addComponent(1.0, 2, numpy.random.randn(6,2))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
186  <a href="#dd26dea3">dd26dea3</a> -         basis.addComponent(1.2, 0, numpy.random.randn(1,2))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
187  <a href="#dd26dea3">dd26dea3</a> -         psf = self.makeRandomMultiShapeletFunction()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
188  <a href="#dd26dea3">dd26dea3</a> -         psf.normalize()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
189  <a href="#fd16c93f">fd16c93f</a> -         ellipse1 = lsst.afw.geom.ellipses.Ellipse(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
190  <a href="#dd26dea3">dd26dea3</a> -             lsst.afw.geom.ellipses.Axes(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
191  <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=1, high=2)),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=1, high=2)),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
193  <a href="#dd26dea3">dd26dea3</a> -                 float(numpy.random.uniform(low=0, high=numpy.pi))</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
194  <a href="#dd26dea3">dd26dea3</a> -                 ),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
195  <a href="#dd26dea3">dd26dea3</a> -             lsst.afw.geom.Point2D(0.23, -0.15)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
196  <a href="#dd26dea3">dd26dea3</a> -             )</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
197  <a href="#fd16c93f">fd16c93f</a> -         ellipse2 = lsst.afw.geom.ellipses.Ellipse(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
198  <a href="#fd16c93f">fd16c93f</a> -             lsst.afw.geom.ellipses.Axes(0.0, 0.0, 0.0),</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
199  <a href="#fd16c93f">fd16c93f</a> -             lsst.afw.geom.Point2D(-0.2, 0.12)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
200  <a href="#fd16c93f">fd16c93f</a> -             )</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
201  <a href="#dd26dea3">dd26dea3</a> -         coefficients = numpy.random.randn(2)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
202  <a href="#fd16c93f">fd16c93f</a> -         msf1 = basis.makeFunction(ellipse1, coefficients).convolve(psf)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
203  <a href="#fd16c93f">fd16c93f</a> -         msf2 = basis.makeFunction(ellipse2, coefficients).convolve(psf)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
204  <a href="#dd26dea3">dd26dea3</a> -         xa = numpy.random.randn(50)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
205  <a href="#dd26dea3">dd26dea3</a> -         ya = numpy.random.randn(50)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
206  <a href="#fd16c93f">fd16c93f</a> -         z01 = numpy.zeros(xa.shape, dtype=float)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
207  <a href="#fd16c93f">fd16c93f</a> -         z02 = numpy.zeros(xa.shape, dtype=float)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
208  <a href="#fd16c93f">fd16c93f</a> -         ev1 = msf1.evaluate()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
209  <a href="#fd16c93f">fd16c93f</a> -         ev2 = msf2.evaluate()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
210  <a href="#dd26dea3">dd26dea3</a> -         n = 0</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
211  <a href="#dd26dea3">dd26dea3</a> -         for x, y in zip(xa, ya):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
212  <a href="#fd16c93f">fd16c93f</a> -             z01[n] = ev1(x, y)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
213  <a href="#fd16c93f">fd16c93f</a> -             z02[n] = ev2(x, y)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
214  <a href="#dd26dea3">dd26dea3</a> -             n += 1</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
215  <a href="#dd26dea3">dd26dea3</a> -         builder = lsst.shapelet.MultiShapeletMatrixBuilderD(basis, psf, xa, ya)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
216  <a href="#fd16c93f">fd16c93f</a> -         m1 = numpy.zeros((basis.getSize(), xa.size), dtype=float).transpose()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
217  <a href="#fd16c93f">fd16c93f</a> -         m2 = numpy.zeros((basis.getSize(), xa.size), dtype=float).transpose()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
218  <a href="#fd16c93f">fd16c93f</a> -         builder.build(m1, ellipse1)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
219  <a href="#fd16c93f">fd16c93f</a> -         builder.build(m2, ellipse2)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
220  <a href="#fd16c93f">fd16c93f</a> -         z11 = numpy.dot(m1, coefficients)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
221  <a href="#fd16c93f">fd16c93f</a> -         z12 = numpy.dot(m2, coefficients)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
222  <a href="#fd16c93f">fd16c93f</a> -         self.assertClose(z11, z01, rtol=1E-13)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
223  <a href="#fd16c93f">fd16c93f</a> -         self.assertClose(z12, z02, rtol=1E-13)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
224  <a href="#dd26dea3">dd26dea3</a> - </div>
                def suite():
                    """Returns a suite containing all the test cases in this module."""
                
                    lsst.utils.tests.init()
                
                    suites = []
                    suites += unittest.makeSuite(MultiShapeletTestCase)
                    suites += unittest.makeSuite(lsst.utils.tests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(shouldExit=False):
                    """Run the tests"""
                    lsst.utils.tests.run(suite(), shouldExit)
                
                if __name__ == "__main__":
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="fd16c93f"/></a>fd16c93f</h3>

<pre>
commit fd16c93fe9b8f109f068d5ee3f06fa55ec6de497
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sat May 11 17:08:23 2013 -0400

    Extend unit tests for MultiShapeletMatrixBuilder to zero radius.
</pre>
<h3><a name="65bbc3f5"/></a>65bbc3f5</h3>

<pre>
commit 65bbc3f59ae533bec29e267996f07f413ad3284e
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 31 14:03:06 2013 -0400

    Add pickle support for ShapeletFunction, MultiShapeletFunction
</pre>
<h3><a name="dd26dea3"/></a>dd26dea3</h3>

<pre>
commit dd26dea31d3178f793602bbedab2b11ecf985291
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 19 14:57:58 2013 -0400

    Refactor and strengthen unit tests
    
    New code in utils makes gives us better control over f.p.
    comparisons.
    
    Split tests into separate files; the original was getting
    too big.  Put utility code in lsst.shapelet.tests so
    downstream packages (e.g. meas_ext*_multiShapelet) can use.
    
    Added tests for Tractor profiles, comparing against GalSim.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="243c7b79"/></a>243c7b79</h3>

<pre>
commit 243c7b7980276d773771df29e9cc142693743952
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 6 18:12:49 2015 -0400

    Don't plot test failures by default.
    
    Failure to access the display can hide the true failure; it's easy
    enough to set these to True temporarily when debugging the
    test failure on a machine with display capabilities.
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_32"><a name="tests/testProjection.py"/></a>tests/testProjection.py</h1>

<h3 id="toc_33">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                #
                # LSST Data Management System
                # Copyright 2008-2013 LSST Corporation.
                #
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                #
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                #
                # You should have received a copy of the LSST License Statement and
                # the GNU General Public License along with this program.  If not,
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                import unittest
                import numpy
                
                import lsst.utils.tests
                import lsst.pex.exceptions
                import lsst.afw.geom.ellipses
                import lsst.shapelet.tests
                import lsst.afw.image
                
                numpy.random.seed(500)
                
                class ProjectionTestCase(lsst.shapelet.tests.ShapeletTestCase):
                
                    def setUp(self):
                        self.ghp = lsst.shapelet.GaussHermiteProjection(16)
                
                    def testRotation(self):
                        order = 4
                        size = lsst.shapelet.computeSize(order)
                        nPoints = 100
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#dd26dea3">dd26dea3</a> -         unitCircle = lsst.afw.geom.ellipses.Quadrupole(1.0, 1.0, 0.0)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#6d5f02e1">6d5f02e1</a> +         unitCircle = lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Quadrupole(1.0, 1.0, 0.0))</div>
              ?                      +++++++++++++++++++++++++++++++                                                +
                        # This matrix should represent a pure rotation in shapelet space, which can be done exactly.
                        inputTransform = lsst.afw.geom.LinearTransform.makeRotation(0.0*lsst.afw.geom.radians)
                        outputTransform = lsst.afw.geom.LinearTransform.makeRotation(numpy.pi/3*lsst.afw.geom.radians)
                        m = self.ghp.compute(inputTransform, order, outputTransform, order)
                        # If we apply a rotation by numpy.pi/3 six times, we should get back where we started with.
                        self.assertClose(numpy.linalg.matrix_power(m, 6), numpy.identity(size), rtol=1E-14, atol=1E-14)
                        # Now we test that we get the same result (up to round-off error) for a bunch of test points.
                        inputTestPoints = numpy.random.randn(2, nPoints)
                        outputTestPoints = numpy.dot(outputTransform.getMatrix(), inputTestPoints)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#dd26dea3">dd26dea3</a> -         inputBuilder = lsst.shapelet.ModelBuilderD(inputTestPoints[0,:], inputTestPoints[1,:])</div>
              ?                                       ^^^^                              ----------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#6d5f02e1">6d5f02e1</a> +         inputBuilder = lsst.shapelet.MatrixBuilderD.Factory(inputTestPoints[0,:],</div>
              ?                                       ^^^^^        ++++++++
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#6d5f02e1">6d5f02e1</a> +                                                             inputTestPoints[1,:], order)()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#dd26dea3">dd26dea3</a> -         outputBuilder = lsst.shapelet.ModelBuilderD(outputTestPoints[0,:], outputTestPoints[1,:])</div>
              ?                                        ^^^^                               -----------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#6d5f02e1">6d5f02e1</a> +         outputBuilder = lsst.shapelet.MatrixBuilderD.Factory(outputTestPoints[0,:],</div>
              ?                                        ^^^^^        ++++++++
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#6d5f02e1">6d5f02e1</a> +                                                              outputTestPoints[1,:], order)()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#dd26dea3">dd26dea3</a> -         inputBuilder.update(unitCircle)</div>
              ?                     -------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#6d5f02e1">6d5f02e1</a> +         inputBasis = inputBuilder(unitCircle)</div>
              ?        +++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#dd26dea3">dd26dea3</a> -         outputBuilder.update(unitCircle)</div>
              ?                      -------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#6d5f02e1">6d5f02e1</a> +         outputBasis = outputBuilder(unitCircle)</div>
              ?        ++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#dd26dea3">dd26dea3</a> -         inputBasis= numpy.zeros((size, nPoints), dtype=float).transpose()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#dd26dea3">dd26dea3</a> -         outputBasis = numpy.zeros((size, nPoints), dtype=float).transpose()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#dd26dea3">dd26dea3</a> -         inputBuilder.addModelMatrix(order, inputBasis)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#dd26dea3">dd26dea3</a> -         outputBuilder.addModelMatrix(order, outputBasis)</div>
                        self.assertClose(numpy.dot(outputBasis, m), inputBasis, rtol=1E-13)
                
                    def testPerturbation(self):
                        inputEllipse = lsst.afw.geom.ellipses.Quadrupole(2.0, 2.0, 0.0)
                        outputEllipse = lsst.afw.geom.ellipses.Quadrupole(2.01, 2.0, 0.02)
                        inputShapelet = lsst.shapelet.ShapeletFunction(2, lsst.shapelet.HERMITE,
                                                                       lsst.afw.geom.ellipses.Ellipse(inputEllipse))
                        outputShapelet = lsst.shapelet.ShapeletFunction(8, lsst.shapelet.HERMITE,
                                                                        lsst.afw.geom.ellipses.Ellipse(outputEllipse))
                        m = self.ghp.compute(inputEllipse, inputShapelet.getOrder(),
                                             outputEllipse, outputShapelet.getOrder())
                        x = numpy.random.randn(50)
                        y = numpy.random.randn(50)
                        for i, nx, ny in lsst.shapelet.HermiteIndexGenerator(2):
                            inputShapelet.getCoefficients()[:] = 0.0
                            inputShapelet.getCoefficients()[i] = 1.0
                            outputShapelet.getCoefficients()[:] = numpy.dot(m, inputShapelet.getCoefficients())
                            inputEv = inputShapelet.evaluate()
                            outputEv = outputShapelet.evaluate()
                            inputZ = numpy.array([inputEv(px,py) for px,py in zip(x,y)])
                            outputZ = numpy.array([outputEv(px,py) for px,py in zip(x,y)])
                            # tolerances here aren't rigorous, because we're testing an approximation without
                            # computing how good it should be; it's mostly just a regression/sanity test
                            self.assertClose(inputZ, outputZ, rtol=5E-3)
                
                    def testConvolution0(self):
                        """Test that the specialization for zeroth-order convolution produces the same tensor
                        as the general case, which is tested more rigorously elsewhere."""
                        psf = self.makeRandomShapeletFunction(order=4)
                        ellipse1 = lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Quadrupole(2.0, 3.0, 1.0))
                        ellipse2 = lsst.afw.geom.ellipses.Ellipse(ellipse1)
                        ghcN = lsst.shapelet.GaussHermiteConvolution(1, psf)
                        ghc0 = lsst.shapelet.GaussHermiteConvolution(0, psf)
                        rN = ghcN.evaluate(ellipse1)
                        r0 = ghc0.evaluate(ellipse2)
                        self.assertClose(rN[:15,0], r0[:15,0], rtol=1E-14)
                
                def suite():
                    """Returns a suite containing all the test cases in this module."""
                
                    lsst.utils.tests.init()
                
                    suites = []
                    suites += unittest.makeSuite(ProjectionTestCase)
                    suites += unittest.makeSuite(lsst.utils.tests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(shouldExit=False):
                    """Run the tests"""
                    lsst.utils.tests.run(suite(), shouldExit)
                
                if __name__ == "__main__":
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="dd26dea3"/></a>dd26dea3</h3>

<pre>
commit dd26dea31d3178f793602bbedab2b11ecf985291
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Apr 19 14:57:58 2013 -0400

    Refactor and strengthen unit tests
    
    New code in utils makes gives us better control over f.p.
    comparisons.
    
    Split tests into separate files; the original was getting
    too big.  Put utility code in lsst.shapelet.tests so
    downstream packages (e.g. meas_ext*_multiShapelet) can use.
    
    Added tests for Tractor profiles, comparing against GalSim.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="6d5f02e1"/></a>6d5f02e1</h3>

<pre>
commit 6d5f02e10a1f562c5bb18874efcb8014c1d5b4f0
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 17 18:13:38 2014 -0400

    Remove old ModelBuilder
    
    Replaced by MatrixBuilder
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_34"><a name="src/GaussHermiteProjection.cc"/></a>src/GaussHermiteProjection.cc</h1>

<h3 id="toc_35">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                /*
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/GaussHermiteProjection.h"
                
                namespace lsst { namespace shapelet {
                
                Eigen::MatrixXd GaussHermiteProjection::compute(
                    Eigen::Matrix2d const & inputTransform, int inputOrder,
                    Eigen::Matrix2d const & outputTransform, int outputOrder
                ) const {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#d4850b6a">d4850b6a</a> -     assert(inputOrder <= getMaxOrder());</div>
              ?     ^^^^^^            ^^               ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#6f3a3a3c">6f3a3a3c</a> +     if (inputOrder > getMaxOrder()) {</div>
              ?     ^^^            ^               ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#6f3a3a3c">6f3a3a3c</a> +         throw LSST_EXCEPT(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
34   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#6f3a3a3c">6f3a3a3c</a> +             (boost::format("inputOrder %d exceeds max order set on construction %d")</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#6f3a3a3c">6f3a3a3c</a> +              % inputOrder % getMaxOrder()).str()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#6f3a3a3c">6f3a3a3c</a> +         );</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
38   <a href="#6f3a3a3c">6f3a3a3c</a> +     }</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#d4850b6a">d4850b6a</a> -     assert(outputOrder <= getMaxOrder());</div>
              ?     ^^^^^^             ^^               ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
39   <a href="#6f3a3a3c">6f3a3a3c</a> +     if (outputOrder > getMaxOrder()) {</div>
              ?     ^^^             ^               ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
40   <a href="#6f3a3a3c">6f3a3a3c</a> +         throw LSST_EXCEPT(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#6f3a3a3c">6f3a3a3c</a> +             (boost::format("outputOrder %d exceeds max order set on construction %d")</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#6f3a3a3c">6f3a3a3c</a> +              % outputOrder % getMaxOrder()).str()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#6f3a3a3c">6f3a3a3c</a> +         );</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#6f3a3a3c">6f3a3a3c</a> +     }</div>
                    int fullOrder = std::max(inputOrder, outputOrder);
                    int inputSize = computeSize(inputOrder);
                    int outputSize = computeSize(outputOrder);
                    Eigen::Matrix2d wwtInv = 0.5 * (
                        inputTransform.adjoint() * inputTransform
                        + outputTransform.adjoint() * outputTransform
                    );
                    Eigen::SelfAdjointEigenSolver<Eigen::Matrix2d> eig(wwtInv);
                    Eigen::Matrix2d w = eig.operatorInverseSqrt();
                    Eigen::MatrixXd q1 = _htm.compute(outputTransform * w, fullOrder);
                    Eigen::MatrixXd q2 = _htm.compute(inputTransform * w, fullOrder);
                    Eigen::MatrixXd result = q1.topRows(outputSize) * q2.adjoint().leftCols(inputSize);
                    result *= outputTransform.determinant() / std::sqrt(eig.eigenvalues().prod());
                    return result;
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="d4850b6a"/></a>d4850b6a</h3>

<pre>
commit d4850b6ab9be7072b1f060f586b545ae168c974d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Oct 31 15:37:55 2012 -0400

    Add GaussHermiteProjection class.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
<h3><a name="6f3a3a3c"/></a>6f3a3a3c</h3>

<pre>
commit 6f3a3a3cf397252343bae32bdd8e91c9c8e73ded
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sun May 18 20:51:42 2014 -0400

    Convert asserts accessible from outside code into exception-based checks.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_36"><a name="src/ShapeletFunction.cc"/></a>src/ShapeletFunction.cc</h1>

<h3 id="toc_37">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "boost/format.hpp"
                
                #include "ndarray/eigen.h"
                #include "lsst/shapelet/ShapeletFunction.h"
                #include "lsst/shapelet/ConversionMatrix.h"
                #include "lsst/shapelet/GaussHermiteConvolution.h"
                #include "lsst/pex/exceptions.h"
                
                namespace lsst { namespace shapelet {
                
                namespace {
                
                static inline void validateSize(int expected, int actual) {
                    if (expected != actual) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
40   <a href="#d0049163">d0049163</a> -             pex::exceptions::LengthErrorException,</div>
              ?                                         ---------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
40   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::LengthError,</div>
                            (boost::format(
                                "Coefficient vector for ShapeletFunction has incorrect size (%n, should be %n)."
                            ) % actual % expected).str()
                        );
                    }
                }
                
                } // anonymous
                
                double const ShapeletFunction::FLUX_FACTOR = 2.0 * std::sqrt(afw::geom::PI);
                
                ShapeletFunction::ShapeletFunction() : 
                    _order(0), _basisType(HERMITE),
                    _ellipse(EllipseCore(1.0, 1.0, 0.0), afw::geom::Point2D()), 
                    _coefficients(ndarray::allocate(1))
                {
                    _coefficients[0] = 0.0;
                }
                
                ShapeletFunction::ShapeletFunction(int order, BasisTypeEnum basisType) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore()),
                    _coefficients(ndarray::allocate(computeSize(_order)))
                {
                    _coefficients.deep() = 0.0;
                }
                
                ShapeletFunction::ShapeletFunction(
                    int order, BasisTypeEnum basisType,
                    ndarray::Array<double,1,1> const & coefficients
                ) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore()),
                    _coefficients(ndarray::copy(coefficients))
                {
                    validateSize(computeSize(order), _coefficients.getSize<0>());
                }
                 
                ShapeletFunction::ShapeletFunction(
                    int order, BasisTypeEnum basisType, double radius,
                    afw::geom::Point2D const & center
                ) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore(), center),
                    _coefficients(ndarray::allocate(computeSize(_order)))
                {
                    _ellipse.getCore().scale(radius);
                    _coefficients.deep() = 0.0;
                }
                
                ShapeletFunction::ShapeletFunction(
                    int order, BasisTypeEnum basisType, double radius, afw::geom::Point2D const & center,
                    ndarray::Array<double,1,1> const & coefficients
                ) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore(), center),
                    _coefficients(ndarray::copy(coefficients))
                {
                    _ellipse.getCore().scale(radius);
                    validateSize(computeSize(order), _coefficients.getSize<0>());
                }
                 
                ShapeletFunction::ShapeletFunction(
                    int order, BasisTypeEnum basisType, afw::geom::ellipses::Ellipse const & ellipse
                ) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore(ellipse.getCore()), ellipse.getCenter()),
                    _coefficients(ndarray::allocate(computeSize(_order)))
                {
                    _coefficients.deep() = 0.0;
                }
                
                ShapeletFunction::ShapeletFunction(
                    int order, BasisTypeEnum basisType, afw::geom::ellipses::Ellipse const & ellipse,
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#c91a2a14">c91a2a14</a> -     ndarray::Array<double,1,1> const & coefficients</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#291cbd40">291cbd40</a> +     ndarray::Array<double const,1,1> const & coefficients</div>
              ?                          ++++++
                ) :
                    _order(order), _basisType(basisType), _ellipse(EllipseCore(ellipse.getCore()), ellipse.getCenter()),
                    _coefficients(ndarray::copy(coefficients))
                {
                    validateSize(computeSize(order), _coefficients.getSize<0>());
                }
                
                ShapeletFunction::ShapeletFunction(ShapeletFunction const & other) :
                    _order(other._order), _basisType(other._basisType), _ellipse(other._ellipse),
                    _coefficients(ndarray::copy(other._coefficients))
                {}
                
                ShapeletFunction & ShapeletFunction::operator=(ShapeletFunction const & other) {
                    if (&other != this) {
                        if (other.getOrder() != this->getOrder()) {
                            _order = other.getOrder();
                            _coefficients = ndarray::copy(other.getCoefficients());
                        } else {
                            _coefficients.deep() = other.getCoefficients();
                        }
                        _basisType = other.getBasisType();
                        _ellipse = other.getEllipse();
                    }
                    return *this;
                }
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
137  <a href="#bb928df3">bb928df3</a> - void ShapeletFunction::normalize(double value) {</div>
              ?                                  ------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
137  <a href="#d0049163">d0049163</a> + void ShapeletFunction::normalize() {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
138  <a href="#bb928df3">bb928df3</a> -     _coefficients.deep() *= value / evaluate().integrate();</div>
              ?                          ^ --------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
138  <a href="#ec91c8a7">ec91c8a7</a> +     _coefficients.deep() /= evaluate().integrate();</div>
              ?                          ^
                }
                
                void ShapeletFunctionEvaluator::update(ShapeletFunction const & function) {
                    validateSize(_h.getOrder(), function.getOrder());
                    afw::geom::ellipses::Ellipse::GridTransform gt(function.getEllipse());
                    _transform = gt;
                    _normalization = gt.getDeterminant();
                    switch (function.getBasisType()) {
                    case HERMITE:
                        _coefficients = function.getCoefficients();
                        break;
                    case LAGUERRE:
                        ndarray::Array<double,1,1> tmp(ndarray::copy(function.getCoefficients()));
                        ConversionMatrix::convertCoefficientVector(
                            tmp, LAGUERRE, HERMITE, function.getOrder()
                        );
                        _coefficients = tmp;
                        break;
                    }
                }
                
                ShapeletFunctionEvaluator::ShapeletFunctionEvaluator(
                    ShapeletFunction const & function
                ) : _normalization(1.0),
                    _transform(),
                    _h(function.getOrder())
                {
                    update(function);
                }
                
                ShapeletFunction ShapeletFunction::convolve(ShapeletFunction const & other) const {
                    GaussHermiteConvolution convolution(getOrder(), other);
                    afw::geom::ellipses::Ellipse newEllipse(_ellipse);
                    ndarray::EigenView<double const,2,2> matrix(convolution.evaluate(newEllipse));
                    if (_basisType == LAGUERRE) {
                        ConversionMatrix::convertCoefficientVector(_coefficients, LAGUERRE, HERMITE, getOrder());
                    }
                    ShapeletFunction result(convolution.getRowOrder(), HERMITE);
                    result.setEllipse(newEllipse);
                    result.getCoefficients().asEigen() = matrix * _coefficients.asEigen();
                    if (_basisType == LAGUERRE) {
                        ConversionMatrix::convertCoefficientVector(_coefficients, HERMITE, LAGUERRE, getOrder());
                        result.changeBasisType(LAGUERRE);
                    }
                    return result;
                }
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
186  <a href="#ffb98db0">ffb98db0</a> + ndarray::Array<double,1,1> ShapeletFunctionEvaluator::operator()(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
187  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double const,1> const & x,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
188  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double const,1> const & y</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
189  <a href="#ffb98db0">ffb98db0</a> + ) const {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
190  <a href="#ffb98db0">ffb98db0</a> +     ndarray::Array<double,1,1> output = ndarray::allocate(x.getSize<0>());</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
191  <a href="#ffb98db0">ffb98db0</a> +     for (int i = 0, n = x.getSize<0>(); i < n; ++i) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#ffb98db0">ffb98db0</a> +         output[i] = (*this)(x[i], y[i]);</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
193  <a href="#ffb98db0">ffb98db0</a> +     }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
194  <a href="#ffb98db0">ffb98db0</a> +     return output;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
195  <a href="#ffb98db0">ffb98db0</a> + }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
196  <a href="#ffb98db0">ffb98db0</a> + </div>
                void ShapeletFunctionEvaluator::addToImage(
                    ndarray::Array<double,2,1> const & array,
                    afw::geom::Point2I const & xy0
                ) const {
                    ndarray::Array<double,2,1>::Iterator yIter = array.begin();
                    for (int y = xy0.getY(); yIter != array.end(); ++y, ++yIter) {
                        ndarray::Array<double,2,1>::Reference::Iterator xIter = yIter->begin();
                        for (int x = xy0.getX(); xIter != yIter->end(); ++x, ++xIter) {
                            *xIter += (*this)(x, y);
                        }
                    }
                }
                
                void ShapeletFunctionEvaluator::_computeRawMoments(
                    double & q0, Eigen::Vector2d & q1, Eigen::Matrix2d & q2
                ) const {
                    Eigen::Matrix2d a = _transform.getLinear().invert().getMatrix();
                    Eigen::Vector2d b = _transform.getTranslation().asEigen();
                
                    double m0 = _h.sumIntegration(_coefficients, 0, 0);
                    q0 += m0;
                
                    Eigen::Vector2d m1(
                        _h.sumIntegration(_coefficients, 1, 0),
                        _h.sumIntegration(_coefficients, 0, 1)
                    );
                    q1 += a * (m1 - b * m0);
                
                    Eigen::Matrix2d m2;
                    m2(0, 0) = _h.sumIntegration(_coefficients, 2, 0);
                    m2(1, 1) = _h.sumIntegration(_coefficients, 0, 2);
                    m2(0, 1) = m2(1, 0) = _h.sumIntegration(_coefficients, 1, 1);
                    q2 += a * (m2 + b * b.transpose() * m0 - m1 * b.transpose() - b * m1.transpose()) * a.transpose();
                }
                
                afw::geom::ellipses::Ellipse ShapeletFunctionEvaluator::computeMoments() const {
                    double q0 = 0.0;
                    Eigen::Vector2d q1 = Eigen::Vector2d::Zero();
                    Eigen::Matrix2d q2 = Eigen::Matrix2d::Zero();
                    _computeRawMoments(q0, q1, q2);
                    q1 /= q0;
                    q2 /= q0;
                    q2 -= q1 * q1.transpose();
                    return afw::geom::ellipses::Ellipse(
                        afw::geom::ellipses::Quadrupole(afw::geom::ellipses::Quadrupole::Matrix(q2), false),
                        afw::geom::Point2D(q1)
                    );
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="d0049163"/></a>d0049163</h3>

<pre>
commit d0049163b7cfb63ba3248fbf03e58d9827ace8f7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 26 16:11:22 2012 -0400

    switched shapelets lib to use namespace blocks in source files
</pre>
<h3><a name="bb928df3"/></a>bb928df3</h3>

<pre>
commit bb928df3fc2fafe5183e0d075da19994f0af4fc7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jul 17 16:57:27 2013 -0400

    Let the value to normalize to be specified in [Multi]ShapeletFunction
</pre>
<h3><a name="c91a2a14"/></a>c91a2a14</h3>

<pre>
commit c91a2a148c5c5b9a924e595f786aa219f412b316
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu May 10 16:30:44 2012 -0400

    Removed shapelet::Pixel typedef, refactored ModelBuilder a bit.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
<h3><a name="ffb98db0"/></a>ffb98db0</h3>

<pre>
commit ffb98db06b303dfd6da0d9e5a211704b29571f67
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 15 17:41:47 2014 -0400

    Add vectorized evaluation to [Multi]ShapeletFunction
    
    This is still not the most efficient method of shapelet
    evaluation (that's MatrixBuilder), but it's faster and more
    convenient than looping over pixels in Python.
</pre>
<h3><a name="d0049163"/></a>d0049163</h3>

<pre>
commit d0049163b7cfb63ba3248fbf03e58d9827ace8f7
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Mar 26 16:11:22 2012 -0400

    switched shapelets lib to use namespace blocks in source files
</pre>
<h3><a name="291cbd40"/></a>291cbd40</h3>

<pre>
commit 291cbd40e5127cbaba2946b02c06aa8e85dcff36
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 17:36:11 2014 -0400

    Pass coefficient array to ShapeletFunctor ctor as const
    
    This should always have been a const array, as we copy it and hence never modify
    the original.
</pre>
<h3><a name="ec91c8a7"/></a>ec91c8a7</h3>

<pre>
commit ec91c8a7c215d1c14c085a47befa207d276b737c
Author: jbosch <jbosch@git.lsstcorp.org>
Date:   Thu Mar 17 19:01:16 2011 +0000

    afw #1556 - simplified LocalPsf, added implementation for dgPsf.  Further work will have to wait for meas/algorithms integration with #1556.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_38"><a name="include/lsst/shapelet/GaussHermiteConvolution.h"/></a>include/lsst/shapelet/GaussHermiteConvolution.h</h1>

<h3 id="toc_39">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #ifndef LSST_AFW_MATH_SHAPELETS_GaussHermiteConvolution
                #define LSST_AFW_MATH_SHAPELETS_GaussHermiteConvolution
                
                #include "ndarray.h"
                #include "lsst/afw/geom/ellipses.h"
                #include "lsst/shapelet/HermiteTransformMatrix.h"
                
                #include <boost/scoped_ptr.hpp>
                
                namespace lsst { namespace shapelet {
                
                class ShapeletFunction;
                
                /**
                 *  @brief A parametrized matrix that performs a convolution in shapelet space.
                 *
                 *  GaussHermiteConvolution is defined only for the HERMITE basis type.
                 */
                class GaussHermiteConvolution : private boost::noncopyable {
                public:
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#72d74195">72d74195</a> +     static int computeRowOrder(int colOrder, int psfOrder) { return colOrder + psfOrder; }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#72d74195">72d74195</a> + </div>
                    /**
                     *  @brief Evaluate a shapelet convolution matrix in the given array.
                     *
                     *  @param[in,out] ellipse   On input, the ellipse core of the unconvolved shapelet expansion.
                     *                           On output, the ellipse core of the convolved shapelet expansion.
                     *
                     *  The returned array is owned by the GaussHermiteConvolution object and will be modified
                     *  the next time evaluate() is called.
                     */
                    ndarray::Array<double const,2,2> evaluate(afw::geom::ellipses::Ellipse & ellipse) const;
                
                    /// @brief Return the order of the to-be-convolved shapelet basis.
                    int getColOrder() const;
                
                    /// @brief Return the order of the post-convolution shapelet basis.
                    int getRowOrder() const;
                
                    /// @brief Construct a matrix that convolves a basis of the given order with the given shapelet function.
                    GaussHermiteConvolution(int colOrder, ShapeletFunction const & psf);
                
                    // Must be defined in .cc file so it can see Impl dtor.
                    ~GaussHermiteConvolution();
                
                #ifndef SWIG
                    class Impl;
                #endif
                
                private:
                
                    boost::scoped_ptr<Impl> _impl;
                };
                
                
                }} // namespace lsst::shapelet
                
                #endif // !LSST_AFW_MATH_SHAPELETS_GaussHermiteConvolution
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="72d74195"/></a>72d74195</h3>

<pre>
commit 72d741956d6ee82a8544b34d8b780ec44ffb068f
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Sep 12 23:06:51 2014 -0400

    Add method to compute convolution orders in advance.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_40"><a name="src/RadialProfile.cc"/></a>src/RadialProfile.cc</h1>

<h3 id="toc_41">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                /*
                 * LSST Data Management System
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#929e0304">929e0304</a> -  * Copyright 2008-2013 LSST Corporation.</div>
              ?                      ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#c17fe67f">c17fe67f</a> +  * Copyright 2008-2014 LSST Corporation.</div>
              ?                      ^
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "boost/make_shared.hpp"
                #include "boost/math/special_functions/gamma.hpp"
                
                #include "lsst/shapelet/RadialProfile.h"
                
                namespace lsst { namespace shapelet {
                
                namespace {
                
                typedef std::map<std::string,RadialProfile*> RadialProfileRegistry;
                
                RadialProfileRegistry & getRadialProfileRegistry() {
                    static RadialProfileRegistry registry;
                    return registry;
                }
                
                
                class SersicRadialProfile : public RadialProfile {
                public:
                
                    virtual double evaluate(double r) const {
                        return std::exp(-_kappa*(std::pow(r, 1.0 / _n) - 1.0));
                    }
                
                    explicit SersicRadialProfile(std::string const & name, double n, int defaultMaxRadius=8) :
                        RadialProfile(name, defaultMaxRadius), _n(n), _kappa(boost::math::gamma_q_inv(2*n, 0.5))
                    {
                        _momentsRadiusFactor = std::pow(_kappa, -n) * std::sqrt(boost::math::tgamma_ratio(4*n, 2*n)/2);
                    }
                
                private:
                    double _n;
                    double _kappa;
                };
                
                SersicRadialProfile expProfile("exp", 1.0);
                SersicRadialProfile ser2Profile("ser2", 2.0);
                SersicRadialProfile ser3Profile("ser3", 3.0);
                SersicRadialProfile devProfile("dev", 4.0);
                SersicRadialProfile ser5Profile("ser5", 5.0);
                
                class GaussianRadialProfile : public SersicRadialProfile {
                public:
                
                    explicit GaussianRadialProfile() :
                        SersicRadialProfile("gaussian", 0.5, 0)
                    {
                        PTR(MultiShapeletBasis) basis = boost::make_shared<MultiShapeletBasis>(1);
                        ndarray::Array<double,2,2> matrix = ndarray::allocate(1,1);
                        matrix.deep() = 0.5 / std::sqrt(afw::geom::PI);
                        basis->addComponent(_momentsRadiusFactor, 0, matrix);
                        registerBasis(basis, 1, 0);
                    }
                
                };
                
                GaussianRadialProfile gaussianProfilex;
                
                // Truncated exp profile used in SDSS pipeline
                class LuxRadialProfile : public RadialProfile {
                public:
                
                    virtual double evaluate(double r) const {
                        // formula and constants taken from SDSS Photo code
                        static double const EXPFAC = -1.67835;
                        static double const EXPOUT = 4.0;
                        static double const EXPCUT = 3.0;
                        if (r > EXPOUT) return 0.0;
                        double p = std::exp(EXPFAC * (r - 1.0));
                        if (r > EXPCUT) {
                            double s = (r - EXPCUT) / (EXPOUT - EXPCUT);
                            s = 1.0 - s*s;
                            p *= s*s;
                        }
                        return p;
                    }
                
                    LuxRadialProfile() : RadialProfile("lux", 4) {
                        _momentsRadiusFactor = 0.95473; // computed in Mathematica
                    }
                };
                
                LuxRadialProfile luxProfile;
                
                // Softened, truncated de Vaucouleur profile used in SDSS pipeline
                class LuvRadialProfile : public RadialProfile {
                public:
                
                    virtual double evaluate(double r) const {
                        // formula and constants taken from SDSS Photo code
                        static double const DEFAC = -7.66925;
                        static double const DEVOUT = 8.0;
                        static double const DEVCUT = 7.0;
                        if (r > DEVOUT) return 0.0;
                        double p = std::exp(DEFAC*(std::pow(r*r + 0.0004, 0.125) - 1.0));
                        if (r > DEVCUT) {
                            double s = (r - DEVCUT) / (DEVOUT - DEVCUT);
                            s = 1.0 - s*s;
                            p *= s*s;
                        }
                        return p;
                    }
                
                    LuvRadialProfile() : RadialProfile("luv", 8) {
                        _momentsRadiusFactor = 1.57016; // computed in Mathematica
                    }
                };
                
                LuvRadialProfile luvProfile;
                
                } // anonymous
                
                RadialProfile::RadialProfile(std::string const & name, int defaultMaxRadius) :
                    _momentsRadiusFactor(std::numeric_limits<double>::quiet_NaN()),
                    _name(name),
                    _defaultMaxRadius(defaultMaxRadius)
                {
                    getRadialProfileRegistry()[_name] = this;
                }
                
                RadialProfile & RadialProfile::get(std::string const & name) {
                    RadialProfileRegistry::const_iterator i = getRadialProfileRegistry().find(name);
                    if (i == getRadialProfileRegistry().end()) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#929e0304">929e0304</a> -             pex::exceptions::NotFoundException,</div>
              ?                                       ^^^^^^ ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#c17fe67f">c17fe67f</a> +             pex::exceptions::NotFoundError,</div>
              ?                                       ^^ ^
                            (boost::format("RadialProfile with name '%s' not found") % name).str()
                        );
                    }
                    return *i->second;
                }
                
                ndarray::Array<double,1,1> RadialProfile::evaluate(ndarray::Array<double const,1,1> const & r) const {
                    ndarray::Array<double,1,1> p = ndarray::allocate(r.getSize<0>());
                    for (int i = 0, n = r.getSize<0>(); i < n; ++i) {
                        p[i] = evaluate(r[i]);
                    }
                    return p;
                }
                
                PTR(MultiShapeletBasis) RadialProfile::getBasis(int nComponents, int maxRadius) const {
                    if (maxRadius == 0) maxRadius = _defaultMaxRadius;
                    BasisRegistry::const_iterator i = _basisRegistry.find(std::make_pair(nComponents, maxRadius));
                    if (i == _basisRegistry.end()) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#929e0304">929e0304</a> -             pex::exceptions::NotFoundException,</div>
              ?                                       ^^^^^^ ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#c17fe67f">c17fe67f</a> +             pex::exceptions::NotFoundError,</div>
              ?                                       ^^ ^
                            (boost::format("Basis for profile '%s' with nComponents=%d and maxRadius=%d not present")
                             % _name % nComponents % maxRadius).str()
                        );
                    }
                    // Ideally, we'd return a const ptr instead of copying, but because Swig casts away the
                    // constness, that's not sufficiently safe.
                    return boost::make_shared<MultiShapeletBasis>(*i->second);
                }
                
                void RadialProfile::registerBasis(PTR(MultiShapeletBasis) basis, int nComponents, int maxRadius) {
                    _basisRegistry[std::make_pair(nComponents, maxRadius)] = basis;
                }
                
                
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="929e0304"/></a>929e0304</h3>

<pre>
commit 929e0304ad1d9862f5b3b2744e4c08c042b181dd
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="c17fe67f"/></a>c17fe67f</h3>

<pre>
commit c17fe67f384d80489135f4620f219637706beff6
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
    
    Also updated tests and visualization code in tractor.py to
    make use of the new class.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_42"><a name="include/lsst/shapelet/constants.h"/></a>include/lsst/shapelet/constants.h</h1>

<h3 id="toc_43">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                #ifndef LSST_AFW_MATH_SHAPELETS_CONSTANTS_H
                #define LSST_AFW_MATH_SHAPELETS_CONSTANTS_H
                
                /**
                 * @file
                 *
                 * @brief Constants, typedefs, and general-purpose functions for shapelets library.
                 *
                 * @author Jim Bosch
                 */
                
                #include "lsst/afw/geom/ellipses.h"
                #include "ndarray.h"
                #include "lsst/pex/exceptions.h"
                
                namespace lsst { namespace shapelet {
                
                extern double const BASIS_NORMALIZATION; ///< Normalization factor for 1-d orthonormal shapelets: pi^(-1/4)
                
                typedef afw::geom::ellipses::Quadrupole EllipseCore;
                
                /**
                 *  @brief An enum that sets whether to use real-valued polar shapelets or Cartesian shapelets.
                 *
                 *  The conversion between the two bases is theoretically exact, but of course subject to
                 *  round-off error here.
                 */
                enum BasisTypeEnum {
                    HERMITE, /**< 
                              *   Cartesian shapelets or Gauss-Hermite functions, as defined in 
                              *   Refregier, 2003.  That is,
                              *   @f$ \psi(x, y)_{n_x, n_y} 
                              *          = \frac{H_{n_x}(x) H_{n_y}(y) e^{-\frac{x^2 + y^2}{2}}}
                              *                 {\sigma 2^{n_x + n_y} \sqrt{\pi n_x! n_y!}}
                              *   @f$
                              *   where @f$H_n(x)@f$ is a Hermite polynomial.
                              *
                              *   The ordering of coefficients [n_x, n_y] is (row-major packed):
                              *   [0,0],
                              *   [0,1], [1,0],
                              *   [0,2], [1,1], [2,0],
                              *   [0,3], [1,2], [2,1], [3,0],
                              *   [0,4], [1,3], [2,2], [3,1], [4,0]
                              *   etc.
                              */
                
                    LAGUERRE, /**< 
                               *   Polar shapelets or Gauss-Laguerre functions, as defined in 
                               *   Bernstein and Jarvis, 2002.  That is,
                               *   @f$ \psi(x, y, \sigma)_{p, q}
                               *         = (-1)^q \sqrt{\frac{q!}{p!}} (x + i y)^{p-q}
                               *                e^{-\frac{x^2 + y^2}{2}} L^{(p-q)}_q(x^2 + y^2)
                               *   @f$
                               *   where @f$L^{(m)}_n(r)@f$ is an associated Laguerre polynomial.
                               *
                               *   The ordering of coefficients [p, q] is (row-major packed):
                               *   [0,0],
                               *   Re([1,0]), Im([1,0]),
                               *   Re([2,0]), Im([2,0]), [1,1],
                               *   Re([3,0]), Im([3,0], Re([2,1]), Im([2,1]),
                               *   Re([4,0]), Im([4,0], Re([3,1]), Im([3,1]), [2,2]
                               *   etc.
                               *   
                               *   Elements with p < q are redundant in representing real-valued functions, 
                               *   while those with p == q are inherently real.
                               */
                };
                
                /// @brief Return the offset of the given order in a coefficient vector.
                inline int computeOffset(int order) { return order * (order + 1) / 2; }
                
                /// @brief Return the size of the coefficient vector for the given order.
                inline int computeSize(int order) { return computeOffset(order + 1); }
                
                /**
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
100  <a href="#66cb4f96">66cb4f96</a> +  *  Infer the order of a shapelet expansion from the number of coefficients.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
101  <a href="#66cb4f96">66cb4f96</a> +  *</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#66cb4f96">66cb4f96</a> +  *  @throw InvalidParameterError if the number of coefficients does not correspond to any shapelet order.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
103  <a href="#66cb4f96">66cb4f96</a> +  */</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#66cb4f96">66cb4f96</a> + inline int computeOrder(int size) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#66cb4f96">66cb4f96</a> +     int order = (std::sqrt(8*size + 1) - 3)/2;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
106  <a href="#66cb4f96">66cb4f96</a> +     if (computeSize(order) != size) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#66cb4f96">66cb4f96</a> +         throw LSST_EXCEPT(</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
108  <a href="#66cb4f96">66cb4f96</a> +             pex::exceptions::InvalidParameterError,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#66cb4f96">66cb4f96</a> +             "Invalid size for shapelet coefficient matrix"</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#66cb4f96">66cb4f96</a> +         );</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
111  <a href="#66cb4f96">66cb4f96</a> +     }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
112  <a href="#66cb4f96">66cb4f96</a> +     return order;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
113  <a href="#66cb4f96">66cb4f96</a> + }</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
114  <a href="#66cb4f96">66cb4f96</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
115  <a href="#66cb4f96">66cb4f96</a> + /**</div>
                 *  @brief Typedef for a commonly-used array type.
                 *
                 *  @note Serves as a workaround for ambiguities in the C++ standard itself:
                 *        http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_active.html#325
                 */
                typedef ndarray::Array<double,1> Array1d;
                
                /// Compute the square root of an integer number
                inline double intSqrt(int n) {
                    return std::sqrt(double(n));
                }
                
                /// Compute the square root of a rational number i.e. sqrt(n/d)
                inline double rationalSqrt(int n, int d) {
                    return std::sqrt(double(n) / double(d));
                }
                
                }} // namespace lsst::shapelet
                
                #endif // !defined(LSST_AFW_MATH_SHAPELETS_CONSTANTS_H)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="66cb4f96"/></a>66cb4f96</h3>

<pre>
commit 66cb4f9615057c8742573eaf0aa4477525be4d7e
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Sep 29 14:09:58 2014 -0400

    Add function to infer shapelet order from number of coefficients
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_44"><a name="python/lsst/shapelet/tractor.py"/></a>python/lsst/shapelet/tractor.py</h1>

<h3 id="toc_45">Diff:</h3>

<pre>
                #
                # LSST Data Management System
                # Copyright 2008-2013 LSST Corporation.
                #
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                #
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                #
                # You should have received a copy of the LSST License Statement and
                # the GNU General Public License along with this program.  If not,
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                """
                Code to load multi-Gaussian approximations to profiles from "The Tractor"
                into a lsst.shapelet.MultiShapeletBasis.
                
                Please see the README file in the data directory of the lsst.shapelet
                package for more information.
                """
                
                import numpy
                import os
                import re
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#c17fe67f">c17fe67f</a> + import warnings</div>
                try:
                    import cPickle as pickle
                except ImportError:
                    import pickle
                
                from .shapeletLib import *
                
                def registerRadialProfiles():
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#c17fe67f">c17fe67f</a> +     """Register the pickled profiles in the data directory with the RadialProfile singleton registry.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#b43315e7">b43315e7</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#c17fe67f">c17fe67f</a> +     This should only be called at import time by this module; it's only a function to avoid polluting</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#c17fe67f">c17fe67f</a> +     the module namespace with all the local variables used here.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#a988ee4e">a988ee4e</a> +     """</div>
                    dataDir = os.path.join(os.environ["SHAPELET_DIR"], "data")
                    regex = re.compile(r"([a-z]+\d?)_K(\d+)_MR(\d+)\.pickle")
                    for filename in os.listdir(dataDir):
                        match = regex.match(filename)
                        if not match: continue
                        name = match.group(1)
                        nComponents = int(match.group(2))
                        maxRadius = int(match.group(3))
                        try:
                            profile = RadialProfile.get(name)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#929e0304">929e0304</a> -         except lsst.pex.exceptions.LsstCppException:</div>
              ?                                    -------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#c17fe67f">c17fe67f</a> +         except lsst.pex.exceptions.Exception:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#c17fe67f">c17fe67f</a> +             warnings.warn("No C++ profile for multi-Gaussian pickle file '%s'" % filename)</div>
                            continue
                        with open(os.path.join(dataDir, filename), 'r') as stream:
                            array = pickle.load(stream)
                        amplitudes = array[:nComponents]
                        amplitudes /= amplitudes.sum()
                        variances = array[nComponents:]
                        if amplitudes.shape != (nComponents,) or variances.shape != (nComponents,):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#929e0304">929e0304</a> -             raise ValueError("Unknown format for pickled profile file %s" % name)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#c17fe67f">c17fe67f</a> +             warnings.warn("Unknown format for multi-Gaussian pickle file '%s'" % filename)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#c17fe67f">c17fe67f</a> +             continue</div>
                        basis = MultiShapeletBasis(1)
                        for amplitude, variance in zip(amplitudes, variances):
                            radius = variance**0.5
                            matrix = numpy.array([[amplitude / ShapeletFunction.FLUX_FACTOR]], dtype=float)
                            basis.addComponent(radius, 0, matrix)
                        profile.registerBasis(basis, nComponents, maxRadius)
                # We register all the profiles at module import time, to allow C++ code to access all available profiles
                # without having to later call Python code to unpickle them.
                registerRadialProfiles()
                
                def evaluateRadial(basis, r, sbNormalize=False, doComponents=False):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
71   <a href="#2f4a8a52">2f4a8a52</a> -     """Return a radial profile for a single-element MultiShapeletBasis.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#a988ee4e">a988ee4e</a> +     """Plot a single-element MultiShapeletBasis as a radial profile.</div>
                    """
                    ellipse = lsst.afw.geom.ellipses.Ellipse(lsst.afw.geom.ellipses.Axes())
                    coefficients = numpy.ones(1, dtype=float)
                    msf = basis.makeFunction(ellipse, coefficients)
                    ev = msf.evaluate()
                    n = 1
                    if doComponents:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#b6a0a1a9">b6a0a1a9</a> -         n += len(msf.getElements())</div>
              ?                         ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#b4ea1017">b4ea1017</a> +         n += len(msf.getComponents())</div>
              ?                         ^^ +++
                    z = numpy.zeros((n,) + r.shape, dtype=float)
                    for j, x in enumerate(r):
                        z[0,j] = ev(x, 0.0)
                    if doComponents:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#b6a0a1a9">b6a0a1a9</a> -         for i, sf in enumerate(msf.getElements()):</div>
              ?                                       ^^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
92   <a href="#b4ea1017">b4ea1017</a> +         for i, sf in enumerate(msf.getComponents()):</div>
              ?                                       ^^ +++
                            evc = sf.evaluate()
                            for j, x in enumerate(r):
                                z[i+1,j] = evc(x, 0.0)
                    if sbNormalize:
                        z /= ev(1.0, 0.0)
                    return z
                
                def integrateNormalizedFluxes(maxRadius=20.0, nSteps=5000):
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
101  <a href="#c17fe67f">c17fe67f</a> +     """!</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
93   <a href="#929e0304">929e0304</a> -     """After normalizing by surface brightness at r=1 r_e, integrate the profiles to compare</div>
              ?     ---
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#c17fe67f">c17fe67f</a> +     After normalizing by surface brightness at r=1 r_e, integrate the profiles to compare</div>
                    relative fluxes between the true profiles and their approximations.
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#c17fe67f">c17fe67f</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#c17fe67f">c17fe67f</a> +     @param[in] maxRadius   Maximum radius to integrate the profile, in units of r_e.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
106  <a href="#c17fe67f">c17fe67f</a> +     @param[in] nSteps      Number of concrete points at which to evaluate the profile to</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#c17fe67f">c17fe67f</a> +                            do the integration (we just use the trapezoidal rule).</div>
                    """
                    radii = numpy.linspace(0.0, maxRadius, nSteps)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
97   <a href="#929e0304">929e0304</a> -     profiles = {name: RadialProfile.get(name) for name in ("exp", "lux", "dev", "luv")}</div>
              ?                                                                                      ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#c17fe67f">c17fe67f</a> +     profiles = {name: RadialProfile.get(name) for name in ("exp", "lux", "dev", "luv",</div>
              ?                                                                                      ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
111  <a href="#c17fe67f">c17fe67f</a> +                                                            "ser2", "ser3", "ser5")}</div>
                    evaluated = {}
                    for name, profile in profiles.iteritems():
                        evaluated[name] = profile.evaluate(radii)
                        basis = profile.getBasis(8)
                        evaluated["g" + name] = evaluateRadial(basis, radii, sbNormalize=True, doComponents=False)[0,:]
                    fluxes = {name: numpy.trapz(z*radii, radii) for name, z in evaluated.iteritems()}
                    return fluxes
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
120  <a href="#c17fe67f">c17fe67f</a> + </div>
                def plotSuite(doComponents=False):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#929e0304">929e0304</a> -     """Create a plot of the profiles and their approximations."""</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
122  <a href="#85fa596e">85fa596e</a> +     """Plot all the profiles defined in this module together: true exp and dev, the SDSS softended/truncated</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
123  <a href="#85fa596e">85fa596e</a> +     lux and luv, and the multi-Gaussian approximations to all of these.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
124  <a href="#85fa596e">85fa596e</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
125  <a href="#85fa596e">85fa596e</a> +     To plot the individual Gaussians that form the multi-Gaussian approximations, pass doComponents=True.</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#85fa596e">85fa596e</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
127  <a href="#85fa596e">85fa596e</a> +     Returns a tuple of (figure, axes), where 'figure' is the matplotlib figure that contains the plot,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#85fa596e">85fa596e</a> +     and axes is a 2x4 NumPy array of matplotlib axes objects</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
129  <a href="#85fa596e">85fa596e</a> +     """</div>
                    from matplotlib import pyplot
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
109  <a href="#b6a0a1a9">b6a0a1a9</a> -     fig = pyplot.figure(figsize=(9,4.7))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
131  <a href="#85fa596e">85fa596e</a> +     fig = pyplot.figure(figsize=(9, 4.7))</div>
              ?                                    +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
110  <a href="#b6a0a1a9">b6a0a1a9</a> -     axes = numpy.zeros((2,4), dtype=object)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
132  <a href="#85fa596e">85fa596e</a> +     axes = numpy.zeros((2, 4), dtype=object)</div>
              ?                           +
                    r1 = numpy.logspace(-3, 0, 1000, base=10)
                    r2 = numpy.linspace(1, 10, 1000)
                    r = [r1, r2]
                    for i in range(2):
                        for j in range(4):
                            axes[i,j] = fig.add_subplot(2, 4, i*4+j+1)
                    profiles = {name: RadialProfile.get(name) for name in ("exp", "lux", "dev", "luv")}
                    basis = {name: profiles[name].getBasis(8) for name in profiles}
                    z = numpy.zeros((2,4), dtype=object)
                    colors = ("k", "g", "b", "r")
                    fig.subplots_adjust(wspace=0.025, hspace=0.025, bottom=0.15, left=0.1, right=0.98, top=0.92)
                    centers = [None, None]
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
123  <a href="#b6a0a1a9">b6a0a1a9</a> -     for i in range(2):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
124  <a href="#b6a0a1a9">b6a0a1a9</a> -         for j in range(0,4,2):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
145  <a href="#85fa596e">85fa596e</a> +     for i in range(2):   # 0=profile, 1=relative error</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
146  <a href="#85fa596e">85fa596e</a> +         for j in range(0, 4, 2):  # grid columns: 0=exp-like, 2=dev-like</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
125  <a href="#b6a0a1a9">b6a0a1a9</a> -             bbox0 = axes[i,j].get_position()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
147  <a href="#85fa596e">85fa596e</a> +             bbox0 = axes[i, j].get_position()</div>
              ?                            +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#b6a0a1a9">b6a0a1a9</a> -             bbox1 = axes[i,j+1].get_position()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#85fa596e">85fa596e</a> +             bbox1 = axes[i, j+1].get_position()</div>
              ?                            +
                            bbox1.x0 = bbox0.x1 - 0.06
                            bbox0.x1 = bbox1.x0
                            centers[j/2] = 0.5*(bbox0.x0 + bbox1.x1)
                            axes[i,j].set_position(bbox0)
                            axes[i,j+1].set_position(bbox1)
                    for j in range(0,2):
                        z[0,j] = [evaluateRadial(basis[k], r[j], sbNormalize=True, doComponents=doComponents)
                                  for k in ("exp", "lux")]
                        z[0,j][0:0] = [profiles[k].evaluate(r[j])[numpy.newaxis,:] for k in ("exp", "lux")]
                        z[0,j+2] = [evaluateRadial(basis[k], r[j], sbNormalize=True, doComponents=doComponents)
                                    for k in ("dev", "luv")]
                        z[0,j+2][0:0] = [profiles[k].evaluate(r[j])[numpy.newaxis,:] for k in ("dev", "luv")]
                    methodNames = [["loglog", "semilogy"], ["semilogx", "plot"]]
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
140  <a href="#b6a0a1a9">b6a0a1a9</a> -     for j in range(0,4):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
162  <a href="#85fa596e">85fa596e</a> +     for j in range(0, 4): # grid columns</div>
              ?                      +   +++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
141  <a href="#b43315e7">b43315e7</a> -         z[1,j] = [(z[0,j][0][0,:] - z[0,j][i][0,:])/z[0,j][0][0,:] for i in range(0,4)]</div>
              ?         ^          ^                ^               ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#85fa596e">85fa596e</a> +         y[1, j] = [(y[0, j][0][0, :] - y[0, j][i][0, :])/y[0, j][0][0, :] for i in range(0, 4)]</div>
              ?         ^   +       ^   +        +     ^   +        +    ^   +        +                    +
                        handles = []
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
143  <a href="#b6a0a1a9">b6a0a1a9</a> -         method0 = getattr(axes[0,j], methodNames[0][j%2])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
165  <a href="#85fa596e">85fa596e</a> +         method0 = getattr(axes[0, j], methodNames[0][j%2])</div>
              ?                                  +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#b6a0a1a9">b6a0a1a9</a> -         method1 = getattr(axes[1,j], methodNames[1][j%2])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#85fa596e">85fa596e</a> +         method1 = getattr(axes[1, j], methodNames[1][j%2])</div>
              ?                                  +
                        for k in range(4):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
146  <a href="#b6a0a1a9">b6a0a1a9</a> -             z0 = z[0,j][k]</div>
              ?             ^    ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#85fa596e">85fa596e</a> +             y0 = y[0, j][k]</div>
              ?             ^    ^   +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
147  <a href="#b6a0a1a9">b6a0a1a9</a> -             handles.append(method0(r[j%2], z0[0,:], color=colors[k])[0])</div>
              ?                                            ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
169  <a href="#85fa596e">85fa596e</a> +             handles.append(method0(r[j%2], y0[0, :], color=colors[k])[0])</div>
              ?                                            ^    +
                            if doComponents:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
149  <a href="#b6a0a1a9">b6a0a1a9</a> -                 for l in range(1, z0.shape[0]):</div>
              ?                                   ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
171  <a href="#85fa596e">85fa596e</a> +                 for l in range(1, y0.shape[0]):</div>
              ?                                   ^
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#b6a0a1a9">b6a0a1a9</a> -                     method0(r[j%2], z0[l,:], color=colors[k], alpha=0.25)</div>
              ?                                     ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
172  <a href="#85fa596e">85fa596e</a> +                     method0(r[j%2], y0[l, :], color=colors[k], alpha=0.25)</div>
              ?                                     ^    +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
151  <a href="#b6a0a1a9">b6a0a1a9</a> -             method1(r[j%2], z[1,j][k], color=colors[k])</div>
              ?                             ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
173  <a href="#85fa596e">85fa596e</a> +             method1(r[j%2], y[1, j][k], color=colors[k])</div>
              ?                             ^   +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
152  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[0,j].set_xticklabels([])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
174  <a href="#85fa596e">85fa596e</a> +         axes[0, j].set_xticklabels([])</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[0,j].set_ylim(1E-6, 1E3)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
175  <a href="#85fa596e">85fa596e</a> +         axes[0, j].set_ylim(1E-6, 1E3)</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
154  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[1,j].set_ylim(-0.2, 1.0)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
176  <a href="#85fa596e">85fa596e</a> +         axes[1, j].set_ylim(-0.2, 1.0)</div>
              ?                +
                    for i, label in enumerate(("profile", "relative error")):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[i,0].set_ylabel(label)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
178  <a href="#85fa596e">85fa596e</a> +         axes[i, 0].set_ylabel(label)</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
157  <a href="#b6a0a1a9">b6a0a1a9</a> -         for t in axes[i,0].get_yticklabels():</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
179  <a href="#85fa596e">85fa596e</a> +         for t in axes[i, 0].get_yticklabels():</div>
              ?                         +
                            t.set_fontsize(11)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#b6a0a1a9">b6a0a1a9</a> -     for j in range(1,4):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
181  <a href="#85fa596e">85fa596e</a> +     for j in range(1, 4):</div>
              ?                      +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
160  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[0,j].set_yticklabels([])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
182  <a href="#85fa596e">85fa596e</a> +         axes[0, j].set_yticklabels([])</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[1,j].set_yticklabels([])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
183  <a href="#85fa596e">85fa596e</a> +         axes[1, j].set_yticklabels([])</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
162  <a href="#b6a0a1a9">b6a0a1a9</a> -     xticks = [['$\\mathdefault{10^{%d}}$' % i for i in range(-3,1)],</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
184  <a href="#85fa596e">85fa596e</a> +     xticks = [['$\\mathdefault{10^{%d}}$' % i for i in range(-3, 1)],</div>
              ?                                                                 +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#b6a0a1a9">b6a0a1a9</a> -                [str(i) for i in range(1,11)]]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
185  <a href="#85fa596e">85fa596e</a> +                [str(i) for i in range(1, 11)]]</div>
              ?                                         +
                    xticks[0][-1] = ""
                    xticks[1][-1] = ""
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#b6a0a1a9">b6a0a1a9</a> -     for j in range(0,4):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
188  <a href="#85fa596e">85fa596e</a> +     for j in range(0, 4):</div>
              ?                      +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
167  <a href="#b6a0a1a9">b6a0a1a9</a> -         axes[1,j].set_xticklabels(xticks[j%2])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
189  <a href="#85fa596e">85fa596e</a> +         axes[1, j].set_xticklabels(xticks[j%2])</div>
              ?                +
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#b6a0a1a9">b6a0a1a9</a> -         for t in axes[1,j].get_xticklabels():</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
190  <a href="#85fa596e">85fa596e</a> +         for t in axes[1, j].get_xticklabels():</div>
              ?                         +
                            t.set_fontsize(11)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
170  <a href="#2f4a8a52">2f4a8a52</a> -     fig.legend(handles, ["exp/dev", "lux/luv", "gexp/gdev", "glux/gluv"],</div>
              ?                                                 ^    -       ^    -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#b43315e7">b43315e7</a> +     fig.legend(handles, ["exp/dev", "lux/luv", "approx exp/dev", "approx lux/luv"],</div>
              ?                                                 ^^^^^^^           ^^^^^^^
                               loc='lower center', ncol=4)
                    fig.text(centers[0], 0.95, "exponential", ha='center', weight='bold')
                    fig.text(centers[1], 0.95, "de Vaucouleur", ha='center', weight='bold')
                    return fig, axes
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="2f4a8a52"/></a>2f4a8a52</h3>

<pre>
commit 2f4a8a5226e3a730aeb0cd04eb928252b90b29e9
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Feb 18 14:37:02 2014 -0500

    Cleanups, flux compuation for tractor analysis code
</pre>
<h3><a name="929e0304"/></a>929e0304</h3>

<pre>
commit 929e0304ad1d9862f5b3b2744e4c08c042b181dd
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
</pre>
<h3><a name="b43315e7"/></a>b43315e7</h3>

<pre>
commit b43315e7f3db715c4bc8e705aeea959272baf63c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 11 21:45:23 2013 -0400

    Include true lux/luv plots in tractor plotSuite
</pre>
<h3><a name="b6a0a1a9"/></a>b6a0a1a9</h3>

<pre>
commit b6a0a1a9bf20867e66601881bc43202b43d0e78c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 5 17:31:08 2013 +0900

    Better plots for tractor-based profiles.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="85fa596e"/></a>85fa596e</h3>

<pre>
commit 85fa596e4842bc7938ce8b048b4baae5c023df91
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sun May 18 19:20:33 2014 -0400

    Miscellaneous code style cleanups and comments in tractor.py
</pre>
<h3><a name="b4ea1017"/></a>b4ea1017</h3>

<pre>
commit b4ea101754b13223906b7b664d95522c7b1e8b2d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 18 10:46:42 2014 -0400

    Rename MultiShapeletFunction's "elements" to "components"
    
    This brings MultiShapeletFunction's nomenclature in line with that used by
    MultiShapeletBasis and MatrixBuilder.
</pre>
<h3><a name="c17fe67f"/></a>c17fe67f</h3>

<pre>
commit c17fe67f384d80489135f4620f219637706beff6
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Feb 20 15:33:59 2014 -0500

    RadialProfile class to make persisted bases available in C++
    
    Also updated tests and visualization code in tractor.py to
    make use of the new class.
</pre>
<h3><a name="b43315e7"/></a>b43315e7</h3>

<pre>
commit b43315e7f3db715c4bc8e705aeea959272baf63c
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Sep 11 21:45:23 2013 -0400

    Include true lux/luv plots in tractor plotSuite
</pre>
<h3><a name="a988ee4e"/></a>a988ee4e</h3>

<pre>
commit a988ee4e448000c1a888b906df69e74c043bc6da
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 20:08:08 2013 -0400

    Added data, code for multi-Gaussian approximations from the Tractor
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_46"><a name="src/HermiteTransformMatrix.cc"/></a>src/HermiteTransformMatrix.cc</h1>

<h3 id="toc_47">Diff:</h3>

<pre>
                // -*- LSST-C++ -*-
                /*
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010, 2011 LSST Corporation.
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                
                #include "lsst/shapelet/HermiteTransformMatrix.h"
                
                namespace lsst { namespace shapelet {
                
                namespace {
                
                class Binomial {
                public:
                
                    Binomial(int const nMax);
                
                    void reset(int const n, double a, double b);
                
                    double const operator[](int const k) const { return _workspace[k] * _coefficients[k]; }
                
                    int const getOrder() const { return _coefficients.size()-1; }
                
                private:
                    Eigen::VectorXd _coefficients;
                    Eigen::VectorXd _workspace;
                };
                
                Binomial::Binomial(int const nMax) : _coefficients(nMax+1), _workspace(nMax+1) {}
                
                void Binomial::reset(int const n, double a, double b) {
                    assert(n < _coefficients.size());
                    _coefficients[0] = _coefficients[n] = 1.0;
                    int const mid = n/2;
                    for (int k = 1; k <= mid; ++k) {
                        _coefficients[k] = _coefficients[k-1] * (n - k + 1.0) / k;
                    }
                    for (int k = mid+1; k < n; ++k) {
                        _coefficients[k] = _coefficients[n-k];
                    }
                    double v = 1;
                    for (int k = 0; k <= n; ++k) {
                        _workspace[k] = v;
                        v *= b;
                    }
                    v = 1;
                    for (int nk = n; nk >= 0; --nk) {
                        _workspace[nk] *= v;
                        v *= a;
                    }
                }
                
                } // anonymous
                
                HermiteTransformMatrix::HermiteTransformMatrix(int order) :
                    _order(order),
                    _coeffFwd(Eigen::MatrixXd::Zero(order+1, order+1)),
                    _coeffInv(Eigen::MatrixXd::Identity(order+1, order+1))
                {
                    _coeffFwd(0, 0) = BASIS_NORMALIZATION;
                    if (_order >= 1) {
                        _coeffFwd(1, 1) = _coeffFwd(0, 0) * M_SQRT2;
                    }
                    for (int n = 2; n <= _order; ++n) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#8fc55e3d">8fc55e3d</a> -         _coeffFwd(n, 0) = -_coeffFwd(n-2, 0) * rationalSqrt(n - 1, n);</div>
              ?                                                              - -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#d42a56fb">d42a56fb</a> +         _coeffFwd(n, 0) = -_coeffFwd(n-2, 0) * rationalSqrt(n-1, n);</div>
                        for (int m = (n % 2) ? 1:2; m <= n; m += 2) {
                            _coeffFwd(n, m)
                                = _coeffFwd(n-1, m-1) * rationalSqrt(2, n)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#8fc55e3d">8fc55e3d</a> -                 - _coeffFwd(n-2, m) * rationalSqrt(n - 1, n);</div>
              ?                                                     - -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#d42a56fb">d42a56fb</a> +                 - _coeffFwd(n-2, m) * rationalSqrt(n-1, n);</div>
                        }
                    }
                    _coeffFwd.triangularView<Eigen::Lower>().solveInPlace(_coeffInv);
                }
                
                Eigen::MatrixXd HermiteTransformMatrix::compute(Eigen::Matrix2d const & transform, int order) const {
                    if (order > _order) {
                        throw LSST_EXCEPT(
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#87797e61">87797e61</a> -             pex::exceptions::InvalidParameterException,</div>
              ?                                               ^^^^^^ ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#f61f7f2d">f61f7f2d</a> +             pex::exceptions::InvalidParameterError,</div>
              ?                                               ^^ ^
                            boost::str(
                                boost::format("order passed to compute() (%d) is larger than construction order (%d)")
                                % order % _order
                            )
                        );
                    }
                    int const size = computeSize(order);
                    Eigen::MatrixXd result = Eigen::MatrixXd::Zero(size, size);
                    Binomial binomial_m(order);
                    Binomial binomial_n(order);
                    for (int jn=0, joff=0; jn <= order; joff += (++jn)) {
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#87797e61">87797e61</a> -         for (int kn=jn, koff=joff; kn <= order; (koff += (++kn)) += (++kn)) {</div>
              ?                                                 -        ^     ------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
107  <a href="#203be8cd">203be8cd</a> +         for (int kn=jn, koff=joff; kn <= order; koff += ++kn, koff += ++kn) {</div>
              ?                                                         ^^^^^^^^^^^^^^
                            for (int jx=0,jy=jn; jx <= jn; ++jx,--jy) {
                                for (int kx=0,ky=kn; kx <= kn; ++kx,--ky) {
                                    double & element = result(koff+kx, joff+jx);
                                    for (int m = 0; m <= order; ++m) {
                                        int const order_minus_m = order - m;
                                        binomial_m.reset(m, transform(0,0), transform(0,1));
                                        for (int p = 0; p <= m; ++p) {
                                            double const tmp1 = binomial_m[p] * _coeffFwd(kx, m);
                                            for (int n = 0; n <= order_minus_m; ++n) {
                                                binomial_n.reset(n, transform(1,0), transform(1,1));
                                                double const tmp2 = _coeffFwd(ky, n) * tmp1;
                                                for (int q = 0; q <= n; ++q) {
                                                    element += tmp2 * _coeffInv(m+n-p-q, jx) * _coeffInv(p+q, jy)
                                                        * binomial_n[q];
                                                } // q
                                            } // n
                                        } // p
                                    } // m
                                } // kx,ky
                            } // jx,jy
                        } // kn
                    } // jn
                    return result;
                }
                
                }} // namespace lsst::shapelet
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="87797e61"/></a>87797e61</h3>

<pre>
commit 87797e616e4a8ac2d6cec80107b73189dad56698
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Oct 31 13:33:58 2012 -0400

    Separate HermiteTransformMatrix into its own file.
</pre>
<h3><a name="8fc55e3d"/></a>8fc55e3d</h3>

<pre>
commit 8fc55e3d9aeb54081805fbe369693ec10c6bcfbe
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Aug 1 17:34:17 2013 -0400

    Add functions for integer and rational square roots.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="f61f7f2d"/></a>f61f7f2d</h3>

<pre>
commit f61f7f2d3bb1b9b9d2ecb4fc6463c692ab5f2bb4
Author: Russell Owen <rowen@uw.edu>
Date:   Tue Jun 17 16:17:59 2014 -0700

    Renamed exceptions
</pre>
<h3><a name="203be8cd"/></a>203be8cd</h3>

<pre>
commit 203be8cd2be8dd5dd018f65a30308f0f4cdece8e
Author: Russell Owen <rowen@uw.edu>
Date:   Mon Oct 6 16:34:01 2014 -0700

    Fix compiler warning: multiple unsequenced modifications
</pre>
<h3><a name="d42a56fb"/></a>d42a56fb</h3>

<pre>
commit d42a56fb93adee80e1375eccb1e2f722211a003d
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Sun May 18 17:43:28 2014 -0400

    Better consistency in whitespace near commas, operators.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_48"><a name="include/lsst/shapelet/MultiShapeletBasis.h"/></a>include/lsst/shapelet/MultiShapeletBasis.h</h1>

<h3 id="toc_49">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                /*
                 * LSST Data Management System
                 * Copyright 2008-2013 LSST Corporation.
                 *
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 *
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 *
                 * You should have received a copy of the LSST License Statement and
                 * the GNU General Public License along with this program.  If not,
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                #ifndef LSST_SHAPELET_MultiShapeletBasis_h_INCLUDED
                #define LSST_SHAPELET_MultiShapeletBasis_h_INCLUDED
                
                #include "lsst/shapelet/MultiShapeletFunction.h"
                
                namespace lsst { namespace shapelet {
                
                /**
                 *  @brief Simple struct that represents one shapelet expansion in a MultiShapeletBasis
                 *
                 *  A MultiShapeletBasis is formed by the linear combination of several shapelet bases
                 *  with different radii and common ellipticity; this represents a single shapelet basis
                 *  within the MultiShapeletBasis.
                 *
                 *  @note This really ought to be an inner class, and should generally be referred to via
                 *        the MultiShapeletBasis::Component typedef, but Swig doesn't handle inner classes.
                 */
                class MultiShapeletBasisComponent {
                public:
                
                    /**
                     *  @brief Main constructor for MultiShapeletBasisComponent
                     *
                     *  Should usually only be called by MultiShapeletBasis::addComponent.
                     *
                     *  @param[in] radius   Radius of the shapelet expansion defined by this component.
                     *  @param[in] order    Order of the shapelet expansion.
                     *  @param[in] matrix   Matrix whose elements [i,j] map MultiShapeletBasis elements j to shapelet
                     *                      terms i; must have dimensions [computeSize(order), basis.getSize()], where
                     *                      "basis" is the MultiShapeletBasis this component is attached to.  Will be
                     *                      deep-copied by the constructor.
                     *
                     *  Note that matrix elements follow the amplitude convention defined by ShapeletFunction; values
                     *  are proportional to flux, not surface brightness.
                     */
                    MultiShapeletBasisComponent(double radius, int order, ndarray::Array<double const,2,2> const & matrix);
                
                    /// Return the radius of this shapelet expansion
                    double getRadius() const { return _radius; }
                
                    /// Order of this shapelet expansion
                    int getOrder() const { return _order; }
                
                    /// Matrix whose elements [i,j] map MultiShapeletBasis elements j to shapelet terms i
                    ndarray::Array<double const,2,2> getMatrix() const { return _matrix; }
                
                private:
                    friend class MultiShapeletBasis;
                
                    double _radius;
                    int _order;
                    ndarray::Array<double const,2,2> _matrix;
                };
                
                /**
                 *  @brief A basis formed from a linear combination of shapelet bases that differ only in radius.
                 *
                 *  A MultiShapeletBasis can have many "components" (shapelet bases with different orders and radii),
                 *  which are mapped via matrices into one or more "elements".  It's common for a basis to have only
                 *  one or two elements, representing a galaxy model that is a linear combination of one or two
                 *  radial profiles.  It's also common for most components to be zeroth order (Gaussians), as higher-
                 *  order shapelet terms don't provide much of an advantage when approximating axisymmetric functions.
                 *
                 *  MultiShapeletBasis itself provides the interface to define these multi-Gaussian approximations
                 *  and combine and refine them, and delegates the work of defining them to MultiShapeletFunction
                 *  (via the makeFunction() method) and the MultiShapeletMatrixBuilder class.  MultiShapeletFunction
                 *  is a more user-friendly and versatile approach, intended for debugging and testing, while the
                 *  MultiShapletMatrixBuilder approach is intended for performance-critical evaluation of PSF-convolved
                 *  MultiShapeletBasis objects.
                 */
                class MultiShapeletBasis {
                public:
                    typedef MultiShapeletBasisComponent Component;
                    typedef std::vector<Component> ComponentVector;
                    typedef ComponentVector::const_iterator Iterator;
                
                    /// Construct a MultiShapeletBasis with the given number of elements (i.e. free amplitudes).
                    explicit MultiShapeletBasis(int size);
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#397f9519">397f9519</a> -     /// Return the number of elements in the MultiShapeletBasis</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
102  <a href="#5443966c">5443966c</a> +     /// Return the number of elements (i.e. free amplitudes) in the MultiShapeletBasis</div>
              ?                                       +++++++++++++++++++++++
                    int getSize() const { return _size; }
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
104  <a href="#397f9519">397f9519</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
105  <a href="#5443966c">5443966c</a> +     /// Return the number of components (distinct shapelet bases) in the MultiShapeletBasis</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
106  <a href="#5443966c">5443966c</a> +     int getComponentCount() const { return _components.size(); }</div>
                
                    //@{
                    /// Iterator over the components (distinct shapelet bases) of the MultiShapeletBasis
                    Iterator begin() const { return _components.begin(); }
                    Iterator end() const { return _components.end(); }
                    //@}
                
                    /**
                     *  @brief Add a new component (shapelet basis) to the MultiShapeletBasis
                     *
                     *  @copydetails MultiShapeletBasisComponent::MultiShapeletBasisComponent
                     */
                    void addComponent(double radius, int order, ndarray::Array<double const,2,2> const & matrix);
                
                    /// Multiply the radius of all basis elements by the given factor.
                    void scale(double factor);
                
                    /// Rescale all matrices so each element has unit flux.
                    void normalize();
                
                    /// Combine the given basis with this (in place), by appending its elements.
                    void merge(MultiShapeletBasis const & other);
                
                    /**
                     *  @brief Create a MultiShapeletFunction from the basis.
                     *
                     *  @param[in]  ellipse       Shapelet basis ellipse that will define the MultiShapeletFunction
                     *                            (will be scaled by the radius of each component).
                     *  @param[in]  coefficients  Coefficients of the basis elements.
                     */
                    MultiShapeletFunction makeFunction(
                        afw::geom::ellipses::Ellipse const & ellipse,
                        ndarray::Array<double const,1,1> const & coefficients
                    ) const;
                
                private:
                    int _size;
                    ComponentVector _components;
                };
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#397f9519">397f9519</a> - /**</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
145  <a href="#397f9519">397f9519</a> -  *  @brief Class that efficiently evaluates a PSF-convolved elliptical MultiShapeletBasis matrix</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
146  <a href="#397f9519">397f9519</a> -  *         at predefined points.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
147  <a href="#397f9519">397f9519</a> -  *</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
148  <a href="#397f9519">397f9519</a> -  *  The output "matrix" has pixels along the rows, and MultiShapeletBasis elements along columns;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
149  <a href="#397f9519">397f9519</a> -  *  this is the design matrix involved in a linear least squares fit for the basis coefficients.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#397f9519">397f9519</a> -  */</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
151  <a href="#397f9519">397f9519</a> - template <typename T></div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
152  <a href="#c71cc00d">c71cc00d</a> - class MultiShapeletMatrixBuilder {</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#397f9519">397f9519</a> - public:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
154  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
155  <a href="#f7d496bb">f7d496bb</a> -     /// Return the number of data points</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#f7d496bb">f7d496bb</a> -     int getDataSize() const;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
157  <a href="#f7d496bb">f7d496bb</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
158  <a href="#f7d496bb">f7d496bb</a> -     /// Return the number of basis elements</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
159  <a href="#f7d496bb">f7d496bb</a> -     int getBasisSize() const;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
160  <a href="#f7d496bb">f7d496bb</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#397f9519">397f9519</a> -     /**</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
162  <a href="#397f9519">397f9519</a> -      *  @brief Main constructor.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#397f9519">397f9519</a> -      *</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#397f9519">397f9519</a> -      *  @param[in] basis     MultiShapeletBasis that defines the matrix to be generated</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
165  <a href="#397f9519">397f9519</a> -      *  @param[in] psf       Point-spread function with which to convolve the MultiShapeletBasis model</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#397f9519">397f9519</a> -      *  @param[in] x         Array of x coordinates at which the matrix will be evaluated</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
167  <a href="#397f9519">397f9519</a> -      *  @param[in] y         Array of y coordinates at which the matrix will be evaluated (must have the</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#397f9519">397f9519</a> -      *                       same size as x).</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
169  <a href="#84dd053e">84dd053e</a> -      *  @param[in] useApproximateExp   Use utils::PowFast to compute fast approximate exponentials</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
170  <a href="#397f9519">397f9519</a> -      */</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
171  <a href="#397f9519">397f9519</a> -     MultiShapeletMatrixBuilder(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
172  <a href="#397f9519">397f9519</a> -         MultiShapeletBasis const & basis,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
173  <a href="#397f9519">397f9519</a> -         MultiShapeletFunction const & psf,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
174  <a href="#397f9519">397f9519</a> -         ndarray::Array<T const,1,1> const & x,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
175  <a href="#84dd053e">84dd053e</a> -         ndarray::Array<T const,1,1> const & y,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
176  <a href="#84dd053e">84dd053e</a> -         bool useApproximateExp = false</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
177  <a href="#397f9519">397f9519</a> -     );</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
178  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
179  <a href="#397f9519">397f9519</a> -     /**</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
180  <a href="#397f9519">397f9519</a> -      *  @brief Evaluate the matrix given the ellipse parameters of the model</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
181  <a href="#397f9519">397f9519</a> -      *</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
182  <a href="#397f9519">397f9519</a> -      *  @param[out]  output   Matrix to fill, with dimensions (x.getSize<0>(), basis.getSize()).</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
183  <a href="#397f9519">397f9519</a> -      *                        Will be zeroed before filling.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
184  <a href="#397f9519">397f9519</a> -      *  @param[in]   ellipse  Ellipse parameters of the model, with center relative to the x and y</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
185  <a href="#397f9519">397f9519</a> -      *                        arrays passed at construction.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
186  <a href="#397f9519">397f9519</a> -      */</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
187  <a href="#397f9519">397f9519</a> -     void build(</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
188  <a href="#397f9519">397f9519</a> -         ndarray::Array<T,2,-1> const & output,</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
189  <a href="#397f9519">397f9519</a> -         afw::geom::ellipses::Ellipse const & ellipse</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
190  <a href="#397f9519">397f9519</a> -     ) const;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
191  <a href="#397f9519">397f9519</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#397f9519">397f9519</a> - private:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
193  <a href="#397f9519">397f9519</a> -     class Impl;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
194  <a href="#c71cc00d">c71cc00d</a> -     PTR(Impl) _impl;</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
195  <a href="#397f9519">397f9519</a> - };</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
196  <a href="#397f9519">397f9519</a> - </div>
                }} // namespace lsst::shapelet
                
                #endif // !LSST_SHAPELET_MultiShapeletBasis_h_INCLUDED
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/shapelet/</h2>
<h3><a name="c71cc00d"/></a>c71cc00d</h3>

<pre>
commit c71cc00df775b1c3169ab344a87e6306ef63f53b
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri May 3 12:41:21 2013 -0400

    Use shared_ptr instead of scoped_ptr in MultiShapeletBasis to save it from being inconveniently noncopyable.
</pre>
<h3><a name="f7d496bb"/></a>f7d496bb</h3>

<pre>
commit f7d496bbadc651a4d00494414d3ab52a8cc0301a
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Fri Sep 27 15:49:56 2013 -0400

    Add size getters to MultiShapeletMatrixBuilder
</pre>
<h3><a name="397f9519"/></a>397f9519</h3>

<pre>
commit 397f9519681a23c37d2d2421f009e66d5b8a3aa4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 13:35:31 2013 -0400

    Add MultiShapeletBasis, MultiShapeletMatrixBuilder classes
</pre>
<h3><a name="84dd053e"/></a>84dd053e</h3>

<pre>
commit 84dd053ebce9df96669c9e35da0eaa60b23cb184
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Apr 25 13:43:37 2013 -0400

    Add fast optional fast approximate exponential support.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/shapelet/</h2>
<h3><a name="397f9519"/></a>397f9519</h3>

<pre>
commit 397f9519681a23c37d2d2421f009e66d5b8a3aa4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Apr 15 13:35:31 2013 -0400

    Add MultiShapeletBasis, MultiShapeletMatrixBuilder classes
</pre>
<h3><a name="5443966c"/></a>5443966c</h3>

<pre>
commit 5443966c6df3a3b3dfc9b2da5333cf31732bbf0a
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Sep 11 16:06:12 2014 -0400

    Add # of components getter to MultiShapeletBasis
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<script type="text/javascript">
self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{};var Prism=function(){var e=/\blang(?:uage)?-(?!\*)(\w+)\b/i,t=self.Prism={util:{encode:function(e){return e instanceof n?new n(e.type,t.util.encode(e.content),e.alias):"Array"===t.util.type(e)?e.map(t.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},clone:function(e){var n=t.util.type(e);switch(n){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=t.util.clone(e[r]));return a;case"Array":return e.map(function(e){return t.util.clone(e)})}return e}},languages:{extend:function(e,n){var a=t.util.clone(t.languages[e]);for(var r in n)a[r]=n[r];return a},insertBefore:function(e,n,a,r){r=r||t.languages;var i=r[e];if(2==arguments.length){a=arguments[1];for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);return i}var s={};for(var o in i)if(i.hasOwnProperty(o)){if(o==n)for(var l in a)a.hasOwnProperty(l)&&(s[l]=a[l]);s[o]=i[o]}return t.languages.DFS(t.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=s)}),r[e]=s},DFS:function(e,n,a){for(var r in e)e.hasOwnProperty(r)&&(n.call(e,r,e[r],a||r),"Object"===t.util.type(e[r])?t.languages.DFS(e[r],n):"Array"===t.util.type(e[r])&&t.languages.DFS(e[r],n,r))}},highlightAll:function(e,n){for(var a,r=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'),i=0;a=r[i++];)t.highlightElement(a,e===!0,n)},highlightElement:function(a,r,i){for(var l,s,o=a;o&&!e.test(o.className);)o=o.parentNode;if(o&&(l=(o.className.match(e)||[,""])[1],s=t.languages[l]),s){a.className=a.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=a.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var u=a.textContent;if(u){u=u.replace(/^(?:\r?\n|\r)/,"");var g={element:a,language:l,grammar:s,code:u};if(t.hooks.run("before-highlight",g),r&&self.Worker){var c=new Worker(t.filename);c.onmessage=function(e){g.highlightedCode=n.stringify(JSON.parse(e.data),l),t.hooks.run("before-insert",g),g.element.innerHTML=g.highlightedCode,i&&i.call(g.element),t.hooks.run("after-highlight",g)},c.postMessage(JSON.stringify({language:g.language,code:g.code}))}else g.highlightedCode=t.highlight(g.code,g.grammar,g.language),t.hooks.run("before-insert",g),g.element.innerHTML=g.highlightedCode,i&&i.call(a),t.hooks.run("after-highlight",g)}}},highlight:function(e,a,r){var i=t.tokenize(e,a);return n.stringify(t.util.encode(i),r)},tokenize:function(e,n){var a=t.Token,r=[e],i=n.rest;if(i){for(var l in i)n[l]=i[l];delete n.rest}e:for(var l in n)if(n.hasOwnProperty(l)&&n[l]){var s=n[l];s="Array"===t.util.type(s)?s:[s];for(var o=0;o<s.length;++o){var u=s[o],g=u.inside,c=!!u.lookbehind,f=0,h=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var d=r[p];if(r.length>e.length)break e;if(!(d instanceof a)){u.lastIndex=0;var m=u.exec(d);if(m){c&&(f=m[1].length);var y=m.index-1+f,m=m[0].slice(f),v=m.length,k=y+v,b=d.slice(0,y+1),w=d.slice(k+1),N=[p,1];b&&N.push(b);var O=new a(l,g?t.tokenize(m,g):m,h);N.push(O),w&&N.push(w),Array.prototype.splice.apply(r,N)}}}}}return r},hooks:{all:{},add:function(e,n){var a=t.hooks.all;a[e]=a[e]||[],a[e].push(n)},run:function(e,n){var a=t.hooks.all[e];if(a&&a.length)for(var r,i=0;r=a[i++];)r(n)}}},n=t.Token=function(e,t,n){this.type=e,this.content=t,this.alias=n};if(n.stringify=function(e,a,r){if("string"==typeof e)return e;if("Array"===t.util.type(e))return e.map(function(t){return n.stringify(t,a,e)}).join("");var i={type:e.type,content:n.stringify(e.content,a,r),tag:"span",classes:["token",e.type],attributes:{},language:a,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var l="Array"===t.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,l)}t.hooks.run("wrap",i);var s="";for(var o in i.attributes)s+=o+'="'+(i.attributes[o]||"")+'"';return"<"+i.tag+' class="'+i.classes.join(" ")+'" '+s+">"+i.content+"</"+i.tag+">"},!self.document)return self.addEventListener?(self.addEventListener("message",function(e){var n=JSON.parse(e.data),a=n.language,r=n.code;self.postMessage(JSON.stringify(t.util.encode(t.tokenize(r,t.languages[a])))),self.close()},!1),self.Prism):self.Prism;var a=document.getElementsByTagName("script");return a=a[a.length-1],a&&(t.filename=a.src,document.addEventListener&&!a.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",t.highlightAll)),self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism);
</script>
</body>

</html>
