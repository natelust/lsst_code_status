<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title>pex_config</title>
<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>
<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', monospace;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>
</head>
<body>
<h1 id="toc_0">Comparison of the pex_config repository</h1>

<div style="background-color:Aquamarine; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Summary of Repositories</h1>
<p>
Comparison run at 11:46AM on June 09, 2015<br>
There are <b>275</b> differences between the two repositories<br><br>
Repository <b>/Users/nate/repos_hsc/pex_config/</b> <br> Revision <b>fe0f1ad85dccd7c80c533afadcb471837aedf4b4</b><br> Branch <b>master</b><br>Last commit was on <b>2015-04-17 13:58:09 +0900</b><br><br>
Repository <b>/Users/nate/repos_lsst/pex_config/</b> <br> Revision <b>4b4ae5900c766ce7bfee216e6360da8520a20cf6</b><br> Branch <b>master</b><br>Last commit was on <b>2015-06-08 16:22:15 -0700</b><br><br>
</p>
</div>

<hr>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Files only in /Users/nate/repos_hsc/pex_config/</h1>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
<h1>Files only in /Users/nate/repos_lsst/pex_config/</h1>
<h2>tests/history.py</h2>
<pre>
commit 4b4ae5900c766ce7bfee216e6360da8520a20cf6
Merge: 1bbe32c 0d6ed0e
Author: Joshua Hoblitt <jhoblitt@cpan.org>
Date:   Mon Jun 8 16:22:15 2015 -0700

    Merge pull request #1 from lsst/tickets/DM-2636
    
    Tickets/dm 2636</pre>
</div>

<h1 id="toc_1">List of the files in common<a name="homelist"></a></h1>

<p>Files without links do not differ</p>

<ul>
<li><code>doc/doxygen.conf.in</code></li>
<li><code>ups/pex_config.cfg</code></li>
<li><code>python/lsst/pex/config/choiceField.py</code></li>
<li><code>doc/SConscript</code></li>
<li><code>python/lsst/pex/config/rangeField.py</code></li>
<li><a href="#python/lsst/pex/config/wrap.py"><code>python/lsst/pex/config/wrap.py</code></a></li>
<li><code>ups/pex_config.build</code></li>
<li><code>SConstruct</code></li>
<li><code>tests/SConscript</code></li>
<li><a href="#ups/pex_config.table"><code>ups/pex_config.table</code></a></li>
<li><a href="#python/lsst/pex/config/dictField.py"><code>python/lsst/pex/config/dictField.py</code></a></li>
<li><a href="#tests/ticket1929.py"><code>tests/ticket1929.py</code></a></li>
<li><code>python/lsst/pex/config/__init__.py</code></li>
<li><code>tests/ticket2818.py</code></li>
<li><code>.gitignore</code></li>
<li><code>python/lsst/pex/config/convert.py</code></li>
<li><code>python/lsst/pex/config/registry.py</code></li>
<li><a href="#tests/testLib.i"><code>tests/testLib.i</code></a></li>
<li><code>README</code></li>
<li><code>tests/listField.py</code></li>
<li><a href="#tests/config.py"><code>tests/config.py</code></a></li>
<li><a href="#tests/ticket1914.py"><code>tests/ticket1914.py</code></a></li>
<li><code>python/lsst/pex/config/configurableField.py</code></li>
<li><code>tests/configDictField.py</code></li>
<li><code>tests/ticket1911.py</code></li>
<li><code>tests/config/ticket1914.py</code></li>
<li><a href="#tests/ticket1915.py"><code>tests/ticket1915.py</code></a></li>
<li><code>python/lsst/__init__.py</code></li>
<li><code>doc/overview.dox</code></li>
<li><a href="#python/lsst/pex/config/history.py"><code>python/lsst/pex/config/history.py</code></a></li>
<li><code>tests/configChoiceField.py</code></li>
<li><code>tests/ticket2818/another.py</code></li>
<li><a href="#python/lsst/pex/config/configChoiceField.py"><code>python/lsst/pex/config/configChoiceField.py</code></a></li>
<li><a href="#tests/wrap.py"><code>tests/wrap.py</code></a></li>
<li><code>tests/configurableField.py</code></li>
<li><code>tests/ticket2818/__init__.py</code></li>
<li><code>python/lsst/pex/config/configDictField.py</code></li>
<li><code>python/lsst/pex/__init__.py</code></li>
<li><code>python/lsst/pex/config/configField.py</code></li>
<li><code>doc/pex_config.inc</code></li>
<li><code>tests/ticket2818/define.py</code></li>
<li><a href="#tests/dictField.py"><code>tests/dictField.py</code></a></li>
<li><code>python/lsst/pex/config/comparison.py</code></li>
<li><code>tests/ticket1995.py</code></li>
<li><code>python/lsst/pex/config/SConscript</code></li>
<li><a href="#tests/registry.py"><code>tests/registry.py</code></a></li>
<li><a href="#python/lsst/pex/config/config.py"><code>python/lsst/pex/config/config.py</code></a></li>
<li><code>python/lsst/pex/config/listField.py</code></li>
<li><code>include/lsst/pex/config.h</code></li>
</ul>

<h1 id="toc_2"><a name="python/lsst/pex/config/wrap.py"/></a>python/lsst/pex/config/wrap.py</h1>

<h3 id="toc_3">Diff:</h3>

<pre>
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                import inspect
                import re
                import importlib
                import traceback
                
                from .config import *
                from .listField import *
                from .configField import *
                
                __all__ = ("wrap", "makeConfigClass")
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
34   <a href="#472329b8">472329b8</a> + # Mapping from C++ types to Python type: assumes we can round-trip between these using</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#472329b8">472329b8</a> + # the usual Swig converters, but doesn't require they be binary equivalent under-the-hood</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#472329b8">472329b8</a> + # or anything.</div>
                _dtypeMap = {
                    "bool": bool,
                    "int": int,
                    "double": float,
                    "float": float,
                    "boost::int64_t": int,
                    "std::string": str
                }
                
                _containerRegex = re.compile(r"(std::)?(vector|list)<\s*(?P<type>[a-z0-9_:]+)\s*>")
                
                def makeConfigClass(ctrl, name=None, base=Config, doc=None, module=1, cls=None):
                    """A function that creates a Python config class that matches a  C++ control object class.
                
                    @param ctrl        C++ control class to wrap.
                    @param name        Name of the new config class; defaults to the __name__ of the control
                                       class with 'Control' replaced with 'Config'.
                    @param base        Base class for the config class.
                    @param doc         Docstring for the config class.
                    @param module      Either a module object, a string specifying the name of the module, or an
                                       integer specifying how far back in the stack to look for the module to use:
                                       0 is pex.config.wrap, 1 is the immediate caller, etc.  This will be used to
                                       set __module__ for the new config class, and the class will also be added
                                       to the module.  Ignored if None or if cls is not None, but note that the default
                                       is to use the callers' module.
                    @param cls         An existing config class to use instead of creating a new one; name, base
                                       doc, and module will be ignored if this is not None.
                
                    See the 'wrap' decorator as a way to use makeConfigClass that may be more convenient.
                
                    To use makeConfigClass, in C++, write a control object, using the LSST_CONTROL_FIELD macro in
                    lsst/pex/config.h (note that it must have sensible default constructor):
                
                    @code
                    // myHeader.h
                
                    struct InnerControl {
                        LSST_CONTROL_FIELD(wim, std::string, "documentation for field 'wim'");
                    };
                
                    struct FooControl {
                        LSST_CONTROL_FIELD(bar, int, "documentation for field 'bar'");
                        LSST_CONTROL_FIELD(baz, double, "documentation for field 'baz'");
                        LSST_NESTED_CONTROL_FIELD(zot, mySwigLib, InnerControl, "documentation for field 'zot'");
                
                        FooControl() : bar(0), baz(0.0) {}
                    };
                    @endcode
                
                
                    You can use LSST_NESTED_CONTROL_FIELD to nest control objects.  Now, Swig those control objects as
                    you would any other C++ class, but make sure you include lsst/pex/config.h before including the header
                    file where the control object class is defined:
                    @code
                    // mySwigLib.i
                    %{
                    #include "myHeader.h"
                    %}
                
                    %include "lsst/pex/config.h"
                    %include "myHeader.h"
                    @endcode
                
                    Now, in Python, do this:
                
                    @code
                    import mySwigLib
                    import lsst.pex.config
                    InnerConfig = lsst.pex.config.makeConfigClass(mySwigLib.InnerControl)
                    FooConfig = lsst.pex.config.makeConfigClass(mySwigLib.FooControl)
                    @endcode
                
                    This will add fully-fledged "bar", "baz", and "zot" fields to FooConfig, set
                    FooConfig.Control = FooControl, and inject makeControl and readControl
                    methods to create a FooControl and set the FooConfig from the FooControl,
                    respectively.  In addition, if FooControl has a validate() member function,
                    a custom validate() method will be added to FooConfig that uses it.   And,
                    of course, all of the above will be done for InnerControl/InnerConfig too.
                
                    Any field that would be injected that would clash with an existing attribute of the
                    class will be silently ignored; this allows the user to customize fields and
                    inherit them from wrapped control classes.  However, these names will still be
                    processed when converting between config and control classes, so they should generally
                    be present as base class fields or other instance attributes or descriptors.
                
                    While LSST_CONTROL_FIELD will work for any C++ type, automatic Config generation
                    only supports bool, int, boost::int64_t, double, and std::string  fields, along
                    with std::list and std::vectors of those types.
                    """
                    if name is None:
                        if "Control" not in ctrl.__name__:
                            raise ValueError("Cannot guess appropriate Config class name for %s." % ctrl)
                        name = ctrl.__name__.replace("Control", "Config")
                    if cls is None:
                        cls = type(name, (base,), {"__doc__":doc})
                        if module is not None:
                            # Not only does setting __module__ make Python pretty-printers more useful,
                            # it's also necessary if we want to pickle Config objects.
                            if isinstance(module, int):
                                frame = inspect.stack()[module]
                                moduleObj = inspect.getmodule(frame[0])
                                moduleName = moduleObj.__name__
                            elif isinstance(module, basestring):
                                moduleName = module
                                moduleObj = __import__(moduleName)
                            else:
                                moduleObj = module
                                moduleName = moduleObj.__name__
                            cls.__module__ = moduleName
                            setattr(moduleObj, name, cls)
                    if doc is None:
                        doc = ctrl.__doc__
                    fields = {}
                    # loop over all class attributes, looking for the special static methods that indicate a field
                    # defined by one of the macros in pex/config.h.
                    for attr in dir(ctrl):
                        if attr.startswith("_type_"):
                            k = attr[len("_type_"):]
                            getDoc = "_doc_" + k
                            getModule = "_module_" + k
                            getType = attr
                            if hasattr(ctrl, k) and hasattr(ctrl, getDoc):
                                doc = getattr(ctrl, getDoc)()
                                ctype = getattr(ctrl, getType)()
                                if hasattr(ctrl, getModule):  # if this is present, it's a nested control object
                                    nestedModuleName = getattr(ctrl, getModule)()
                                    if nestedModuleName == moduleName:
                                        nestedModuleObj = moduleObj
                                    else:
                                        nestedModuleObj = importlib.import_module(nestedModuleName)
                                    try:
                                        dtype = getattr(nestedModuleObj, ctype).ConfigClass
                                    except AttributeError:
                                        raise AttributeError("'%s.%s.ConfigClass' does not exist" % (moduleName, ctype))
                                    fields[k] = ConfigField(doc=doc, dtype=dtype)
                                else:
                                    try:
                                        dtype = _dtypeMap[ctype]
                                        FieldCls = Field
                                    except KeyError:
                                        dtype = None
                                        m = _containerRegex.match(ctype)
                                        if m:
                                            dtype = _dtypeMap.get(m.group("type"), None)
                                            FieldCls = ListField
                                    if dtype is None:
                                        raise TypeError("Could not parse field type '%s'." % ctype)
                                    fields[k] = FieldCls(doc=doc, dtype=dtype, optional=True)
                    # Define a number of methods to put in the new Config class.  Note that these are "closures";
                    # they have access to local variables defined in the makeConfigClass function (like the fields dict).
                    def makeControl(self):
                        """Construct a C++ Control object from this Config object.
                
                        Fields set to None will be ignored, and left at the values defined by the
                        Control object's default constructor.
                        """
                        r = self.Control()
                        for k, f in fields.iteritems():
                            value = getattr(self, k)
                            if isinstance(f, ConfigField):
                                value = value.makeControl()
                            if value is not None:
                                setattr(r, k, value)
                        return r
                    def readControl(self, control, __at=None, __label="readControl", __reset=False):
                        """Read values from a C++ Control object and assign them to self's fields.
                
                        The __at, __label, and __reset arguments are for internal use only; they are used to
                        remove internal calls from the history.
                        """
                        if __at is None: __at = traceback.extract_stack()[:-1]
                        values = {}
                        for k, f in fields.iteritems():
                            if isinstance(f, ConfigField):
                                getattr(self, k).readControl(getattr(control, k),
                                                             __at=__at, __label=__label, __reset=__reset)
                            else:
                                values[k] = getattr(control, k)
                        if __reset:
                            self._history = {}
                        self.update(__at=__at, __label=__label, **values)
                    def validate(self):
                        """Validate the config object by constructing a control object and using
                        a C++ validate() implementation."""
                        super(cls, self).validate()
                        r = self.makeControl()
                        r.validate()
                    def setDefaults(self):
                        """Initialize the config object, using the Control objects default ctor
                        to provide defaults."""
                        super(cls, self).setDefaults()
                        try:
                            r = self.Control()
                            # Indicate in the history that these values came from C++, even if we can't say which line
                            self.readControl(r, __at=[(ctrl.__name__ + " C++", 0, "setDefaults", "")], __label="defaults",
                                             __reset=True)
                        except:
                            pass # if we can't instantiate the Control, don't set defaults
                
                    ctrl.ConfigClass = cls
                    cls.Control = ctrl
                    cls.makeControl = makeControl
                    cls.readControl = readControl
                    cls.setDefaults = setDefaults
                    if hasattr(ctrl, "validate"):
                        cls.validate = validate
                    for k, field in fields.iteritems():
                        if not hasattr(cls, k):
                            setattr(cls, k, field)
                    return cls
                
                def wrap(ctrl):
                    """A decorator that adds fields from a C++ control class to a Python config class.
                
                    Used like this:
                
                    @wrap(MyControlClass)
                    class MyConfigClass(Config):
                        pass
                
                    See makeConfigClass for more information; this is equivalent to calling makeConfigClass
                    with the decorated class as the 'cls' argument.
                    """
                    def decorate(cls):
                        return makeConfigClass(ctrl, cls=cls)
                    return decorate
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="472329b8"/></a>472329b8</h3>

<pre>
commit 472329b851dfc8f750dbdc3fd8dc1229190b7ecf
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue May 20 15:56:34 2014 -0400

    Explain mapping between C++ and Python types in control-object wrappers
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_4"><a name="ups/pex_config.table"/></a>ups/pex_config.table</h1>

<h3 id="toc_5">Diff:</h3>

<pre>
                setupRequired(daf_base)
                setupRequired(pex_policy)
                setupRequired(numpy)
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#0d6ed0e7">0d6ed0e7</a> + setupRequired(utils)</div>
                
                envPrepend(LD_LIBRARY_PATH, ${PRODUCT_DIR}/lib)
                envPrepend(DYLD_LIBRARY_PATH, ${PRODUCT_DIR}/lib)
                
                envPrepend(PYTHONPATH, ${PRODUCT_DIR}/python)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
9    <a href="#17f8b31d">17f8b31d</a> - envAppend(PATH, ${PRODUCT_DIR}/bin)</div>
              ?    ^^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
10   <a href="#399accf6">399accf6</a> + envPrepend(PATH, ${PRODUCT_DIR}/bin)</div>
              ?    ^^^
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="17f8b31d"/></a>17f8b31d</h3>

<pre>
commit 17f8b31d9e6c65fac6c36b4ea0ab2902f3f651d8
Author: rplante <rplante@git.lsstcorp.org>
Date:   Fri Apr 9 20:01:18 2010 +0000

    add bin to PATH; make validate.py executable; added PolicyString.h to policy.h
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="399accf6"/></a>399accf6</h3>

<pre>
commit 399accf64f8c02f221b0ed9376669c228ab988b1
Author: Robyn Allsman <robyn@LSST.org>
Date:   Fri Nov 14 21:18:29 2014 -0600

    Replace envAppend with envPrepend in ups table files.
</pre>
<h3><a name="0d6ed0e7"/></a>0d6ed0e7</h3>

<pre>
commit 0d6ed0e7aa9d8ebdeeef7e0cf9b0ba015a00fa8b
Author: Joshua Hoblitt <josh@hoblitt.com>
Date:   Fri May 22 12:21:56 2015 -0700

    replace eups.productDir() calls with lsst.utils.getPackageDir()
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_6"><a name="python/lsst/pex/config/dictField.py"/></a>python/lsst/pex/config/dictField.py</h1>

<h3 id="toc_7">Diff:</h3>

<pre>
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import traceback, copy
                import collections
                
                from .config import Config, Field, FieldValidationError, _typeStr, _autocast, _joinNamePath
                from .comparison import *
                
                __all__=["DictField"]
                
                class Dict(collections.MutableMapping):
                    """
                    Config-Internal mapping container
                    Emulates a dict, but adds validation and provenance.
                    """
                
                    def __init__(self, config, field, value, at, label, setHistory=True):
                        self._field = field
                        self._config = config
                        self._dict = {}
                        self._history = self._config._history.setdefault(self._field.name, [])
                        self.__doc__=field.doc
                        if value is not None:
                            try:
                                for k in value:
                                    #do not set history per-item
                                    self.__setitem__(k, value[k], at=at, label=label, setHistory=False)
                            except TypeError, e:
                                msg = "Value %s is of incorrect type %s. Mapping type expected."%\
                                        (value, _typeStr(value))
                                raise FieldValidationError(self._field, self._config, msg)
                        if setHistory:
                            self._history.append((dict(self._dict), at, label))
                
                
                    """
                    Read-only history
                    """
                    history = property(lambda x: x._history)   
                
                    def __getitem__(self, k): return self._dict[k]
                
                    def __len__(self): return len(self._dict)
                
                    def __iter__(self): return iter(self._dict)
                
                    def __contains__(self, k): return k in self._dict
                
                    def __setitem__(self, k, x, at=None, label="setitem", setHistory=True):
                        if self._config._frozen:
                            msg = "Cannot modify a frozen Config. "\
                                    "Attempting to set item at key %r to value %s"%(k, x)
                            raise FieldValidationError(self._field, self._config, msg)
                
                        #validate keytype
                        k = _autocast(k, self._field.keytype)
                        if type(k) != self._field.keytype:
                            msg = "Key %r is of type %s, expected type %s"%\
                                    (k, _typeStr(k), _typeStr(self._field.keytype))
                            raise FieldValidationError(self._field, self._config, msg)   
                
                        #validate itemtype
                        x = _autocast(x, self._field.itemtype)
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#252603e0">252603e0</a> +         if self._field.itemtype is None:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#252603e0">252603e0</a> +             if type(x) not in self._field.supportedTypes and x is not None:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
85   <a href="#252603e0">252603e0</a> +                 msg ="Value %s at key %r is of invalid type %s" % (x, k, _typeStr(x))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#252603e0">252603e0</a> +                 raise FieldValidationError(self._field, self._config, msg)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#252603e0">252603e0</a> +         else:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#e318efec">e318efec</a> -         if type(x) != self._field.itemtype and x is not None:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#252603e0">252603e0</a> +             if type(x) != self._field.itemtype and x is not None:</div>
              ? ++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#e318efec">e318efec</a> -             msg ="Value %s at key %r is of incorrect type %s. Expected type %s"%\</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
89   <a href="#252603e0">252603e0</a> +                 msg ="Value %s at key %r is of incorrect type %s. Expected type %s"%\</div>
              ? ++++
                                    (x, k, _typeStr(x), _typeStr(self._field.itemtype))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#e318efec">e318efec</a> -             raise FieldValidationError(self._field, self._config, msg)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#252603e0">252603e0</a> +                 raise FieldValidationError(self._field, self._config, msg)</div>
              ? ++++
                
                        #validate item using itemcheck
                        if self._field.itemCheck is not None and not self._field.itemCheck(x):
                            msg="Item at key %r is not a valid value: %s"%(k, x)
                            raise FieldValidationError(self._field, self._config, msg)
                
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                            
                        self._dict[k]=x
                        if setHistory:
                            self._history.append((dict(self._dict), at, label))
                
                    def __delitem__(self, k, at=None, label="delitem", setHistory=True):
                        if self._config._frozen:
                            raise FieldValidationError(self._field, self._config, 
                                    "Cannot modify a frozen Config")
                        
                        del self._dict[k]
                        if setHistory:
                            if at is None:
                                at = traceback.extract_stack()[:-1]
                            self._history.append((dict(self._dict), at, label))
                
                    def __repr__(self): return repr(self._dict)
                
                    def __str__(self): return str(self._dict)
                
                    def __setattr__(self, attr, value, at=None, label="assignment"):
                        if hasattr(getattr(self.__class__, attr, None), '__set__'):
                            # This allows properties to work.
                            object.__setattr__(self, attr, value)
                        elif attr in self.__dict__ or attr in ["_field", "_config", "_history", "_dict", "__doc__"]:
                            # This allows specific private attributes to work.
                            object.__setattr__(self, attr, value)
                        else:
                            # We throw everything else.
                            msg = "%s has no attribute %s"%(_typeStr(self._field), attr)
                            raise FieldValidationError(self._field, self._config, msg) 
                
                
                class DictField(Field):
                    """
                    Defines a field which is a mapping of values
                
                    Both key and item types are restricted to builtin POD types:
                        (int, float, complex, bool, str)
                    
                    Users can provide two check functions:
                        dictCheck: used to validate the dict as a whole, and
                        itemCheck: used to validate each item individually
                
                    For example to define a field which is a mapping from names to int values:
                
                    class MyConfig(Config):
                        field = DictField(
                                doc="example string-to-int mapping field", 
                                keytype=str, itemtype=int, 
                                default= {})
                    """
                    DictClass = Dict
                
                    def __init__(self, doc, keytype, itemtype, default=None, optional=False, dictCheck=None, itemCheck=None):
                        source = traceback.extract_stack(limit=2)[0]
                        self._setup( doc=doc, dtype=Dict, default=default, check=None, 
                                optional=optional, source=source)
                        if keytype not in self.supportedTypes:
                            raise ValueError("'keytype' %s is not a supported type"%\
                                    _typeStr(keytype))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#51e260f5">51e260f5</a> -         elif itemtype not in self.supportedTypes:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#252603e0">252603e0</a> +         elif itemtype is not None and itemtype not in self.supportedTypes:</div>
              ?                       +++    ++++++++++++++++++++++
                            raise ValueError("'itemtype' %s is not a supported type"%\
                                    _typeStr(itemtype))
                        if dictCheck is not None and not hasattr(dictCheck, "__call__"):
                            raise ValueError("'dictCheck' must be callable")
                        if itemCheck is not None and not hasattr(itemCheck, "__call__"):
                            raise ValueError("'itemCheck' must be callable")
                
                        self.keytype = keytype
                        self.itemtype = itemtype
                        self.dictCheck = dictCheck
                        self.itemCheck = itemCheck
                   
                    def validate(self, instance):
                        """
                        DictField validation ensures that non-optional fields are not None,
                            and that non-None values comply with dictCheck.
                        Individual Item checks are applied at set time and are not re-checked.
                        """
                        Field.validate(self, instance)
                        value = self.__get__(instance)
                        if value is not None and self.dictCheck is not None \
                                and not self.dictCheck(value):
                            msg = "%s is not a valid value"%str(value)
                            raise FieldValidationError(self, instance, msg)
                            
                
                    def __set__(self, instance, value, at=None, label="assignment"):
                        if instance._frozen:
                            msg = "Cannot modify a frozen Config. "\
                                  "Attempting to set field to value %s"%value
                            raise FieldValidationError(self, instance, msg)
                
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                        if value is not None:
                            value = self.DictClass(instance, self, value, at=at, label=label)
                        else:
                            history = instance._history.setdefault(self.name, [])
                            history.append((value, at, label))
                
                        instance._storage[self.name] = value
                    
                    def toDict(self, instance):        
                        value = self.__get__(instance)        
                        return dict(value) if value is not None else None
                
                    def _compare(self, instance1, instance2, shortcut, rtol, atol, output):
                        """Helper function for Config.compare; used to compare two fields for equality.
                
                        @param[in] instance1  LHS Config instance to compare.
                        @param[in] instance2  RHS Config instance to compare.
                        @param[in] shortcut   If True, return as soon as an inequality is found.
                        @param[in] rtol       Relative tolerance for floating point comparisons.
                        @param[in] atol       Absolute tolerance for floating point comparisons.
                        @param[in] output     If not None, a callable that takes a string, used (possibly repeatedly)
                                              to report inequalities.
                
                        Floating point comparisons are performed by numpy.allclose; refer to that for details.
                        """
                        d1 = getattr(instance1, self.name)
                        d2 = getattr(instance2, self.name)
                        name = getComparisonName(
                            _joinNamePath(instance1._name, self.name),
                            _joinNamePath(instance2._name, self.name)
                            )
                        if not compareScalars("isnone for %s" % name, d1 is None, d2 is None, output=output):
                            return False
                        if d1 is None and d2 is None:
                            return True
                        if not compareScalars("keys for %s" % name, d1.keys(), d2.keys(), output=output):
                            return False
                        equal = True
                        for k, v1 in d1.iteritems():
                            v2 = d2[k]
                            result = compareScalars("%s[%r]" % (name, k), v1, v2, dtype=self.itemtype,
                                                    rtol=rtol, atol=atol, output=output)
                            if not result and shortcut:
                                return False
                            equal = equal and result
                        return equal
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="51e260f5"/></a>51e260f5</h3>

<pre>
commit 51e260f5df8d3b26e4733e447d71db407f1c26f5
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Apr 3 09:13:49 2012 -0700

    Moved Filed implementations into their own files to improve
    readability and maintainability of the library.
</pre>
<h3><a name="e318efec"/></a>e318efec</h3>

<pre>
commit e318efec3fb7d78f9cd59c4329752fc91da28c1e
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue May 8 18:23:19 2012 -0700

    Added copyright headers to all python files.
    Modified ListField and DictField to clean up validation, make both the
    field and internal container classes more useful as base classes.
    Modified ConfigDictField to be derived from DictField.
    Modified ConfigDict to derive from Dict
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="252603e0"/></a>252603e0</h3>

<pre>
commit 252603e05a099b1d564c5317a5c99ac579d85e39
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jan 7 13:48:37 2015 -0500

    Add support for DictFields with dynamic itemtypes
    
    Passing itemtype=None now allows any of the supported itemtypes
    (as well as None) to be used in the same DictField.
    
    Also fixed some very minor problems in the test code for DictField.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_8"><a name="tests/ticket1929.py"/></a>tests/ticket1929.py</h1>

<h3 id="toc_9">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConf
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
28   <a href="#e3c3dbe3">e3c3dbe3</a> - import eups</div>
                
                class Config1(pexConf.Config):
                    f = pexConf.Field("Config1.f", float, default=4)
                
                class Config2(Config1):
                    def setDefaults(self):
                        self.f =5
                
                class Config3(Config1):
                   def __init__(self, **kw):
                       self.f =6
                
                
                class SquashingDefaultsTest(unittest.TestCase):
                    def test(self):
                        c1 = Config1()
                        self.assertEqual(c1.f, 4)
                        c1 = Config1(f=9)
                        self.assertEqual(c1.f, 9)
                
                        c2= Config2()
                        self.assertEqual(c2.f, 5)
                        c2=Config2(f=10)
                        self.assertEqual(c2.f, 10)
                
                        c3=Config3()
                        self.assertEqual(c3.f, 6)
                        c3=Config3(f=11)
                        self.assertEqual(c3.f, 6)
                
                def  suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(SquashingDefaultsTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="e3c3dbe3"/></a>e3c3dbe3</h3>

<pre>
commit e3c3dbe3f94a5761b463847d6c5520c6629b2dc7
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Feb 21 14:30:13 2012 -0800

    Added Config.__new__ to ensure that all fields are properly initialized
    before a derived config type has a chance to modify them in __init__.
    
    Added the function setDefaults() to the Config API. In the base class it
    is a no-op, derived classes can implement it to set computed defaults.
    
    Config.__init__ now calls setDefaults so derived classes need not modify
    __init__, just setDefaults
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_10"><a name="tests/testLib.i"/></a>tests/testLib.i</h1>

<h3 id="toc_11">Diff:</h3>

<pre>
                // -*- lsst-c++ -*-
                
                /* 
                 * LSST Data Management System
                 * Copyright 2008, 2009, 2010 LSST Corporation.
                 * 
                 * This product includes software developed by the
                 * LSST Project (http://www.lsst.org/).
                 *
                 * This program is free software: you can redistribute it and/or modify
                 * it under the terms of the GNU General Public License as published by
                 * the Free Software Foundation, either version 3 of the License, or
                 * (at your option) any later version.
                 * 
                 * This program is distributed in the hope that it will be useful,
                 * but WITHOUT ANY WARRANTY; without even the implied warranty of
                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                 * GNU General Public License for more details.
                 * 
                 * You should have received a copy of the LSST License Statement and 
                 * the GNU General Public License along with this program.  If not, 
                 * see <http://www.lsstcorp.org/LegalNotices/>.
                 */
                 
                %define testLib_DOCSTRING
                "
                Various swigged-up C++ classes for testing
                "
                %enddef
                
                %feature("autodoc", "1");
                %module(package="testLib", docstring=testLib_DOCSTRING) testLib
                
                %pythonnondynamic;
                %naturalvar;  // use const reference typemaps
                
                %include "lsst/p_lsstSwig.i"
                %include "std_vector.i"
                
                %lsst_exceptions()
                
                %{
                #include "lsst/pex/config.h"
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#f98a74e2">f98a74e2</a> + #include "boost/cstdint.hpp"</div>
                %}
                
                %include "lsst/pex/config.h"
                
                %template(StringVec) std::vector<std::string>;
                
                %inline %{
                
                    struct InnerControlObject {
                        LSST_CONTROL_FIELD(p, double, "a double field");
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#f98a74e2">f98a74e2</a> +         LSST_CONTROL_FIELD(q, boost::int64_t, "a 64-bit integer field");</div>
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#f3d1f8eb">f3d1f8eb</a> -         explicit InnerControlObject(double p_ = 2.0) : p(p_) {}</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#f98a74e2">f98a74e2</a> +         explicit InnerControlObject(double p_ = 2.0) : p(p_), q(boost::int64_t(1) << 33) {}</div>
              ?                                                             ++++++++++++++++++++++++++++
                    };
                
                    struct OuterControlObject {
                        LSST_NESTED_CONTROL_FIELD(a, testLib, InnerControlObject, "a nested control field");
                        LSST_CONTROL_FIELD(b, int, "a integer field");
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#f3d1f8eb">f3d1f8eb</a> -         OuterControlObject(int b_ = 0) : b(b_) {}</div>
              ?                                                 -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#f07a1fed">f07a1fed</a> +         OuterControlObject(int b_ = 0) : b(b_) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
65   <a href="#f98a74e2">f98a74e2</a> +             a.q += 1;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#f07a1fed">f07a1fed</a> +         }</div>
                    };
                
                    struct ControlObject {
                        LSST_CONTROL_FIELD(foo, int, "an integer field");
                        LSST_CONTROL_FIELD(bar, std::vector<std::string>, "a list of strings field");
                
                        explicit ControlObject(int foo_=1) : foo(foo_), bar() {}
                    };
                
                    bool checkControl(ControlObject const & ctrl, int fooVal, std::vector<std::string> const & barVal) {
                        return fooVal == ctrl.foo && barVal == ctrl.bar;
                    }
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#f3d1f8eb">f3d1f8eb</a> -     bool checkNestedControl(OuterControlObject const & ctrl, double apVal, int bVal) {</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#f98a74e2">f98a74e2</a> +     bool checkNestedControl(OuterControlObject const & ctrl, double apVal, boost::int64_t aqVal, int bVal) {</div>
              ?                                                                            +++++++   +++++++++++++++
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#f3d1f8eb">f3d1f8eb</a> -         return ctrl.a.p == apVal && ctrl.b == bVal;</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#f07a1fed">f07a1fed</a> +         return ctrl.a.p == apVal && ctrl.b == bVal && ctrl.a.q == aqVal;</div>
              ?                                                +++++++++++++++++++++
                    }
                
                %}
                
                %pythoncode %{
                
                import lsst.pex.config
                InnerConfigObject = lsst.pex.config.makeConfigClass(InnerControlObject)
                OuterConfigObject = lsst.pex.config.makeConfigClass(OuterControlObject)
                ConfigObject = lsst.pex.config.makeConfigClass(ControlObject)
                
                %}
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="f3d1f8eb"/></a>f3d1f8eb</h3>

<pre>
commit f3d1f8eb62763d26d21b33772364901b90aa4253
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Sep 18 17:23:50 2012 -0400

    Add support for nested control objects to wrap mechanism (#2038).
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="f07a1fed"/></a>f07a1fed</h3>

<pre>
commit f07a1fed5c0bdf5dd1accbfd478d86e2898214b4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu May 15 09:07:31 2014 -0400

    Add tests for nested control defaults bug
</pre>
<h3><a name="f98a74e2"/></a>f98a74e2</h3>

<pre>
commit f98a74e28adac5bf5c68b6bd9286d1d10196d444
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue May 20 15:51:02 2014 -0400

    Modify unit tests to check behavior of wrapped int64_t.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_12"><a name="tests/config.py"/></a>tests/config.py</h1>

<h3 id="toc_13">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import io
                import re
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConfig
                import sys
                import pickle
                
                GLOBAL_REGISTRY = {}
                
                class Simple(pexConfig.Config):
                    i = pexConfig.Field("integer test", int, optional=True)
                    f = pexConfig.Field("float test", float, default=3.0)
                    b = pexConfig.Field("boolean test", bool, default=False, optional=False)
                    c = pexConfig.ChoiceField("choice test", str, default="Hello",
                            allowed={"Hello":"First choice", "World":"second choice"})
                    r = pexConfig.RangeField("Range test", float, default = 3.0, optional=False,
                            min=3.0, inclusiveMin=True)
                    l = pexConfig.ListField("list test", int, default=[1,2,3], maxLength=5,
                        itemCheck=lambda x: x is not None and x>0)
                    d = pexConfig.DictField("dict test", str, str, default={"key":"value"}, 
                            itemCheck=lambda x: x.startswith('v'))
                    n = pexConfig.Field("nan test", float, default=float("NAN"))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#0431b7d4">0431b7d4</a> -     m = pexConfig.Field(None, int, optional=True)</div>
                
                GLOBAL_REGISTRY["AAA"] = Simple
                
                class InnerConfig(pexConfig.Config):
                    f = pexConfig.Field("Inner.f", float, default=0.0, check = lambda x: x >= 0, optional=False)
                GLOBAL_REGISTRY["BBB"] = InnerConfig
                
                class OuterConfig(InnerConfig, pexConfig.Config):
                    i = pexConfig.ConfigField("Outer.i", InnerConfig)   
                    def __init__(self):
                        pexConfig.Config.__init__(self)
                        self.i.f = 5.0
                
                    def validate(self):
                        pexConfig.Config.validate(self)
                        if self.i.f < 5:
                            raise ValueError("validation failed, outer.i.f must be greater than 5")
                
                
                class Complex(pexConfig.Config):
                    c = pexConfig.ConfigField("an inner config", InnerConfig)
                    r = pexConfig.ConfigChoiceField("a registry field", typemap=GLOBAL_REGISTRY,
                                                    default="AAA", optional=False)
                    p = pexConfig.ConfigChoiceField("another registry", typemap=GLOBAL_REGISTRY,
                                                    default="BBB", optional=True)
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
75   <a href="#960b73ff">960b73ff</a> - class TestDoc(pexConfig.Config):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#960b73ff">960b73ff</a> -     doc1 = pexConfig.Field("Doc with 'quotes' in it", str, default = "Test string 1")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#960b73ff">960b73ff</a> -     doc2 = pexConfig.Field("Doc end with 'quote'", str, default = "Test string 2")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#0431b7d4">0431b7d4</a> -     doc3 = pexConfig.Field(None, str, default = "Test string 3")</div>
                
                class ConfigTest(unittest.TestCase):
                    def setUp(self): 
                        self.simple = Simple()
                        self.inner = InnerConfig()
                        self.outer = OuterConfig()
                        self.comp = Complex()
                    
                    def tearDown(self):
                        del self.simple
                        del self.inner
                        del self.outer
                        del self.comp
                
                    def testInit(self):
                        self.assertEqual(self.simple.i, None)
                        self.assertEqual(self.simple.f, 3.0)
                        self.assertEqual(self.simple.b, False)
                        self.assertEqual(self.simple.c, "Hello")
                        self.assertEqual(list(self.simple.l), [1,2,3])
                        self.assertEqual(self.simple.d["key"], "value")
                        self.assertEqual(self.inner.f, 0.0)
                
                        self.assertEqual(self.outer.i.f, 5.0)
                        self.assertEqual(self.outer.f, 0.0)
                
                        self.assertEqual(self.comp.c.f, 0.0)
                        self.assertEqual(self.comp.r.name, "AAA")
                        self.assertEqual(self.comp.r.active.f, 3.0)
                        self.assertEqual(self.comp.r["BBB"].f, 0.0)
                
                
                    def testValidate(self):
                        self.simple.validate()
                
                        self.inner.validate()
                        self.assertRaises(ValueError, setattr, self.outer.i, "f",-5)
                        self.outer.i.f=10.
                        self.outer.validate()
                       
                        try:
                            self.simple.d["failKey"]="failValue"
                        except pexConfig.FieldValidationError:
                            pass
                        except:
                            raise "Validation error Expected"
                        self.simple.validate()
                
                        self.outer.i = InnerConfig
                        self.assertRaises(ValueError, self.outer.validate)
                        self.outer.i = InnerConfig()
                        self.assertRaises(ValueError, self.outer.validate)
                        
                        self.comp.validate()
                        self.comp.r= None
                        self.assertRaises(ValueError, self.comp.validate)
                        self.comp.r="BBB"
                        self.comp.validate()
                
                    def testSave(self):
                        self.comp.r="BBB"
                        self.comp.p="AAA"
                        self.comp.c.f=5.
                        self.comp.save("roundtrip.test")
                        
                        roundTrip = Complex()
                        roundTrip.load("roundtrip.test")
                        os.remove("roundtrip.test")
                
                        self.assertEqual(self.comp.c.f, roundTrip.c.f)
                        self.assertEqual(self.comp.r.name, roundTrip.r.name)
                
                        del roundTrip
                        #test saving to an open file
                        outfile = open("roundtrip.test", "w")
                        self.comp.saveToStream(outfile)
                        outfile.close()
                
                        roundTrip = Complex()
                        roundTrip.load("roundtrip.test")
                        os.remove("roundtrip.test")
                
                        self.assertEqual(self.comp.c.f, roundTrip.c.f)
                        self.assertEqual(self.comp.r.name, roundTrip.r.name)
                
                
                    def testDuplicateRegistryNames(self):
                        self.comp.r["AAA"].f = 5.0
                        self.assertEqual(self.comp.p["AAA"].f, 3.0)
                
                    def testInheritance(self):
                        class AAA(pexConfig.Config):
                            a = pexConfig.Field("AAA.a", int, default=4)
                        class BBB(AAA):
                            b = pexConfig.Field("BBB.b", int, default=3)
                        class CCC(BBB):
                            c = pexConfig.Field("CCC.c", int, default=2)
                        
                        #test multi-level inheritance
                        c= CCC()
                        self.assertEqual(c.toDict().has_key("a"), True)
                        self.assertEqual(c._fields["a"].dtype, int)
                        self.assertEqual(c.a, 4)
                
                        #test conflicting multiple inheritance
                        class DDD(pexConfig.Config):
                            a = pexConfig.Field("DDD.a", float, default=0.0)
                
                        class EEE(DDD, AAA):
                            pass
                
                        e = EEE()
                        self.assertEqual(e._fields["a"].dtype, float)
                        self.assertEqual(e.toDict().has_key("a"), True)
                        self.assertEqual(e.a, 0.0)
                
                        class FFF(AAA, DDD):
                            pass
                        f = FFF()
                        self.assertEqual(f._fields["a"].dtype, int)
                        self.assertEqual(f.toDict().has_key("a"), True)
                        self.assertEqual(f.a, 4)
                
                        #test inheritance from non Config objects
                        class GGG(object):
                            a = pexConfig.Field("AAA.a", float, default=10.)
                        class HHH(GGG, AAA):
                            pass
                        h = HHH()
                        self.assertEqual(h._fields["a"].dtype, float)
                        self.assertEqual(h.toDict().has_key("a"), True)
                        self.assertEqual(h.a, 10.0)
                
                        #test partial Field redefinition
                
                        class III(AAA):
                            pass
                        III.a.default=5
                
                        self.assertEqual(III.a.default, 5)
                        self.assertEqual(AAA.a.default, 4)
                    
                    def testConvert(self):
                        pol = pexConfig.makePolicy(self.simple)
                        self.assertEqual(pol.exists("i"), False)
                        self.assertEqual(pol.get("f"), self.simple.f)
                        self.assertEqual(pol.get("b"), self.simple.b)
                        self.assertEqual(pol.get("c"), self.simple.c)
                        self.assertEqual(pol.getArray("l"), list(self.simple.l))
                        
                        ps = pexConfig.makePropertySet(self.simple)
                        self.assertEqual(ps.exists("i"), False)
                        self.assertEqual(ps.get("f"), self.simple.f)
                        self.assertEqual(ps.get("b"), self.simple.b)
                        self.assertEqual(ps.get("c"), self.simple.c)
                        self.assertEqual(list(ps.get("l")), list(self.simple.l))
                
                        pol = pexConfig.makePolicy(self.comp)
                        self.assertEqual(pol.get("c.f"), self.comp.c.f)
                
                        ps = pexConfig.makePropertySet(self.comp)
                        self.assertEqual(ps.get("c.f"), self.comp.c.f)
                    def testFreeze(self):
                        self.comp.freeze()
                
                        self.assertRaises(pexConfig.FieldValidationError, setattr, self.comp.c, "f", 10.0)
                        self.assertRaises(pexConfig.FieldValidationError, setattr, self.comp, "r", "AAA")
                        self.assertRaises(pexConfig.FieldValidationError, setattr, self.comp, "p", "AAA")
                        self.assertRaises(pexConfig.FieldValidationError, setattr, self.comp.p["AAA"], "f", 5.0) 
                
                    def checkImportRoundTrip(self, importStatement, searchString, shouldBeThere):
                        self.comp.c.f=5.
                
                        # Generate a Config through loading
                        stream = io.BytesIO()
                        stream.write(importStatement)
                        self.comp.saveToStream(stream)
                        roundtrip = Complex()
                        roundtrip.loadFromStream(stream.getvalue())
                        self.assertEqual(self.comp.c.f, roundtrip.c.f)
                        
                        # Check the save stream
                        stream = io.BytesIO()
                        roundtrip.saveToStream(stream)
                        self.assertEqual(self.comp.c.f, roundtrip.c.f)
                        if shouldBeThere:
                            self.assertTrue(re.search(searchString, stream.getvalue()))
                        else:
                            self.assertFalse(re.search(searchString, stream.getvalue()))
                
                
                    def testImports(self):
                        importing = "import lsst.daf.base.citizen\n" # A module not used by anything else, but which exists
                        self.checkImportRoundTrip(importing, importing, True)
                
                    def testBadImports(self):
                        dummy = "somethingThatDoesntExist"
                        importing = """
                try:
                    import %s
                except ImportError:
                    pass
                """ % dummy
                        self.checkImportRoundTrip(importing, dummy, False)
                
                    def testPickle(self):
                        self.simple.f = 5
                        simple = pickle.loads(pickle.dumps(self.simple))
                        self.assertTrue(isinstance(simple, Simple))
                        self.assertEqual(self.simple.f, simple.f)
                
                        self.comp.c.f = 5
                        comp = pickle.loads(pickle.dumps(self.comp))
                        self.assertTrue(isinstance(comp, Complex))
                        self.assertEqual(self.comp.c.f, comp.c.f)
                
                    def testCompare(self):
                        comp2 = Complex()
                        inner2 = InnerConfig()
                        simple2 = Simple()
                        self.assert_(self.comp.compare(comp2))
                        self.assert_(comp2.compare(self.comp))
                        self.assert_(self.comp.c.compare(inner2))
                        self.assert_(self.simple.compare(simple2))
                        self.assert_(simple2.compare(self.simple))
                        self.assert_(self.simple == simple2)
                        self.assert_(simple2 == self.simple)
                        outList = []
                        outFunc = lambda msg: outList.append(msg)
                        simple2.b = True
                        simple2.l.append(4)
                        simple2.d["foo"] = "var"
                        self.assertFalse(self.simple.compare(simple2, shortcut=True, output=outFunc))
                        self.assertEqual(len(outList), 1)
                        del outList[:]
                        self.assertFalse(self.simple.compare(simple2, shortcut=False, output=outFunc))
                        output = "\n".join(outList)
                        self.assert_("Inequality in b" in output)
                        self.assert_("Inequality in size for l" in output)
                        self.assert_("Inequality in keys for d" in output)
                        del outList[:]
                        self.simple.d["foo"] = "vast"
                        self.simple.l.append(5)
                        self.simple.b = True
                        self.simple.f += 1E8
                        self.assertFalse(self.simple.compare(simple2, shortcut=False, output=outFunc))
                        output = "\n".join(outList)
                        self.assert_("Inequality in f" in output)
                        self.assert_("Inequality in l[3]" in output)
                        self.assert_("Inequality in d['foo']" in output)
                        del outList[:]
                        comp2.r["BBB"].f = 1.0  # changing the non-selected item shouldn't break equality
                        self.assert_(self.comp.compare(comp2))
                        comp2.r["AAA"].i = 56   # changing the selected item should break equality
                        comp2.c.f = 1.0
                        self.assertFalse(self.comp.compare(comp2, shortcut=False, output=outFunc))
                        output = "\n".join(outList)
                        self.assert_("Inequality in c.f" in output)
                        self.assert_("Inequality in r['AAA']" in output)
                        self.assert_("Inequality in r['BBB']" not in output)
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
340  <a href="#960b73ff">960b73ff</a> -     def testDoc(self):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
341  <a href="#960b73ff">960b73ff</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
342  <a href="#960b73ff">960b73ff</a> -         # Make sure docs can be read and written</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
343  <a href="#960b73ff">960b73ff</a> -         doc1 = TestDoc()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
344  <a href="#960b73ff">960b73ff</a> -         doc1.save('roundtrip.test')</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
345  <a href="#960b73ff">960b73ff</a> -         doc2 = TestDoc()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
346  <a href="#960b73ff">960b73ff</a> -         doc2.load('roundtrip.test')</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
347  <a href="#960b73ff">960b73ff</a> -         self.assertEqual(doc1,doc2)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
348  <a href="#960b73ff">960b73ff</a> -         os.remove('roundtrip.test')</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
349  <a href="#960b73ff">960b73ff</a> -         # This should fail because of triple quotes</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
350  <a href="#960b73ff">960b73ff</a> -         self.assertRaises(ValueError, pexConfig.Field, "Doc with '''triple''' quotes in it",</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
351  <a href="#0431b7d4">0431b7d4</a> -                           str, default = "Test string 4")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
352  <a href="#960b73ff">960b73ff</a> - </div>
                def suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(ConfigTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="0431b7d4"/></a>0431b7d4</h3>

<pre>
commit 0431b7d41b49d0d24d388ce3ea9d6267c2f8d984
Author: Bob Armstrong <rearmstr@gmail.com>
Date:   Tue Mar 3 13:52:29 2015 -0500

    Config: allow None as documentation string.
</pre>
<h3><a name="960b73ff"/></a>960b73ff</h3>

<pre>
commit 960b73ff92b9fa087b0d3956ae5285324352c176
Author: Bob Armstrong <rearmstr@gmail.com>
Date:   Mon Dec 8 15:38:56 2014 -0500

    Fix problem with docs that end in quotes
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_14"><a name="tests/ticket1914.py"/></a>tests/ticket1914.py</h1>

<h3 id="toc_15">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConf
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
28   <a href="#3ffc4dd1">3ffc4dd1</a> - import eups</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
28   <a href="#0d6ed0e7">0d6ed0e7</a> + import lsst.utils</div>
                
                class Config1(pexConf.Config):
                    f = pexConf.Field("Config1.f", float, default=4)
                
                class Config2(pexConf.Config):
                    r = pexConf.ConfigChoiceField("Config2.r", {"c1":Config1}, default="c1")
                
                class Config3(pexConf.Config):
                    c = pexConf.ConfigField("Config3.c", Config2)
                
                class FieldNameReportingTest(unittest.TestCase):
                    def test(self):
                        c3 = Config3()
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#a7e3ce45">a7e3ce45</a> -         pex_product_dir = eups.productDir("pex_config")</div>
              ?                           ^ ^  ^^^^^ ^    ^          ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#0d6ed0e7">0d6ed0e7</a> +         pex_product_dir = lsst.utils.getPackageDir('pex_config')</div>
              ?                           ^^^^^ ^^^  ^^^^^ ^^^^    ^          ^
                        c3.load(pex_product_dir+ "/tests/config/ticket1914.py")
                
                def  suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(FieldNameReportingTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="a7e3ce45"/></a>a7e3ce45</h3>

<pre>
commit a7e3ce45327e6d370ffbe902c2c8d7a9217a0efe
Merge: 8e394f6 0e99f68
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Wed Feb 15 13:57:11 2012 -0800

    Merge branch 'tickets/1914'
</pre>
<h3><a name="3ffc4dd1"/></a>3ffc4dd1</h3>

<pre>
commit 3ffc4dd1aef7ed30971dd1bd9b0d2b3bcea66b07
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Wed Feb 15 10:28:56 2012 -0800

    Changed ConfigInstanceDict to properly reflect it's field name
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="0d6ed0e7"/></a>0d6ed0e7</h3>

<pre>
commit 0d6ed0e7aa9d8ebdeeef7e0cf9b0ba015a00fa8b
Author: Joshua Hoblitt <josh@hoblitt.com>
Date:   Fri May 22 12:21:56 2015 -0700

    replace eups.productDir() calls with lsst.utils.getPackageDir()
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_16"><a name="tests/ticket1915.py"/></a>tests/ticket1915.py</h1>

<h3 id="toc_17">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConf
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
28   <a href="#1243ab04">1243ab04</a> - import eups</div>
                
                class Config1(pexConf.Config):
                    f = pexConf.Field("Config1.f", float, default=4)
                
                class Config2(pexConf.Config):
                    c = pexConf.ConfigField("Config2.c", Config1)
                
                class Config3(pexConf.Config):
                    r = pexConf.ConfigChoiceField("Config3.r", {"c1":Config1, "c2":Config2}, default="c1")
                
                class HistoryMergeTest(unittest.TestCase):
                    def test(self):
                        a = Config2()
                        b = Config2()
                        b.c.f = 3
                        b.c.f = 5
                        a.c=b.c
                
                        self.assertEqual([h[0] for h in a.c.history["f"]], [4, 5])
                
                        c = Config3()
                        c.r["c1"]=b.c
                        c.r["c2"]=a
                
                        self.assertEqual([h[0] for h in c.r["c1"].history["f"]], [4, 5])
                        self.assertEqual([h[0] for h in c.r["c2"].c.history["f"]], [4, 5])
                
                
                def  suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(HistoryMergeTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="1243ab04"/></a>1243ab04</h3>

<pre>
commit 1243ab04b2d6650c4daf7f0b939ca3fca2300c15
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Thu Feb 16 14:34:44 2012 -0800

    added test for ticket 1915
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_18"><a name="python/lsst/pex/config/history.py"/></a>python/lsst/pex/config/history.py</h1>

<h3 id="toc_19">Diff:</h3>

<pre>
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
                import os
                import re
                import sys
                
                #-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
                
                
                class Color(object):
                    categories = dict(
                        NAME = "blue",
                        VALUE = "yellow",
                        FILE = "green",
                        TEXT = "red",
                        FUNCTION_NAME = "blue",
                        )
                
                    colors = {
                        "black"  : 0,
                        "red"    : 1,
                        "green"  : 2,
                        "yellow" : 3,
                        "blue"   : 4,
                        "magenta": 5,
                        "cyan"   : 6,
                        "white"  : 7,
                        }
                
                    _colorize = True
                
                    def __init__(self, text, category):
                        """Return a string that should display as coloured on a conformant terminal"""
                        try:
                            color = Color.categories[category]
                        except KeyError:
                            raise RuntimeError("Unknown category: %s" % category)
                
                        self.rawText = str(text)
                        x = color.lower().split(";")
                        self.color, bold = x.pop(0), False
                        if x:
                            props = x.pop(0)
                            if props in ("bold",):
                                bold = True
                
                        try:
                            self._code = "%s" % (30 + Color.colors[self.color])
                        except KeyError:
                            raise RuntimeError("Unknown colour: %s" % self.color)
                
                        if bold:
                            self._code += ";1"
                
                    @staticmethod
                    def colorize(val=None):
                        """Should I colour strings?  With an argument, set the value"""
                
                        if val is not None:
                            Color._colorize = val
                
                            if isinstance(val, dict):
                                unknown = []
                                for k in val.keys():
                                    if Color.categories.has_key(k):
                                        if Color.colors.has_key(val[k]):
                                            Color.categories[k] = val[k]
                                        else:
                                            print >> sys.stderr, "Unknown colour %s for category %s" % (val[k], k)
                                    else:
                                        unknown.append(k)
                
                                if unknown:
                                    print >> sys.stderr, "Unknown colourizing category: %s" % " ".join(unknown)
                
                        return Color._colorize
                
                    def __str__(self):
                        if not self.colorize():
                            return self.rawText
                
                        base = "\033["
                
                        prefix = base + self._code + "m"
                        suffix = base + "m"
                
                        return prefix + self.rawText + suffix
                
                
                def _colorize(text, category):
                    text = Color(text, category)
                    return str(text)
                
                #-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
                
                class StackFrame(object):
                    def __init__(self, stackTrace):
                        self.fileName = stackTrace[0]
                        self.lineNumber = stackTrace[1]
                        self.functionName = stackTrace[2]
                        self.text = stackTrace[3]
                
                        self.fileName = re.sub(r'.*/python/lsst/', "", self.fileName)
                
                #-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
                
                def format(config, name=None, writeSourceLine=True, prefix="", verbose=False):
                    """Format the history record for config.name"""
                
                    if name is None:
                        for i, name in enumerate(config.history.keys()):
                            if i > 0:
                                print
                            print format(config, name)
                
                    outputs = []
                    for value, tb, label in config.history[name]:
                        output = []
                        for frame in [StackFrame(t) for t in tb]:
                            if frame.functionName in ("__new__", "__set__", "__setattr__", "execfile", "wrapper") or \
                                    os.path.split(frame.fileName)[1] in ("argparse.py", "argumentParser.py"):
                                if not verbose:
                                    continue
                
                            line = []
                            if writeSourceLine:
                                line.append(["%s" % ("%s:%d" % (frame.fileName, frame.lineNumber)), "FILE",])
                
                            line.append([frame.text, "TEXT",])
                            if False:
                                line.append([frame.functionName, "FUNCTION_NAME",])
                
                            output.append(line)
                
                        outputs.append([value, output])
                    #
                    # Find the maximum widths of the value and file:lineNo fields
                    #
                    if writeSourceLine:
                        sourceLengths = []
                        for value, output in outputs:
                            sourceLengths.append(max([len(x[0][0]) for x in output]))
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
163  <a href="#35760e23">35760e23</a> +         sourceLength = max(sourceLengths)</div>
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
164  <a href="#71ad20ef">71ad20ef</a> -     sourceLength = max(sourceLengths)</div>
                    valueLength = len(prefix) + max([len(str(value)) for value, output in outputs])
                    #
                    # actually generate the config history
                    #
                    msg = []
                    fullname = "%s.%s" %(config._name, name) if config._name is not None else name 
                    msg.append(_colorize(re.sub(r"^root\.", "", fullname), "NAME"))
                    for value, output in outputs:
                        line = prefix + _colorize("%-*s" % (valueLength, value), "VALUE") + " "
                        for i, vt in enumerate(output):
                            if writeSourceLine:
                                vt[0][0] = "%-*s" % (sourceLength, vt[0][0])
                            
                            output[i] = " ".join([_colorize(v, t) for v, t in vt])
                
                        line += ("\n%*s" % (valueLength + 1, "")).join(output)
                        msg.append(line)
                
                    return "\n".join(msg)
                
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="71ad20ef"/></a>71ad20ef</h3>

<pre>
commit 71ad20ef265259df357ea533b1a05d6047f3a673
Author: Robert Lupton the Good <rhl@astro.princeton.edu>
Date:   Sun Mar 4 14:38:12 2012 -0500

    Initial version
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="35760e23"/></a>35760e23</h3>

<pre>
commit 35760e23977d4ed9cef89a6919c3aec4175ada04
Author: Kian-Tat Lim <ktl@slac.stanford.edu>
Date:   Wed Jan 21 15:18:49 2015 -0600

    Only need sourceWidth when printing source lines.
    
    Includes test case based on one provided by the original reporter and
    flaw locator, Michael Reuter.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_20"><a name="python/lsst/pex/config/configChoiceField.py"/></a>python/lsst/pex/config/configChoiceField.py</h1>

<h3 id="toc_21">Diff:</h3>

<pre>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
1    <a href="#e318efec">e318efec</a> - # </div>
              ?  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
1    <a href="#8aaa1427">8aaa1427</a> + #</div>
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#e318efec">e318efec</a> - # </div>
              ?  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
4    <a href="#8aaa1427">8aaa1427</a> + #</div>
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
12   <a href="#e318efec">e318efec</a> - # </div>
              ?  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
12   <a href="#8aaa1427">8aaa1427</a> + #</div>
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
17   <a href="#e318efec">e318efec</a> - # </div>
              ?  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
17   <a href="#8aaa1427">8aaa1427</a> + #</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
18   <a href="#e318efec">e318efec</a> - # You should have received a copy of the LSST License Statement and </div>
              ?                                                                    -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
18   <a href="#8aaa1427">8aaa1427</a> + # You should have received a copy of the LSST License Statement and</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
19   <a href="#e318efec">e318efec</a> - # the GNU General Public License along with this program.  If not, </div>
              ?                                                                   -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
19   <a href="#8aaa1427">8aaa1427</a> + # the GNU General Public License along with this program.  If not,</div>
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import traceback, copy, collections
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
23   <a href="#8311b6b6">8311b6b6</a> - import sys</div>
                
                from .config import Config, Field, FieldValidationError, _typeStr, _joinNamePath
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
26   <a href="#86f891b3">86f891b3</a> - from .comparison import *</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
25   <a href="#8aaa1427">8aaa1427</a> + from .comparison import getComparisonName, compareScalars, compareConfigs</div>
                
                __all__ = ["ConfigChoiceField"]
                
                class SelectionSet(collections.MutableSet):
                    """
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#cde2242f">cde2242f</a> -     Custom set class used to track the selection of multi-select </div>
              ?                                                                 -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
31   <a href="#8aaa1427">8aaa1427</a> +     Custom set class used to track the selection of multi-select</div>
                    ConfigChoiceField.
                
                    This class allows user a multi-select ConfigChoiceField to add/discard
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#cde2242f">cde2242f</a> -     items from the set of active configs. Each change to the selection is </div>
              ?                                                                          -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#8aaa1427">8aaa1427</a> +     items from the set of active configs. Each change to the selection is</div>
                    tracked in the field's history.
                    """
                    def __init__(self, dict_, value, at=None, label="assignment", setHistory=True):
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                        self._dict = dict_;
                        self._field = self._dict._field
                        self._config = self._dict._config
                        self.__history = self._config._history.setdefault(self._field.name, [])
                        if value is not None:
                            try:
                                for v in value:
                                    if v not in self._dict:
                                        #invoke __getitem__ to ensure it's present
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#c3fa480a">c3fa480a</a> -                         r = self._dict.__getitem__(v, at=at)</div>
              ?                        ----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
50   <a href="#8aaa1427">8aaa1427</a> +                         self._dict.__getitem__(v, at=at)</div>
                            except TypeError:
                                msg = "Value %s is of incorrect type %s. Sequence type expected"(value, _typeStr(value))
                                raise FieldValidationError(self._field, self._config, msg)
                            self._set=set(value)
                        else:
                            self._set=set()
                
                        if setHistory:
                            self.__history.append(("Set selection to %s"%self, at, label))
                
                    def add(self, value, at= None):
                        if self._config._frozen:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#c3fa480a">c3fa480a</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Cannot modify a frozen Config")
                
                        if at is None:
                            at = traceback.extract_stack()[:-1]
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
69   <a href="#c3fa480a">c3fa480a</a> -         </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
68   <a href="#8aaa1427">8aaa1427</a> + </div>
                        if value not in self._dict:
                            #invoke __getitem__ to make sure it's present
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#c3fa480a">c3fa480a</a> -             r = self.__getitem__(value, at=at)</div>
              ?            ----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
71   <a href="#8aaa1427">8aaa1427</a> +             self._dict.__getitem__(value, at=at)</div>
              ?                 ++++++
                
                        self.__history.append(("added %s to selection"%value, at, "selection"))
                        self._set.add(value)
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#c3fa480a">c3fa480a</a> -     def discard(self, value, at=None): </div>
              ?                                       -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#8aaa1427">8aaa1427</a> +     def discard(self, value, at=None):</div>
                        if self._config._frozen:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#c3fa480a">c3fa480a</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Cannot modify a frozen Config")
                
                        if value not in self._dict:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#c3fa480a">c3fa480a</a> -             return </div>
              ?                   -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#8aaa1427">8aaa1427</a> +             return</div>
                
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                
                        self.__history.append(("removed %s from selection"%value, at, "selection"))
                        self._set.discard(value)
                
                    def __len__(self): return len(self._set)
                    def __iter__(self): return iter(self._set)
                    def __contains__(self, value): return value in self._set
                    def __repr__(self): return repr(list(self._set))
                    def __str__(self): return str(list(self._set))
                
                
                class ConfigInstanceDict(collections.Mapping):
                    """A dict of instantiated configs, used to populate a ConfigChoiceField.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
100  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
99   <a href="#8aaa1427">8aaa1427</a> + </div>
                    typemap must support the following:
                    - typemap[name]: return the config class associated with the given name
                    """
                    def __init__(self, config, field):
                        collections.Mapping.__init__(self)
                        self._dict = dict()
                        self._selection = None
                        self._config = config
                        self._field = field
                        self._history = config._history.setdefault(field.name, [])
                        self.__doc__ = field.doc
                
                    types = property(lambda x: x._field.typemap)
                
                    def __contains__(self, k): return k in self._field.typemap
                
                    def __len__(self): return len(self._field.typemap)
                
                    def __iter__(self): return iter(self._field.typemap)
                
                    def _setSelection(self,value, at=None, label="assignment"):
                        if self._config._frozen:
                            raise FieldValidationError(self._field, self._config, "Cannot modify a frozen Config")
                
                        if at is None:
                            at = traceback.extract_stack()[:-2]
                
                        if value is None:
                            self._selection=None
                        elif self._field.multi:
                            self._selection=SelectionSet(self, value, setHistory=False)
                        else:
                            if value not in self._dict:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
134  <a href="#51e260f5">51e260f5</a> -                 r = self.__getitem__(value, at=at) # just invoke __getitem__ to make sure it's present</div>
              ?                ----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
133  <a href="#8aaa1427">8aaa1427</a> +                 self.__getitem__(value, at=at) # just invoke __getitem__ to make sure it's present</div>
                            self._selection = value
                        self._history.append((value, at, label))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
137  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
136  <a href="#8aaa1427">8aaa1427</a> + </div>
                    def _getNames(self):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
139  <a href="#51e260f5">51e260f5</a> -         if not self._field.multi:            </div>
              ?                                  ------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
138  <a href="#8aaa1427">8aaa1427</a> +         if not self._field.multi:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
140  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
139  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Single-selection field has no attribute 'names'")
                        return self._selection
                    def _setNames(self, value):
                        if not self._field.multi:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
145  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
144  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Single-selection field has no attribute 'names'")
                        self._setSelection(value)
                    def _delNames(self):
                        if not self._field.multi:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
150  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
149  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Single-selection field has no attribute 'names'")
                        self._selection = None
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
153  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
152  <a href="#8aaa1427">8aaa1427</a> + </div>
                    def _getName(self):
                        if self._field.multi:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
156  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
155  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Multi-selection field has no attribute 'name'")
                        return self._selection
                    def _setName(self, value):
                        if self._field.multi:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
161  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
160  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Multi-selection field has no attribute 'name'")
                        self._setSelection(value)
                    def _delName(self):
                        if self._field.multi:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
166  <a href="#51e260f5">51e260f5</a> -             raise FieldValidationError(self._field, self._config, </div>
              ?                                                                  -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
165  <a href="#8aaa1427">8aaa1427</a> +             raise FieldValidationError(self._field, self._config,</div>
                                    "Multi-selection field has no attribute 'name'")
                        self._selection=None
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
169  <a href="#51e260f5">51e260f5</a> -    </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
168  <a href="#8aaa1427">8aaa1427</a> + </div>
                    """
                    In a multi-selection ConfigInstanceDict, list of names of active items
                    Disabled In a single-selection _Regsitry)
                    """
                    names = property(_getNames, _setNames, _delNames)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
175  <a href="#51e260f5">51e260f5</a> -    </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
174  <a href="#8aaa1427">8aaa1427</a> + </div>
                    """
                    In a single-selection ConfigInstanceDict, name of the active item
                    Disabled In a multi-selection _Regsitry)
                    """
                    name = property(_getName, _setName, _delName)
                
                    def _getActive(self):
                        if self._selection is None:
                            return None
                
                        if self._field.multi:
                            return [self[c] for c in self._selection]
                        else:
                            return self[self._selection]
                
                    """
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
192  <a href="#51e260f5">51e260f5</a> -     Readonly shortcut to access the selected item(s) </div>
              ?                                                     -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
191  <a href="#8aaa1427">8aaa1427</a> +     Readonly shortcut to access the selected item(s)</div>
                    for multi-selection, this is equivalent to: [self[name] for name in self.names]
                    for single-selection, this is equivalent to: self[name]
                    """
                    active = property(_getActive)
                
                    def __getitem__(self, k, at=None, label="default"):
                        try:
                            value = self._dict[k]
                        except KeyError:
                            try:
                                dtype = self._field.typemap[k]
                            except:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
205  <a href="#51e260f5">51e260f5</a> -                 raise FieldValidationError(self._field, self._config, "Unknown key %r"%k)</div>
              ?                                                                      --------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
204  <a href="#594b18d3">594b18d3</a> +                 raise FieldValidationError(self._field, self._config,</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
205  <a href="#594b18d3">594b18d3</a> +                                            "Unknown key %r in Registry/ConfigChoiceField" % k)</div>
                            name = _joinNamePath(self._config._name, self._field.name, k)
                            if at is None:
                                at = traceback.extract_stack()[:-1] + [dtype._source]
                            value = self._dict.setdefault(k, dtype(__name=name, __at=at, __label=label))
                        return value
                
                    def __setitem__(self, k, value, at=None, label="assignment"):
                        if self._config._frozen:
                            raise FieldValidationError(self._field, self._config, "Cannot modify a frozen Config")
                
                        try:
                            dtype = self._field.typemap[k]
                        except:
                            raise FieldValidationError(self._field, self._config, "Unknown key %r"%k)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
220  <a href="#51e260f5">51e260f5</a> -         </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
220  <a href="#8aaa1427">8aaa1427</a> + </div>
                        if value != dtype and type(value) != dtype:
                            msg = "Value %s at key %k is of incorrect type %s. Expected type %s"%\
                                    (value, k, _typeStr(value), _typeStr(dtype))
                            raise FieldValidationError(self._field, self._config, msg)
                
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                        name = _joinNamePath(self._config._name, self._field.name, k)
                        oldValue = self._dict.get(k, None)
                        if oldValue is None:
                            if value == dtype:
                                self._dict[k] = value(__name=name, __at=at, __label=label)
                            else:
                                self._dict[k] = dtype(__name=name, __at=at, __label=label, **value._storage)
                        else:
                            if value == dtype:
                                value = value()
                            oldValue.update(__at=at, __label=label, **value._storage)
                
                    def _rename(self, fullname):
                        for k, v in self._dict.iteritems():
                            v._rename(_joinNamePath(name=fullname, index=k))
                
                    def __setattr__(self, attr, value, at=None, label="assignment"):
                        if hasattr(getattr(self.__class__, attr, None), '__set__'):
                            # This allows properties to work.
                            object.__setattr__(self, attr, value)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
248  <a href="#70e01815">70e01815</a> -         elif attr in self.__dict__ or attr in ["_history", "_field", "_config", "_dict", "_selection", "__doc__"]:</div>
              ?                                                                                         --------------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
248  <a href="#8aaa1427">8aaa1427</a> +         elif attr in self.__dict__ or attr in ["_history", "_field", "_config", "_dict",</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
249  <a href="#8aaa1427">8aaa1427</a> +                                                "_selection", "__doc__"]:</div>
                            # This allows specific private attributes to work.
                            object.__setattr__(self, attr, value)
                        else:
                            # We throw everything else.
                            msg = "%s has no attribute %s"%(_typeStr(self._field), attr)
                            raise FieldValidationError(self._field, self._config, msg)
                
                
                
                
                class ConfigChoiceField(Field):
                    """
                    ConfigChoiceFields allow the config to choose from a set of possible Config types.
                    The set of allowable types is given by the typemap argument to the constructor
                
                    The typemap object must implement typemap[name], which must return a Config subclass.
                
                    While the typemap is shared by all instances of the field, each instance of
                    the field has its own instance of a particular sub-config type
                
                    For example:
                
                      class AaaConfig(Config):
                        somefield = Field(int, "...")
                      TYPEMAP = {"A", AaaConfig}
                      class MyConfig(Config):
                          choice = ConfigChoiceField("doc for choice", TYPEMAP)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
276  <a href="#51e260f5">51e260f5</a> -       </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
277  <a href="#8aaa1427">8aaa1427</a> + </div>
                      instance = MyConfig()
                      instance.choice['AAA'].somefield = 5
                      instance.choice = "AAA"
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
280  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
281  <a href="#8aaa1427">8aaa1427</a> + </div>
                    Alternatively, the last line can be written:
                      instance.choice.name = "AAA"
                
                    Validation of this field is performed only the "active" selection.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
285  <a href="#51e260f5">51e260f5</a> -     If active is None and the field is not optional, validation will fail. </div>
              ?                                                                           -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
286  <a href="#8aaa1427">8aaa1427</a> +     If active is None and the field is not optional, validation will fail.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
286  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
287  <a href="#8aaa1427">8aaa1427</a> + </div>
                    ConfigChoiceFields can allow single selections or multiple selections.
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
288  <a href="#51e260f5">51e260f5</a> -     Single selection fields set selection through property name, and </div>
              ?                                                                     -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
289  <a href="#8aaa1427">8aaa1427</a> +     Single selection fields set selection through property name, and</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
289  <a href="#51e260f5">51e260f5</a> -     multi-selection fields use the property names. </div>
              ?                                                   -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
290  <a href="#8aaa1427">8aaa1427</a> +     multi-selection fields use the property names.</div>
                
                    ConfigChoiceFields also allow multiple values of the same type:
                      TYPEMAP["CCC"] = AaaConfig
                      TYPEMAP["BBB"] = AaaConfig
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
295  <a href="#51e260f5">51e260f5</a> -     When saving a config with a ConfigChoiceField, the entire set is saved, as well as the active selection    </div>
              ?                                                                                                            ----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
296  <a href="#8aaa1427">8aaa1427</a> +     When saving a config with a ConfigChoiceField, the entire set is saved, as well as the active selection</div>
                    """
                    instanceDictClass = ConfigInstanceDict
                    def __init__(self, doc, typemap, default=None, optional=False, multi=False):
                        source = traceback.extract_stack(limit=2)[0]
                        self._setup( doc=doc, dtype=self.instanceDictClass, default=default, check=None, optional=optional, source=source)
                        self.typemap = typemap
                        self.multi = multi
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
303  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
304  <a href="#8aaa1427">8aaa1427</a> + </div>
                    def _getOrMake(self, instance, label="default"):
                        instanceDict = instance._storage.get(self.name)
                        if instanceDict is None:
                            at = traceback.extract_stack()[:-2]
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
308  <a href="#51e260f5">51e260f5</a> -             name = _joinNamePath(instance._name, self.name)</div>
                            instanceDict = self.dtype(instance, self)
                            instanceDict.__doc__ = self.doc
                            instance._storage[self.name] = instanceDict
                            history = instance._history.setdefault(self.name, [])
                            history.append(("Initialized from defaults", at, label))
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
314  <a href="#51e260f5">51e260f5</a> -         </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
314  <a href="#8aaa1427">8aaa1427</a> + </div>
                        return instanceDict
                
                    def __get__(self, instance, owner=None):
                        if instance is None or not isinstance(instance, Config):
                            return self
                        else:
                            return self._getOrMake(instance)
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
323  <a href="#51e260f5">51e260f5</a> -     def __set__(self, instance, value, at=None, label="assignment"):       </div>
              ?                                                                     -------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
323  <a href="#8aaa1427">8aaa1427</a> +     def __set__(self, instance, value, at=None, label="assignment"):</div>
                        if instance._frozen:
                            raise FieldValidationError(self, instance, "Cannot modify a frozen Config")
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
326  <a href="#51e260f5">51e260f5</a> -         if at is None: </div>
              ?                       -
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
326  <a href="#8aaa1427">8aaa1427</a> +         if at is None:</div>
                            at = traceback.extract_stack()[:-1]
                        instanceDict = self._getOrMake(instance)
                        if isinstance(value, self.instanceDictClass):
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
330  <a href="#51e260f5">51e260f5</a> -             for k,v  in value.iteritems():                    </div>
              ?                                           --------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
330  <a href="#8aaa1427">8aaa1427</a> +             for k,v  in value.iteritems():</div>
                                instanceDict.__setitem__(k, v, at=at, label=label)
                            instanceDict._setSelection(value._selection, at=at, label=label)
                
                        else:
                            instanceDict._setSelection(value, at=at, label=label)
                
                    def rename(self, instance):
                        instanceDict = self.__get__(instance)
                        fullname = _joinNamePath(instance._name, self.name)
                        instanceDict._rename(fullname)
                
                    def validate(self, instance):
                        instanceDict = self.__get__(instance)
                        if instanceDict.active is None and not self.optional:
                            msg = "Required field cannot be None"
                            raise FieldValidationError(self, instance, msg)
                        elif instanceDict.active is not None:
                            if self.multi:
                                for a in instanceDict.active:
                                    a.validate()
                            else:
                                instanceDict.active.validate()
                
                    def toDict(self, instance):
                        instanceDict = self.__get__(instance)
                
                        dict_ = {}
                        if self.multi:
                            dict_["names"]=instanceDict.names
                        else:
                            dict_["name"] =instanceDict.name
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
362  <a href="#51e260f5">51e260f5</a> -         </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
362  <a href="#8aaa1427">8aaa1427</a> + </div>
                        values = {}
                        for k, v in instanceDict.iteritems():
                            values[k]=v.toDict()
                        dict_["values"]=values
                
                        return dict_
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
369  <a href="#51e260f5">51e260f5</a> -     </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
369  <a href="#8aaa1427">8aaa1427</a> + </div>
                    def freeze(self, instance):
                        instanceDict = self.__get__(instance)
                        for v in instanceDict.itervalues():
                            v.freeze()
                
                    def save(self, outfile, instance):
                        instanceDict = self.__get__(instance)
                        fullname = _joinNamePath(instance._name, self.name)
                        for v in instanceDict.itervalues():
                            v._save(outfile)
                        if self.multi:
                            print >> outfile, "%s.names=%r"%(fullname, instanceDict.names)
                        else:
                            print >> outfile, "%s.name=%r"%(fullname, instanceDict.name)
                
                    def __deepcopy__(self, memo):
                        """Customize deep-copying, because we always want a reference to the original typemap.
                
                        WARNING: this must be overridden by subclasses if they change the constructor signature!
                        """
                        other = type(self)(doc=self.doc, typemap=self.typemap, default=copy.deepcopy(self.default),
                                          optional=self.optional, multi=self.multi)
                        other.source = self.source
                        return other
                
                    def _compare(self, instance1, instance2, shortcut, rtol, atol, output):
                        """Helper function for Config.compare; used to compare two fields for equality.
                
                        Only the selected config(s) are compared, as the parameters of any others do not matter.
                
                        @param[in] instance1  LHS Config instance to compare.
                        @param[in] instance2  RHS Config instance to compare.
                        @param[in] shortcut   If True, return as soon as an inequality is found.
                        @param[in] rtol       Relative tolerance for floating point comparisons.
                        @param[in] atol       Absolute tolerance for floating point comparisons.
                        @param[in] output     If not None, a callable that takes a string, used (possibly repeatedly)
                                              to report inequalities.
                
                        Floating point comparisons are performed by numpy.allclose; refer to that for details.
                        """
                        d1 = getattr(instance1, self.name)
                        d2 = getattr(instance2, self.name)
                        name = getComparisonName(
                            _joinNamePath(instance1._name, self.name),
                            _joinNamePath(instance2._name, self.name)
                            )
                        if not compareScalars("selection for %s" % name, d1._selection, d2._selection, output=output):
                            return False
                        if d1._selection is None:
                            return True
                        if self.multi:
                            nested = [(k, d1[k], d2[k]) for k in d1._selection]
                        else:
                            nested = [(d1._selection, d1[d1._selection], d2[d1._selection])]
                        equal = True
                        for k, c1, c2 in nested:
                            result = compareConfigs("%s[%r]" % (name, k), c1, c2, shortcut=shortcut,
                                                    rtol=rtol, atol=atol, output=output)
                            if not result and shortcut:
                                return False
                            equal = equal and result
                        return equal
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="51e260f5"/></a>51e260f5</h3>

<pre>
commit 51e260f5df8d3b26e4733e447d71db407f1c26f5
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Apr 3 09:13:49 2012 -0700

    Moved Filed implementations into their own files to improve
    readability and maintainability of the library.
</pre>
<h3><a name="86f891b3"/></a>86f891b3</h3>

<pre>
commit 86f891b3a07f0fc944b70a0cd6743c5d4e799330
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Mar 13 20:11:50 2013 -0400

    Add detailed comparisons with diff reporting.
</pre>
<h3><a name="e318efec"/></a>e318efec</h3>

<pre>
commit e318efec3fb7d78f9cd59c4329752fc91da28c1e
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue May 8 18:23:19 2012 -0700

    Added copyright headers to all python files.
    Modified ListField and DictField to clean up validation, make both the
    field and internal container classes more useful as base classes.
    Modified ConfigDictField to be derived from DictField.
    Modified ConfigDict to derive from Dict
</pre>
<h3><a name="70e01815"/></a>70e01815</h3>

<pre>
commit 70e0181531642e6fc7e659700232202f97104931
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue May 29 15:18:10 2012 -0700

    Added method __setattr__ to ConfigInstanceDict and RegistryInstanceDict
    in order to prevent users from adding arbitrary attributes to
    ConfigChoicefield and RegistryField respectively
</pre>
<h3><a name="c3fa480a"/></a>c3fa480a</h3>

<pre>
commit c3fa480a7b4cd46201215f5120f5536b9997ce7a
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Jul 17 16:28:32 2012 -0700

    Created a custom set class for use by multi-selection ConfigChoiceFields and
    RegistryFields. Basic unittest in tests/ticket2226.py
</pre>
<h3><a name="cde2242f"/></a>cde2242f</h3>

<pre>
commit cde2242ffc0dc78c9dfd62a0046b5f0d91b8d213
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Thu Jul 26 10:43:18 2012 -0700

    Added a docstring to SelectionSet
</pre>
<h3><a name="8311b6b6"/></a>8311b6b6</h3>

<pre>
commit 8311b6b63a3d365e5e520022a202367a5d4bbbc4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Mar 13 20:15:20 2013 -0400

    Reorder imports and add GPL notice as per standards.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="8aaa1427"/></a>8aaa1427</h3>

<pre>
commit 8aaa1427b240fd33865558facec57af39577e730
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Dec 22 10:47:09 2014 -0500

    Minor cleanups for configChoiceField.py (unused variables, whitespace)
</pre>
<h3><a name="594b18d3"/></a>594b18d3</h3>

<pre>
commit 594b18d3bda2f7d007b95c32337691c1d3c25413
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Dec 22 10:47:58 2014 -0500

    Improve error message for unknown key in RegistryField
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_22"><a name="tests/wrap.py"/></a>tests/wrap.py</h1>

<h3 id="toc_23">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import io
                import re
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConfig
                import sys
                import pickle
                
                import testLib
                
                class WrapTest(unittest.TestCase):
                
                    def testMakeControl(self):
                        """Test making a C++ Control object from a Config object."""
                        config = testLib.ConfigObject()
                        config.foo = 2
                        config.bar.append("baz")
                        control = config.makeControl()
                        self.assert_(testLib.checkControl(control, config.foo, config.bar))
                
                    def testReadControl(self):
                        """Test reading the values from a C++ Control object into a Config object."""
                        vec = testLib.StringVec()
                        vec.push_back("zot")
                        vec.push_back("yox")
                        control = testLib.ControlObject()
                        control.foo = 3
                        control.bar = vec
                        config = testLib.ConfigObject()
                        config.readControl(control)
                        self.assert_(testLib.checkControl(control, config.foo, config.bar))
                
                    def testDefaults(self):
                        """Test that C++ Control object defaults are correctly used as defaults for Config objects."""
                        config = testLib.ConfigObject()
                        control = testLib.ControlObject()
                        self.assert_(testLib.checkControl(control, config.foo, config.bar))
                
                class NestedWrapTest(unittest.TestCase):
                
                    def testMakeControl(self):
                        """Test making a C++ Control object from a Config object."""
                        config = testLib.OuterConfigObject()
                        self.assert_(isinstance(config.a, testLib.InnerConfigObject))
                        config.a.p = 5.0
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
70   <a href="#f07a1fed">f07a1fed</a> +         config.a.q = 7</div>
                        config.b = 2
                        control = config.makeControl()
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#f3d1f8eb">f3d1f8eb</a> -         self.assert_(testLib.checkNestedControl(control, config.a.p, config.b))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
73   <a href="#f07a1fed">f07a1fed</a> +         self.assert_(testLib.checkNestedControl(control, config.a.p, config.a.q, config.b))</div>
              ?                                                                      ++++++++++++
                
                    def testReadControl(self):
                        """Test reading the values from a C++ Control object into a Config object."""
                        control = testLib.OuterControlObject()
                        control.a.p = 6.0
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#f07a1fed">f07a1fed</a> +         control.a.q = 4</div>
                        control.b = 3
                        config = testLib.OuterConfigObject()
                        config.readControl(control)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#f3d1f8eb">f3d1f8eb</a> -         self.assert_(testLib.checkNestedControl(control, config.a.p, config.b))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#f07a1fed">f07a1fed</a> +         self.assert_(testLib.checkNestedControl(control, config.a.p, config.a.q, config.b))</div>
              ?                                                                      ++++++++++++
                
                    def testDefaults(self):
                        """Test that C++ Control object defaults are correctly used as defaults for Config objects."""
                        config = testLib.OuterConfigObject()
                        control = testLib.OuterControlObject()
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#f3d1f8eb">f3d1f8eb</a> -         self.assert_(testLib.checkNestedControl(control, config.a.p, config.b))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
89   <a href="#f07a1fed">f07a1fed</a> +         self.assert_(testLib.checkNestedControl(control, config.a.p, config.a.q, config.b))</div>
              ?                                                                      ++++++++++++
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
90   <a href="#f3d1f8eb">f3d1f8eb</a> + </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#f98a74e2">f98a74e2</a> +     def testInt64(self):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
92   <a href="#f98a74e2">f98a74e2</a> +         """Test that we can wrap C++ Control objects with int64 members."""</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
93   <a href="#f98a74e2">f98a74e2</a> +         config = testLib.OuterConfigObject()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
94   <a href="#f98a74e2">f98a74e2</a> +         control = testLib.OuterControlObject()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
95   <a href="#f98a74e2">f98a74e2</a> +         self.assert_(testLib.checkNestedControl(control, config.a.p, config.a.q, config.b))</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
96   <a href="#f98a74e2">f98a74e2</a> +         self.assertGreater(config.a.q, 1 << 30)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
97   <a href="#f98a74e2">f98a74e2</a> +         self.assertGreater(control.a.q, 1 << 30)</div>
                
                def suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(WrapTest)
                    suites += unittest.makeSuite(NestedWrapTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="f3d1f8eb"/></a>f3d1f8eb</h3>

<pre>
commit f3d1f8eb62763d26d21b33772364901b90aa4253
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Sep 18 17:23:50 2012 -0400

    Add support for nested control objects to wrap mechanism (#2038).
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="f07a1fed"/></a>f07a1fed</h3>

<pre>
commit f07a1fed5c0bdf5dd1accbfd478d86e2898214b4
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu May 15 09:07:31 2014 -0400

    Add tests for nested control defaults bug
</pre>
<h3><a name="f98a74e2"/></a>f98a74e2</h3>

<pre>
commit f98a74e28adac5bf5c68b6bd9286d1d10196d444
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue May 20 15:51:02 2014 -0400

    Modify unit tests to check behavior of wrapped int64_t.
</pre>
<h3><a name="f3d1f8eb"/></a>f3d1f8eb</h3>

<pre>
commit f3d1f8eb62763d26d21b33772364901b90aa4253
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Sep 18 17:23:50 2012 -0400

    Add support for nested control objects to wrap mechanism (#2038).
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_24"><a name="tests/dictField.py"/></a>tests/dictField.py</h1>

<h3 id="toc_25">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConfig
                
                class Config1(pexConfig.Config):
                    d1 = pexConfig.DictField("d1", keytype=str, itemtype=int, default={"hi":4}, itemCheck=lambda x: x > 0)
                    d2 = pexConfig.DictField("d2", keytype=str, itemtype=str, default=None)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#52c005d7">52c005d7</a> -     d3 = pexConfig.DictField("d1", keytype=float, itemtype=float, optional = True, itemCheck=lambda x: x > 0)</div>
              ?                                ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#252603e0">252603e0</a> +     d3 = pexConfig.DictField("d3", keytype=float, itemtype=float, optional = True, itemCheck=lambda x: x > 0)</div>
              ?                                ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
33   <a href="#252603e0">252603e0</a> +     d4 = pexConfig.DictField("d4", keytype=str, itemtype=None, default={})</div>
                
                class DictFieldTest(unittest.TestCase):
                    def testConstructor(self):
                        try:
                            class BadKeytype(pexConfig.Config):
                                d = pexConfig.DictField("...", keytype=list, itemtype=int)
                        except:
                            pass
                        else:
                            raise SyntaxError("Unsupported keyptype DictFields should not be allowed")
                
                        try:
                            class BadItemtype(pexConfig.Config):
                                d = pexConfig.DictField("...", keytype=int, itemtype=dict)
                        except:
                            pass
                        else:
                            raise SyntaxError("Unsupported itemtype DictFields should not be allowed")
                       
                        try:
                            class BadItemCheck(pexConfig.Config):
                                d = pexConfig.DictField("...", keytype=int, itemtype=int, itemCheck=4)
                        except:
                            pass
                        else:
                            raise SyntaxError("Non-callable itemCheck DictFields should not be allowed")
                        
                        try:
                            class BadDictCheck(pexConfig.Config):
                                d = pexConfig.DictField("...", keytype=int, itemtype=int, dictCheck=4)
                        except:
                            pass
                        else:
                            raise SyntaxError("Non-callable dictCheck DictFields should not be allowed")
                
                    def testAssignment(self):
                        c = Config1()
                        self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d1", {3:3})
                        self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d1", {"a":0})
                        self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d1", [1.2, 3, 4])
                        c.d1 = None; c.d1 = {"a":1, "b":2}
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#ab6dd5fd">ab6dd5fd</a> -        </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
75   <a href="#52c005d7">52c005d7</a> -         self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d3", {"hi", True})</div>
              ?                                                                                  ^
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
75   <a href="#252603e0">252603e0</a> +         self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d3", {"hi": True})</div>
              ?                                                                                  ^
                        c.d3={4:5}
                        self.assertEqual(c.d3, {4.:5.})
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#ab6dd5fd">ab6dd5fd</a> -        </div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#252603e0">252603e0</a> +         d = {"a": None, "b": 4, "c": "foo"}</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#252603e0">252603e0</a> +         c.d4 = d</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#252603e0">252603e0</a> +         self.assertEqual(c.d4, d)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#252603e0">252603e0</a> +         c.d4["a"] = 12</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#252603e0">252603e0</a> +         c.d4["b"] = "three"</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#252603e0">252603e0</a> +         c.d4["c"] = None</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#252603e0">252603e0</a> +         self.assertEqual(c.d4["a"], 12)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
85   <a href="#252603e0">252603e0</a> +         self.assertEqual(c.d4["b"], "three")</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#252603e0">252603e0</a> +         self.assertEqual(c.d4["c"], None)</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#252603e0">252603e0</a> +         self.assertRaises(pexConfig.FieldValidationError, setattr, c, "d4", {"hi": [1, 2, 3]})</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#252603e0">252603e0</a> + </div>
                    def testValidate(self):
                        c = Config1()
                        self.assertRaises(pexConfig.FieldValidationError, Config1.validate, c)
                
                        c.d2 = {"a":"b"}
                        c.validate()
                
                    def testInPlaceModification(self):
                        c= Config1()
                        self.assertRaises(pexConfig.FieldValidationError, c.d1.__setitem__, 2, 0)
                        self.assertRaises(pexConfig.FieldValidationError, c.d1.__setitem__, "hi", 0)
                        c.d1["hi"]=10
                        self.assertEqual(c.d1, {"hi":10})
                
                        c.d3={}
                        c.d3[4]=5
                        self.assertEqual(c.d3, {4.:5.})
                
                    def testNoArbitraryAttributes(self):
                        c= Config1()
                        self.assertRaises(pexConfig.FieldValidationError, setattr, c.d1, "should", "fail")
                
                def  suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(DictFieldTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="52c005d7"/></a>52c005d7</h3>

<pre>
commit 52c005d7492ef1d8a29c8a13e413f5bd1236c88d
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Jul 17 10:43:13 2012 -0700

    Added tests to ListField, DictField, ConfigDictField checking for
    illegal attributes
</pre>
<h3><a name="ab6dd5fd"/></a>ab6dd5fd</h3>

<pre>
commit ab6dd5fdc33e4925a097f364d47a1ed617d34b49
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Fri Mar 9 11:46:26 2012 -0800

    improved tests for dict/list field
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="252603e0"/></a>252603e0</h3>

<pre>
commit 252603e05a099b1d564c5317a5c99ac579d85e39
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Wed Jan 7 13:48:37 2015 -0500

    Add support for DictFields with dynamic itemtypes
    
    Passing itemtype=None now allows any of the supported itemtypes
    (as well as None) to be used in the same DictField.
    
    Also fixed some very minor problems in the test code for DictField.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_26"><a name="tests/registry.py"/></a>tests/registry.py</h1>

<h3 id="toc_27">Diff:</h3>

<pre>
                #!/usr/bin/env python
                
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                import os
                import unittest
                import lsst.utils.tests as utilsTests
                import lsst.pex.config as pexConfig
                
                class ConfigTest(unittest.TestCase):
                    def setUp(self):
                        """Note: the classes are defined here in order to test the register decorator
                        """
                        class ParentConfig(pexConfig.Config):
                            pass
                        
                        self.registry = pexConfig.makeRegistry(doc="unit test configs", configBaseType=ParentConfig)
                        
                        class FooConfig1(ParentConfig):
                            pass
                        self.fooConfig1Class = FooConfig1
                        
                        class FooConfig2(ParentConfig):
                            pass
                        self.fooConfig2Class = FooConfig2
                
                        class Config1(pexConfig.Config):
                            pass
                        self.config1Class = Config1
                        
                        class Config2(pexConfig.Config):
                            pass
                        self.config2Class = Config2
                        
                        @pexConfig.registerConfigurable("foo1", self.registry)
                        class FooAlg1(object):
                            ConfigClass = FooConfig1
                            def __init__(self, config):
                                self.config = config
                            def foo(self):
                                pass
                        self.fooAlg1Class = FooAlg1
                        
                        class FooAlg2(object):
                            ConfigClass = FooConfig2
                            def __init__(self, config):
                                self.config = config
                            def foo(self):
                                pass
                        self.registry.register("foo2", FooAlg2, FooConfig2)
                        self.fooAlg2Class = FooAlg2
                        
                        # override Foo2 with FooConfig1
                        self.registry.register("foo21", FooAlg2, FooConfig1)
                    
                    def tearDown(self):
                        del self.registry
                        del self.fooConfig1Class
                        del self.fooConfig2Class
                        del self.fooAlg1Class
                        del self.fooAlg2Class
                        
                    def testBasics(self):
                        self.assertEqual(self.registry["foo1"], self.fooAlg1Class)
                        self.assertEqual(self.registry["foo2"].ConfigClass, self.fooConfig2Class)
                        self.assertEqual(self.registry["foo21"].ConfigClass, self.fooConfig1Class)
                
                        self.assertEqual(set(self.registry.keys()), set(("foo1", "foo2", "foo21")))
                
                    def testWrapper(self):
                        wrapper21 = self.registry["foo21"]
                        foo21 = wrapper21(wrapper21.ConfigClass())
                        self.assertTrue(isinstance(foo21, self.fooAlg2Class))
                        
                    def testReplace(self):
                        """Test replacement in registry (should always fail)
                        """
                        self.assertRaises(Exception, self.registry.register, "foo1", self.fooAlg2Class)
                        self.assertEqual(self.registry["foo1"], self.fooAlg1Class)
                
                    def testNesting(self):
                        """Make sure nesting a config with a RegistryField doesn't deep-copy the registry."""
                        class MidConfig(pexConfig.Config):
                            field = self.registry.makeField("docs for registry field")
                        class TopConfig(pexConfig.Config):
                            middle = pexConfig.ConfigField(dtype=MidConfig, doc="docs for middle")
                        self.assert_(MidConfig.field.registry is self.registry)
                        middle = MidConfig()
                        top = TopConfig()
                        self.assert_(middle.field.registry is self.registry)
                        self.assert_(top.middle.field.registry is self.registry)
                
                    def testRegistryField(self):
                        class C1(pexConfig.Config):
                            r = self.registry.makeField("registry field")
                
                        for t in C1.r.typemap:
                            self.assertEqual(C1.r.typemap[t], self.registry[t].ConfigClass)
                
                        c=  C1()
                        c.r = "foo2"
                        c.r.apply()
                
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
123  <a href="#4e802877">4e802877</a> +     def testExceptions(self):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
124  <a href="#4e802877">4e802877</a> +         class C1(pexConfig.Config):</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
125  <a href="#4e802877">4e802877</a> +             r = self.registry.makeField("registry field", multi=True, default=[])</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
126  <a href="#4e802877">4e802877</a> +         c = C1()</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
127  <a href="#4e802877">4e802877</a> +         def fail(name): # lambda doesn't like |=</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
128  <a href="#4e802877">4e802877</a> +             c.r.names |= [name]</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
129  <a href="#4e802877">4e802877</a> +         self.assertRaises(pexConfig.FieldValidationError, fail, "bar")</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
130  <a href="#4e802877">4e802877</a> + </div>
                def  suite():
                    utilsTests.init()
                    suites = []
                    suites += unittest.makeSuite(ConfigTest)
                    suites += unittest.makeSuite(utilsTests.MemoryTestCase)
                    return unittest.TestSuite(suites)
                
                def run(exit=False):
                    utilsTests.run(suite(), exit)
                
                if __name__=='__main__':
                    run(True)
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="4e802877"/></a>4e802877</h3>

<pre>
commit 4e8028773f2a9814e9491235b068f482ac60e49b
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Mon Dec 15 13:00:08 2014 -0500

    Fix confusing error message in multi-select RegistryFields
    
    Adding an unknown string to .names previously triggered a
    confusing error, because the code intended to handle that error
    invoked SelectionSet.__getitem__ (which doesn't exist) instead of
    ConfigChoiceDict.__getitem__.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<h1 id="toc_28"><a name="python/lsst/pex/config/config.py"/></a>python/lsst/pex/config/config.py</h1>

<h3 id="toc_29">Diff:</h3>

<pre>
                # 
                # LSST Data Management System
                # Copyright 2008, 2009, 2010 LSST Corporation.
                # 
                # This product includes software developed by the
                # LSST Project (http://www.lsst.org/).
                #
                # This program is free software: you can redistribute it and/or modify
                # it under the terms of the GNU General Public License as published by
                # the Free Software Foundation, either version 3 of the License, or
                # (at your option) any later version.
                # 
                # This program is distributed in the hope that it will be useful,
                # but WITHOUT ANY WARRANTY; without even the implied warranty of
                # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                # GNU General Public License for more details.
                # 
                # You should have received a copy of the LSST License Statement and 
                # the GNU General Public License along with this program.  If not, 
                # see <http://www.lsstcorp.org/LegalNotices/>.
                #
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
23   <a href="#6e44b4e3">6e44b4e3</a> - import os</div>
                import io
                import traceback
                import sys
                import math
                import collections
                import copy
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
30   <a href="#4b64922b">4b64922b</a> - import re</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
31   <a href="#6e44b4e3">6e44b4e3</a> - import tempfile</div>
                
                from .comparison import *
                
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
35   <a href="#4b64922b">4b64922b</a> - __all__ = ("Config", "Field", "FieldValidationError", "load", "loadFromStream")</div>
              ?                                                     --------------------------
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
32   <a href="#fa70d1d6">fa70d1d6</a> + __all__ = ("Config", "Field", "FieldValidationError")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
36   <a href="#4b64922b">4b64922b</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
37   <a href="#4b64922b">4b64922b</a> - def guessClassFromStream(stream):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
38   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
39   <a href="#4b64922b">4b64922b</a> -     Attempt to guess the correct config class from a saved config stream.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
40   <a href="#4b64922b">4b64922b</a> -     </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
41   <a href="#4b64922b">4b64922b</a> -     This looks for a line of the form:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
42   <a href="#4b64922b">4b64922b</a> -     @code</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
43   <a href="#4b64922b">4b64922b</a> -     assert(type(root)==<module.class>)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
44   <a href="#4b64922b">4b64922b</a> -     @endcode</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
45   <a href="#4b64922b">4b64922b</a> -     If it finds such a line, it tries to import the module, and returns</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
46   <a href="#4b64922b">4b64922b</a> -     the class if successful.  Returns None on failure.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
47   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
48   <a href="#4b64922b">4b64922b</a> -     try:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
49   <a href="#e6345afc">e6345afc</a> -         regex = re.compile("assert\s*\(?type\(\w+\)\s*==\s*(?P<cls>[\w\.]+)\)?")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
50   <a href="#4b64922b">4b64922b</a> -         for line in stream:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
51   <a href="#4b64922b">4b64922b</a> -             m = regex.search(line)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
52   <a href="#4b64922b">4b64922b</a> -             if m:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
53   <a href="#4b64922b">4b64922b</a> -                 s = m.group("cls").split(".")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
54   <a href="#4b64922b">4b64922b</a> -                 module = __import__(".".join(s[:-1]), globals(), locals(), [s[-1]], -1)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
55   <a href="#4b64922b">4b64922b</a> -                 cls = getattr(module, s[-1])</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
56   <a href="#4b64922b">4b64922b</a> -                 return cls</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#4b64922b">4b64922b</a> -         return None</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#4b64922b">4b64922b</a> -     except (ImportError, AttributeError):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
59   <a href="#4b64922b">4b64922b</a> -         return None</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
60   <a href="#4b64922b">4b64922b</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
61   <a href="#4b64922b">4b64922b</a> - def guessClass(filename):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
62   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
63   <a href="#4b64922b">4b64922b</a> -     Attempt to guess the correct config class from a saved config file.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
64   <a href="#4b64922b">4b64922b</a> -     </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
65   <a href="#4b64922b">4b64922b</a> -     This looks for a line of the form:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
66   <a href="#4b64922b">4b64922b</a> -     @code</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
67   <a href="#4b64922b">4b64922b</a> -     assert(type(root)==<module.class>)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
68   <a href="#4b64922b">4b64922b</a> -     @endcode</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
69   <a href="#4b64922b">4b64922b</a> -     If it finds such a line, it tries to import the module, and returns</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
70   <a href="#4b64922b">4b64922b</a> -     the class if successful.  Returns None on failure.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
71   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
72   <a href="#4b64922b">4b64922b</a> -     with open(filename, 'r') as stream:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
73   <a href="#4b64922b">4b64922b</a> -         return guessClassFromStream(stream)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
74   <a href="#4b64922b">4b64922b</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
75   <a href="#4b64922b">4b64922b</a> - def loadFromStream(stream, root="root"):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
76   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
77   <a href="#4b64922b">4b64922b</a> -     Load a config object from a stream, using guessClassFromStream to determine the class.</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
78   <a href="#4b64922b">4b64922b</a> -     """</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
79   <a href="#4b64922b">4b64922b</a> -     cls = guessClassFromStream(stream)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
80   <a href="#4b64922b">4b64922b</a> -     if cls is None:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
81   <a href="#4b64922b">4b64922b</a> -         raise RuntimeError("Cannot infer config class name from stream.")</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
82   <a href="#4b64922b">4b64922b</a> -     config = cls()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
83   <a href="#4b64922b">4b64922b</a> -     config.loadFromStream(stream, root=root)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
84   <a href="#4b64922b">4b64922b</a> -     return config</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
85   <a href="#4b64922b">4b64922b</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
86   <a href="#4b64922b">4b64922b</a> - def load(filename, root="root"):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
87   <a href="#4b64922b">4b64922b</a> -     cls = guessClass(filename)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
88   <a href="#4b64922b">4b64922b</a> -     if cls is None:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
89   <a href="#6d204fac">6d204fac</a> -         raise RuntimeError("Cannot infer config class name from file %s" % filename)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
90   <a href="#4b64922b">4b64922b</a> -     config = cls()</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
91   <a href="#4b64922b">4b64922b</a> -     config.load(filename, root=root)</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
92   <a href="#4b64922b">4b64922b</a> -     return config</div>
                
                def _joinNamePath(prefix=None, name=None, index=None):
                    """
                    Utility function for generating nested configuration names
                    """
                    if not prefix and not name:
                        raise ValueError("Invalid name: cannot be None")
                    elif not name:
                        name = prefix
                    elif prefix and name:
                        name = prefix + "." + name
                
                    if index is not None:
                        return "%s[%r]"%(name, index)
                    else:
                        return name
                
                def _autocast(x, dtype):
                    """
                    If appropriate perform type casting of value x to type dtype,
                    otherwise return the original value x
                    """
                    if dtype==float and type(x)==int:
                        return float(x)
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
57   <a href="#488456bb">488456bb</a> +     if dtype==int and type(x)==long:</div>
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
58   <a href="#488456bb">488456bb</a> +         return int(x)</div>
                    return x
                
                def _typeStr(x):
                    """
                    Utility function to generate a fully qualified type name.
                
                    This is used primarily in writing config files to be 
                    executed later upon 'load'.
                    """
                    if hasattr(x, '__module__') and hasattr(x, '__name__'):
                        xtype = x
                    else:
                        xtype = type(x)
                    if xtype.__module__ == '__builtin__':
                        return xtype.__name__
                    else:
                        return "%s.%s"%(xtype.__module__, xtype.__name__)
                
                class ConfigMeta(type):
                    """A metaclass for Config
                
                    Adds a dictionary containing all Field class attributes
                    as a class attribute called '_fields', and adds the name of each field as 
                    an instance variable of the field itself (so you don't have to pass the 
                    name of the field to the field constructor).
                    """
                    def __init__(self, name, bases, dict_):
                        type.__init__(self, name, bases, dict_)
                        self._fields = {}
                        self._source = traceback.extract_stack(limit=2)[0]
                        def getFields(classtype):
                            fields = {}
                            bases=list(classtype.__bases__)
                            bases.reverse()
                            for b in bases:
                                fields.update(getFields(b))
                
                            for k, v in classtype.__dict__.iteritems():
                                if isinstance(v, Field):
                                    fields[k] = v
                            return fields
                
                        fields = getFields(self)
                        for k, v in fields.iteritems():            
                            setattr(self, k, copy.deepcopy(v))
                
                    def __setattr__(self, name, value):
                        if isinstance(value, Field):
                            value.name = name
                            self._fields[name] = value
                        type.__setattr__(self, name, value)
                
                class FieldValidationError(ValueError):
                    """
                    Custom exception class which holds additional information useful to
                    debuggin Config errors:
                    - fieldType: type of the Field which incurred the error
                    - fieldName: name of the Field which incurred the error
                    - fullname: fully qualified name of the Field instance
                    - history: full history of all changes to the Field instance
                    - fieldSource: file and line number of the Field definition   
                    """
                    def __init__(self, field, config, msg):
                        self.fieldType = type(field)
                        self.fieldName = field.name
                        self.fullname  = _joinNamePath(config._name, field.name)
                        self.history = config.history.setdefault(field.name, [])
                        self.fieldSource = field.source
                        self.configSource = config._source
                        error="%s '%s' failed validation: %s\n"\
                                "For more information read the Field definition at:\n%s"\
                                "And the Config definition at:\n%s"%\
                              (self.fieldType.__name__, self.fullname, msg, 
                                      traceback.format_list([self.fieldSource])[0],
                                      traceback.format_list([self.configSource])[0])
                        ValueError.__init__(self, error)
                
                
                class Field(object):
                    """A field in a a Config.
                
                    Instances of Field should be class attributes of Config subclasses:
                    Field only supports basic data types (int, float, complex, bool, str)
                
                    class Example(Config):
                        myInt = Field(int, "an integer field!", default=0)
                    """
                    supportedTypes=(str, bool, float, int, complex)
                
                    def __init__(self, doc, dtype, default=None, check=None, optional=False):
                        """Initialize a Field.
                        
                        dtype ------ Data type for the field.  
                        doc -------- Documentation for the field.
                        default ---- A default value for the field.
                        check ------ A callable to be called with the field value that returns 
                                     False if the value is invalid.  More complex inter-field 
                                     validation can be written as part of Config validate() 
                                     method; this will be ignored if set to None.
                        optional --- When False, Config validate() will fail if value is None
                        """
                        if dtype not in self.supportedTypes:
                            raise ValueError("Unsupported Field dtype %s"%_typeStr(dtype))
                        source = traceback.extract_stack(limit=2)[0]
                        self._setup(doc=doc, dtype=dtype, default=default, check=check, optional=optional, source=source)
                        
                
                    def _setup(self, doc, dtype, default, check, optional, source):
                        """
                        Convenience function provided to simplify initialization of derived
                        Field types
                        """
                        self.dtype = dtype
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
230  <a href="#0431b7d4">0431b7d4</a> -         if doc:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
231  <a href="#0431b7d4">0431b7d4</a> -             if re.search("'''",doc):</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
232  <a href="#0431b7d4">0431b7d4</a> -                 raise ValueError("Documentation string cannot contain '''")</div>
                        self.doc = doc
                        self.__doc__ = doc
                        self.default = default
                        self.check = check
                        self.optional = optional
                        self.source = source
                
                    def rename(self, instance):
                        """
                        Rename an instance of this field, not the field itself. 
                        This is invoked by the owning config object and should not be called
                        directly
                
                        Only useful for fields which hold sub-configs.
                        Fields which hold subconfigs should rename each sub-config with
                        the full field name as generated by _joinNamePath
                        """
                        pass
                
                    def validate(self, instance):
                        """
                        Base validation for any field.
                        Ensures that non-optional fields are not None.
                        Ensures type correctness
                        Ensures that user-provided check function is valid
                        Most derived Field types should call Field.validate if they choose
                        to re-implement validate
                        """
                        value = self.__get__(instance)
                        if not self.optional and value is None:
                            raise FieldValidationError(self, instance, "Required value cannot be None")
                   
                    def freeze(self, instance):
                        """
                        Make this field read-only.
                        Only important for fields which hold sub-configs.
                        Fields which hold subconfigs should freeze each sub-config.
                        """
                        pass
                
                    def _validateValue(self, value):
                        """
                        Validate a value that is not None
                    
                        This is called from __set__
                        This is not part of the Field API. However, simple derived field types
                            may benifit from implementing _validateValue
                        """
                        if value is None:
                            return
                
                        if not isinstance(value, self.dtype):
                            msg = "Value %s is of incorrect type %s. Expected type %s"%\
                                    (value, _typeStr(value), _typeStr(self.dtype))
                            raise TypeError(msg)
                        if self.check is not None and not self.check(value):
                            msg = "Value %s is not a valid value"%str(value)
                            raise ValueError(msg)
                
                    def save(self, outfile, instance):
                        """
                        Saves an instance of this field to file.
                        This is invoked by the owning config object, and should not be called
                        directly
                
                        outfile ---- an open output stream.
                        """
                        value = self.__get__(instance)
                        fullname = _joinNamePath(instance._name, self.name)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
302  <a href="#b0de0ab7">b0de0ab7</a> - </div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
303  <a href="#b0de0ab7">b0de0ab7</a> -         # write documentation as multiline string</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
304  <a href="#0431b7d4">0431b7d4</a> -         doc = "'''" + str(self.doc) + " '''"</div>
                        if isinstance(value, float) and (math.isinf(value) or math.isnan(value)):
                            # non-finite numbers need special care
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
307  <a href="#b0de0ab7">b0de0ab7</a> -             print >> outfile, "%s\n%s=float('%r')\n"%(doc, fullname, value)</div>
              ?                                ----              --   -----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
243  <a href="#bae5d851">bae5d851</a> +             print >> outfile, "%s=float('%r')"%(fullname, value)</div>
                        else:
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
309  <a href="#b0de0ab7">b0de0ab7</a> -             print >> outfile, "%s\n%s=%r\n"%(doc, fullname, value)</div>
              ?                                ----     --   -----
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
245  <a href="#bae5d851">bae5d851</a> +             print >> outfile, "%s=%r"%(fullname, value)</div>
                    
                    def toDict(self, instance):
                        """
                        Convert the field value so that it can be set as the value of an item 
                        in a dict.
                        This is invoked by the owning config object and should not be called
                        directly
                
                        Simple values are passed through. Complex data structures must be
                        manipulated. For example, a field holding a sub-config should, instead
                        of the subconfig object, return a dict where the keys are the field 
                        names in the subconfig, and the values are the field values in the 
                        subconfig.
                        """
                        return self.__get__(instance)
                
                    def __get__(self, instance, owner=None, at=None, label="default"):
                        """
                        Define how attribute access should occur on the Config instance
                        This is invoked by the owning config object and should not be called
                        directly
                
                        When the field attribute is accessed on a Config class object, it 
                        returns the field object itself in order to allow inspection of 
                        Config classes.
                
                        When the field attribute is access on a config instance, the actual
                        value described by the field (and held by the Config instance) is 
                        returned.
                        """
                        if instance is None or not isinstance(instance, Config):
                            return self
                        else:
                            return instance._storage[self.name]
                
                    def __set__(self, instance, value, at=None, label='assignment'):
                        """
                        Describe how attribute setting should occur on the config instance.
                        This is invoked by the owning config object and should not be called
                        directly
                
                        Derived Field classes may need to override the behavior. When overriding 
                        __set__, Field authors should follow the following rules:
                        * Do not allow modification of frozen configs
                        * Validate the new value *BEFORE* modifying the field. Except if the 
                            new value is None. None is special and no attempt should be made to
                            validate it until Config.validate is called. 
                        * Do not modify the Config instance to contain invalid values.
                        * If the field is modified, update the history of the field to reflect the 
                            changes
                
                        In order to decrease the need to implement this method in derived Field
                        types, value validation is performed in the method _validateValue. If 
                        only the validation step differs in the derived Field, it is simpler to
                        implement _validateValue than to re-implement __set__. More complicated
                        behavior, however, may require a reimplementation.
                        """
                        if instance._frozen:
                            raise FieldValidationError(self, instance, "Cannot modify a frozen Config")
                
                        history = instance._history.setdefault(self.name, [])
                        if value is not None:
                            value = _autocast(value, self.dtype)
                            try:
                                self._validateValue(value)
                            except BaseException, e:
                                raise FieldValidationError(self, instance, e.message)
                        
                        instance._storage[self.name] = value
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                        history.append((value, at, label))
                
                    def __delete__(self, instance, at=None, label='deletion'):
                        """
                        Describe how attribute deletion should occur on the Config instance.
                        This is invoked by the owning config object and should not be called
                        directly
                        """
                        if at is None:
                            at = traceback.extract_stack()[:-1]
                        self.__set__(instance, None, at=at, label=label)
                
                    def _compare(self, instance1, instance2, shortcut, rtol, atol, output):
                        """Helper function for Config.compare; used to compare two fields for equality.
                
                        Must be overridden by more complex field types.
                
                        @param[in] instance1  LHS Config instance to compare.
                        @param[in] instance2  RHS Config instance to compare.
                        @param[in] shortcut   If True, return as soon as an inequality is found.
                        @param[in] rtol       Relative tolerance for floating point comparisons.
                        @param[in] atol       Absolute tolerance for floating point comparisons.
                        @param[in] output     If not None, a callable that takes a string, used (possibly repeatedly)
                                              to report inequalities.
                
                        Floating point comparisons are performed by numpy.allclose; refer to that for details.
                        """
                        v1 = getattr(instance1, self.name)
                        v2 = getattr(instance2, self.name)
                        name = getComparisonName(
                            _joinNamePath(instance1._name, self.name),
                            _joinNamePath(instance2._name, self.name)
                            )
                        return compareScalars(name, v1, v2, dtype=self.dtype, rtol=rtol, atol=atol, output=output)
                
                class RecordingImporter(object):
                    """An Importer (for sys.meta_path) that records which modules are being imported.
                
                    Objects also act as Context Managers, so you can:
                        with RecordingImporter() as importer:
                            import stuff
                        print "Imported: " + importer.getModules()
                    This ensures it is properly uninstalled when done.
                
                    This class makes no effort to do any importing itself.
                    """
                    def __init__(self):
                        """Create and install the Importer"""
                        self._modules = set()
                
                    def __enter__(self):
                
                        self.origMetaPath = sys.meta_path
                        sys.meta_path = [self] + sys.meta_path
                        return self
                
                    def __exit__(self, *args):
                        self.uninstall()
                        return False # Don't suppress exceptions
                
                    def uninstall(self):
                        """Uninstall the Importer"""
                        sys.meta_path = self.origMetaPath
                
                    def find_module(self, fullname, path=None):
                        """Called as part of the 'import' chain of events.
                
                        We return None because we don't do any importing.
                        """
                        self._modules.add(fullname)
                        return None
                
                    def getModules(self):
                        """Return the set of modules that were imported."""
                        return self._modules
                
                class Config(object):
                    """Base class for control objects.
                
                    A Config object will usually have several Field instances as class 
                    attributes; these are used to define most of the base class behavior.  
                    Simple derived class should be able to be defined simply by setting those 
                    attributes.
                    """
                
                    __metaclass__ = ConfigMeta
                
                    def __iter__(self):
                        """
                        Enable iterating over a config allows inspection of a Config's fields,
                        so that a Config behaves like a dict mapping field names to field
                        descriptors
                        """
                        return self._fields.__iter__()
                
                    def keys(self):
                        """
                        Return the list of field names
                        """
                        return self._storage.keys()
                    def values(self):
                        """
                        Return the list of field values
                        """
                        return self._storage.values()
                    def items(self):
                        """
                        Return the list of (field name, field value) pairs
                        """
                        return self._storage.items()
                
                    def iteritems(self):
                        """
                        Enable iterate over (field name, field value) pairs
                        """
                        return self._storage.iteritems()
                    def itervalues(self):
                        """
                        Enable iteration over field values
                        """
                        return self.storage.itervalues()
                    def iterkeys(self):
                        """
                        Enable iteration over field names
                        """
                        return self.storage.iterkeys()
                
                    def __contains__(self, name):
                        """
                        Determines whether the field 'name' exists in this config
                        """
                        return self._storage.__contains__(name)
                
                    def __new__(cls, *args, **kw):
                        """
                        Allocate a new Config object.
                
                        In order to ensure that all Config object are always in a proper
                        state when handed to users or to derived Config classes, some
                        attributes are handled at allocation time rather than at initialization
                
                        This ensures that even if a derived Config class implements __init__,
                        the author does not need to be concerned about when or even if he
                        should call the base Config.__init__
                        """
                        name=kw.pop("__name", None)
                        at=kw.pop("__at", traceback.extract_stack()[:-1])
                        label=kw.pop("__label", "default")
                
                        instance = object.__new__(cls)
                        instance._frozen=False
                        instance._name=name
                        instance._storage = {}
                        instance._history = {}
                        instance._imports = set()
                        # load up defaults
                        for field in instance._fields.itervalues():           
                            instance._history[field.name]=[]
                            field.__set__(instance, field.default, at=at+[field.source], label="default")
                        # set custom default-overides
                        instance.setDefaults()
                        # set constructor overides 
                        instance.update(__at=at, **kw)
                        return instance
                
                    def __reduce__(self):
                        """Reduction for pickling (function with arguments to reproduce).
                
                        We need to condense and reconstitute the Config, since it may contain lambdas
                        (as the 'check' elements) that cannot be pickled.
                        """
                        stream = io.BytesIO()
                        self.saveToStream(stream)
                        return (unreduceConfig, (self.__class__, stream.getvalue()))
                
                    def setDefaults(self):
                        """
                        Derived config classes that must compute defaults rather than using the 
                        Field defaults should do so here. 
                        To correctly use inherited defaults, implementations of setDefaults() 
                        must call their base class' setDefaults()
                        """
                        pass
                            
                    def update(self, **kw):
                        """
                        Treat the Config as a dict, updating values as provided by the keyword
                        arguments.
                
                        The '__at' and '__label' keyword arguments are special internal 
                        keywords. They are used to strip out any internal steps from the 
                        history tracebacks of the config. Modifying these keywords allows users
                        to lie about a Config's history. Please do not do so!
                        """
                        at=kw.pop("__at", traceback.extract_stack()[:-1])
                        label = kw.pop("__label", "update")
                
                        for name, value in kw.iteritems():            
                            try:
                                field = self._fields[name]
                                field.__set__(self, value, at=at, label=label)
                            except KeyError, e:
                                raise KeyError("No field of name %s exists in config type %s"%(name, _typeStr(self)))
                
                    def load(self, filename, root="root"):
                        """
                        Load override from files, modify this config in place by executing the
                        Python code in the given file.
                
                        The file should modify a Config named root
                
                        For example:
                            root.myField = 5
                        """
                        with RecordingImporter() as importer:
                            local = {root: self}
                            execfile(filename, {}, local)
                        self._imports.update(importer.getModules())
                
                    def loadFromStream(self, stream, root="root"):
                        """
                        Modify this config in place by executign the python code in the
                        provided stream.
                
                        The stream should modify a Config named 'root', e.g.: root.myField = 5
                        """
                        with RecordingImporter() as importer:
                            local = {root: self}
                            exec stream in {}, local
                        self._imports.update(importer.getModules())
                
                    def save(self, filename, root="root"):
                        """
                        Generates a python script at the given filename, which, when loaded,
                        reproduces this Config.
                
                        @param filename [in] name of file to write to
                        @param root [in] name to use for the root config variable
                            If not "root", must match what is used in load())
                        """
<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
557  <a href="#be621c60">be621c60</a> +         with open(filename, 'w') as outfile:</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
621  <a href="#6e44b4e3">6e44b4e3</a> -         d = os.path.split(filename)[0]</div>
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
622  <a href="#6e44b4e3">6e44b4e3</a> -         with tempfile.NamedTemporaryFile(delete=False, dir=d) as outfile:</div>
                            self.saveToStream(outfile, root)
<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">
624  <a href="#6e44b4e3">6e44b4e3</a> -             os.rename(outfile.name, filename)</div>
                
                    def saveToStream(self, outfile, root="root"):
                        """
                        Generates a python script to the given open file object, which, when
                        loaded, reproduces this Config.
                
                        @param outfile [inout] open file object to write to
                        @param root [in] name to use for the root config variable
                            If not "root", must match what is used in load())
                        """
                        tmp = self._name
                        self._rename(root)
                        try:
                            configType = type(self)
                            typeString = _typeStr(configType)
                            print >> outfile, "import %s" % (configType.__module__)
                            print >> outfile, "assert type(%s)==%s, 'config is of type %%s.%%s" % (root, typeString), \
                                "instead of %s' %% (type(root).__module__, type(root).__name__)" % (typeString,)
                            self._save(outfile)
                        finally:
                            self._rename(tmp)
                
                    def freeze(self):
                        """
                        Make this Config, and recursively all sub-configs read-only
                        """
                        self._frozen=True
                        for field in self._fields.itervalues():
                            field.freeze(self)
                
                    def _save(self, outfile):
                        """
                        Internal use only. Save this Config to an open stream object
                        """
                        for imp in self._imports:
                            if imp in sys.modules and sys.modules[imp] is not None:
                                print >> outfile, "import %s" % imp
                        for field in self._fields.itervalues():
                            field.save(outfile, self)
                
                    def toDict(self):
                        """
                        Convert this Config into a dict whose keys are field names, 
                        and whose values are field values.
                
                        Correct behavior is dependent on proper implementation of 
                        Field.toDict. If implementing a new Field type, you may need to
                        implement your own toDict method.
                        """
                        dict_ = {}
                        for name, field in self._fields.iteritems():
                            dict_[name] = field.toDict(self)
                        return dict_
                
                    def _rename(self, name):
                        """
                        Internal use only. 
                        Rename this Config object to reflect its position in a Config hierarchy
                
                        
                        Correct behavior is dependent on proper implementation of 
                        Field.rename. If implementing a new Field type, you may need to
                        implement your own rename method.
                        """
                        self._name = name
                        for field in self._fields.itervalues():
                            field.rename(self)
                
                    def validate(self):
                        """
                        Validate the Config.
                
                        The base class implementation performs type checks on all fields by 
                        calling Field.validate(). 
                
                        Complex single-field validation can be defined by deriving new Field 
                        types. As syntactic sugar, some derived Field types are defined in 
                        this module which handle recursing into sub-configs 
                        (ConfigField, ConfigChoiceField)
                
                        Inter-field relationships should only be checked in derived Config 
                        classes after calling this method, and base validation is complete
                        """
                        for field in self._fields.itervalues():
                            field.validate(self)
                   
                    def formatHistory(self, name, **kwargs):
                        """
                        Format the config's history to a more human-readable format
                        """
                        import lsst.pex.config.history as pexHist
                        return pexHist.format(self, name, **kwargs)
                
                    """
                    Read-only history property
                    """
                    history = property(lambda x: x._history)
                
                    def __setattr__(self, attr, value, at=None, label="assignment"):
                        """
                        Regulate which attributes can be set.
                
                        Unlike normal python objects, Config objects are locked such 
                        that no additional attributes nor properties may be added to them
                        dynamically. 
                
                        Although this is not the standard Python behavior, it helps to 
                        protect users from accidentally mispelling a field name, or
                        trying to set a non-existent field.
                        """
                        if attr in self._fields:
                            if at is None:
                                at=traceback.extract_stack()[:-1]
                            # This allows Field descriptors to work.
                            self._fields[attr].__set__(self, value, at=at, label=label)
                        elif hasattr(getattr(self.__class__, attr, None), '__set__'):
                            # This allows properties and other non-Field descriptors to work.
                            return object.__setattr__(self, attr, value)
                        elif attr in self.__dict__ or attr in ("_name", "_history", "_storage", "_frozen", "_imports"):
                            # This allows specific private attributes to work.
                            self.__dict__[attr] = value
                        else:
                            # We throw everything else.
                            raise AttributeError("%s has no attribute %s"%(_typeStr(self), attr))
                
                    def __delattr__(self, attr, at=None, label="deletion"):
                        if attr in self._fields:
                            if at is None:
                                at=traceback.extract_stack()[:-1]
                            self._fields[attr].__delete__(self, at=at, label=label)
                        else:
                            object.__delattr__(self, attr)
                            
                    def __eq__(self, other):
                        if type(other) == type(self):
                            for name in self._fields:
                                thisValue = getattr(self, name)
                                otherValue = getattr(other, name)
                                if isinstance(thisValue, float) and math.isnan(thisValue):
                                    if not math.isnan(otherValue):
                                        return False
                                elif thisValue != otherValue:
                                    return False
                            return True
                        return False
                    
                    def __ne__(self, other):
                        return not self.__eq__(other)
                
                    def __str__(self):
                        return str(self.toDict())
                
                    def __repr__(self):
                        return "%s(%s)" % (
                            _typeStr(self), 
                            ", ".join("%s=%r" % (k, v) for k, v in self.toDict().iteritems() if v is not None)
                            )
                
                    def compare(self, other, shortcut=True, rtol=1E-8, atol=1E-8, output=None):
                        """Compare two Configs for equality.
                
                        If the Configs contain RegistryFields or ConfigChoiceFields, unselected Configs
                        will not be compared.
                
                        @param[in] other      Config object to compare with self.
                        @param[in] shortcut   If True, return as soon as an inequality is found.
                        @param[in] rtol       Relative tolerance for floating point comparisons.
                        @param[in] atol       Absolute tolerance for floating point comparisons.
                        @param[in] output     If not None, a callable that takes a string, used (possibly repeatedly)
                                              to report inequalities.
                
                        Floating point comparisons are performed by numpy.allclose; refer to that for details.
                        """
                        name1 = self._name if self._name is not None else "root"
                        name2 = other._name if other._name is not None else "root"
                        name = getComparisonName(name1, name2)
                        return compareConfigs(name, self, other, shortcut=shortcut,
                                              rtol=rtol, atol=atol, output=output)
                
                def unreduceConfig(cls, stream):
                    config = cls()
                    config.loadFromStream(stream)
                    return config
</pre>

<p><a href="#homelist">Return to list</a></p>

<div style="background-color:Khaki; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_hsc/pex_config/</h2>
<h3><a name="6e44b4e3"/></a>6e44b4e3</h3>

<pre>
commit 6e44b4e38cf53c743c550fefeba375652945ec69
Author: Steven Bickerton <steven.bickerton@gmail.com>
Date:   Tue Mar 3 15:23:37 2015 +0900

    write config to tempfile and rename to avoid race.
</pre>
<h3><a name="e6345afc"/></a>e6345afc</h3>

<pre>
commit e6345afc5eaf73ca28feddaac124f9c955baa92e
Author: michitaro <michitaro.nike@gmail.com>
Date:   Thu May 23 14:57:11 2013 +0900

    Update regex for assert line.
    
    regexp without this update doesn't match to a string like "assert type(root)==hsc.pipe.tasks.processCcd.SubaruProcessCcdConfig, ..."
</pre>
<h3><a name="4b64922b"/></a>4b64922b</h3>

<pre>
commit 4b64922ba5286f7232d0500732fe28c8af3c258e
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Thu Apr 4 23:28:04 2013 -0400

    Provide method to load config without knowing its class in advance
</pre>
<h3><a name="6d204fac"/></a>6d204fac</h3>

<pre>
commit 6d204fac74f866721e516ca054258def0cc0ec61
Author: Paul Price <price@astro.princeton.edu>
Date:   Thu Jun 6 11:48:35 2013 -0400

    config: update error message
    
    Report the filename.
    Requested by Dustin Lang.
</pre>
<h3><a name="b0de0ab7"/></a>b0de0ab7</h3>

<pre>
commit b0de0ab78ef712cb3837e98393a17f4ee4db090f
Author: Bob Armstrong <rearmstr@gmail.com>
Date:   Tue Nov 18 12:32:40 2014 -0500

    Config: when printing config fields also include the documentation
</pre>
<h3><a name="0431b7d4"/></a>0431b7d4</h3>

<pre>
commit 0431b7d41b49d0d24d388ce3ea9d6267c2f8d984
Author: Bob Armstrong <rearmstr@gmail.com>
Date:   Tue Mar 3 13:52:29 2015 -0500

    Config: allow None as documentation string.
</pre>
</div>

<div style="background-color:LightBlue; margin-left: 20px; margin-right: 20px; padding-bottom: 8px; padding-left: 8px; padding-right: 8px; padding-top: 8px;">

<h2>Commits in /Users/nate/repos_lsst/pex_config/</h2>
<h3><a name="488456bb"/></a>488456bb</h3>

<pre>
commit 488456bb8647c8faa68d1f816b8489f904d129ff
Author: Jim Bosch <jbosch@astro.princeton.edu>
Date:   Tue Jul 15 14:00:57 2014 -0400

    Cast Python longs to ints instead of refusing to accept them
</pre>
<h3><a name="bae5d851"/></a>bae5d851</h3>

<pre>
commit bae5d851daa62fd453dacab93b989516a6d12624
Author: Serge Monkewitz <smm@ipac.caltech.edu>
Date:   Thu May 10 03:42:02 2012 -0500

    Bug fix: Config.save yields invalid config files when float Fields have NaN/Inf values
</pre>
<h3><a name="fa70d1d6"/></a>fa70d1d6</h3>

<pre>
commit fa70d1d67ebfa923a8f56b93df16e49a9dc2e241
Author: Martin Dubcovsky <dubcovsky@physics.ucdavis.edu>
Date:   Tue Apr 3 09:21:51 2012 -0700

    a little clean up in registry.py
</pre>
<h3><a name="be621c60"/></a>be621c60</h3>

<pre>
commit be621c60a339337ba0726032e7ac00e0fa116aa4
Author: Kian-Tat Lim <ktl@slac.stanford.edu>
Date:   Fri May 18 16:37:52 2012 -0700

    Add saveToStream() (which does not close the stream) and revert save() to take only a filename.
</pre>
</div>

<p><a href="#homelist">Return to list</a></p>

<script type="text/javascript">
self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{};var Prism=function(){var e=/\blang(?:uage)?-(?!\*)(\w+)\b/i,t=self.Prism={util:{encode:function(e){return e instanceof n?new n(e.type,t.util.encode(e.content),e.alias):"Array"===t.util.type(e)?e.map(t.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},clone:function(e){var n=t.util.type(e);switch(n){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=t.util.clone(e[r]));return a;case"Array":return e.map(function(e){return t.util.clone(e)})}return e}},languages:{extend:function(e,n){var a=t.util.clone(t.languages[e]);for(var r in n)a[r]=n[r];return a},insertBefore:function(e,n,a,r){r=r||t.languages;var i=r[e];if(2==arguments.length){a=arguments[1];for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);return i}var s={};for(var o in i)if(i.hasOwnProperty(o)){if(o==n)for(var l in a)a.hasOwnProperty(l)&&(s[l]=a[l]);s[o]=i[o]}return t.languages.DFS(t.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=s)}),r[e]=s},DFS:function(e,n,a){for(var r in e)e.hasOwnProperty(r)&&(n.call(e,r,e[r],a||r),"Object"===t.util.type(e[r])?t.languages.DFS(e[r],n):"Array"===t.util.type(e[r])&&t.languages.DFS(e[r],n,r))}},highlightAll:function(e,n){for(var a,r=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'),i=0;a=r[i++];)t.highlightElement(a,e===!0,n)},highlightElement:function(a,r,i){for(var l,s,o=a;o&&!e.test(o.className);)o=o.parentNode;if(o&&(l=(o.className.match(e)||[,""])[1],s=t.languages[l]),s){a.className=a.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=a.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var u=a.textContent;if(u){u=u.replace(/^(?:\r?\n|\r)/,"");var g={element:a,language:l,grammar:s,code:u};if(t.hooks.run("before-highlight",g),r&&self.Worker){var c=new Worker(t.filename);c.onmessage=function(e){g.highlightedCode=n.stringify(JSON.parse(e.data),l),t.hooks.run("before-insert",g),g.element.innerHTML=g.highlightedCode,i&&i.call(g.element),t.hooks.run("after-highlight",g)},c.postMessage(JSON.stringify({language:g.language,code:g.code}))}else g.highlightedCode=t.highlight(g.code,g.grammar,g.language),t.hooks.run("before-insert",g),g.element.innerHTML=g.highlightedCode,i&&i.call(a),t.hooks.run("after-highlight",g)}}},highlight:function(e,a,r){var i=t.tokenize(e,a);return n.stringify(t.util.encode(i),r)},tokenize:function(e,n){var a=t.Token,r=[e],i=n.rest;if(i){for(var l in i)n[l]=i[l];delete n.rest}e:for(var l in n)if(n.hasOwnProperty(l)&&n[l]){var s=n[l];s="Array"===t.util.type(s)?s:[s];for(var o=0;o<s.length;++o){var u=s[o],g=u.inside,c=!!u.lookbehind,f=0,h=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var d=r[p];if(r.length>e.length)break e;if(!(d instanceof a)){u.lastIndex=0;var m=u.exec(d);if(m){c&&(f=m[1].length);var y=m.index-1+f,m=m[0].slice(f),v=m.length,k=y+v,b=d.slice(0,y+1),w=d.slice(k+1),N=[p,1];b&&N.push(b);var O=new a(l,g?t.tokenize(m,g):m,h);N.push(O),w&&N.push(w),Array.prototype.splice.apply(r,N)}}}}}return r},hooks:{all:{},add:function(e,n){var a=t.hooks.all;a[e]=a[e]||[],a[e].push(n)},run:function(e,n){var a=t.hooks.all[e];if(a&&a.length)for(var r,i=0;r=a[i++];)r(n)}}},n=t.Token=function(e,t,n){this.type=e,this.content=t,this.alias=n};if(n.stringify=function(e,a,r){if("string"==typeof e)return e;if("Array"===t.util.type(e))return e.map(function(t){return n.stringify(t,a,e)}).join("");var i={type:e.type,content:n.stringify(e.content,a,r),tag:"span",classes:["token",e.type],attributes:{},language:a,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var l="Array"===t.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,l)}t.hooks.run("wrap",i);var s="";for(var o in i.attributes)s+=o+'="'+(i.attributes[o]||"")+'"';return"<"+i.tag+' class="'+i.classes.join(" ")+'" '+s+">"+i.content+"</"+i.tag+">"},!self.document)return self.addEventListener?(self.addEventListener("message",function(e){var n=JSON.parse(e.data),a=n.language,r=n.code;self.postMessage(JSON.stringify(t.util.encode(t.tokenize(r,t.languages[a])))),self.close()},!1),self.Prism):self.Prism;var a=document.getElementsByTagName("script");return a=a[a.length-1],a&&(t.filename=a.src,document.addEventListener&&!a.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",t.highlightAll)),self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism);
</script>
</body>

</html>
